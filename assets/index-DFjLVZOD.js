import{a as p,j as s,R as Xe}from"./react-D_ZWy-Ho.js";import{u as et,e as tt,aC as st,c as nt,bq as ve,B as b,ai as le,aa as at,U as ee,V as y,X as ae,a6 as je,ap as ie,ag as De,aF as te,ah as x,d,ab as we,a7 as it,a8 as rt,a9 as ct,aW as ot,bh as lt,aS as de,aQ as $e,b3 as Ce,n as dt,g as gt,al as yt,an as ut,a4 as Te,K as pt,a1 as mt,az as ft,_ as ge,a3 as St}from"./react-dom-GpeNoQsX.js";import{u as ht}from"./index-BquYqWj2.js";import{d5 as xt}from"./vendor-VHja5XRA.js";import{S as bt}from"./SearchFilterBar-Lz3VU8LA.js";import"./redux-CiqK6azd.js";import"./echarts-core-CW0Gv0IT.js";import"./media-BPG7piku.js";import"./cytoscape-DXzeTOL3.js";import"./antd-icons-CI4I6I7B.js";import"./dayjs-CrhenB4N.js";import"./emotion-BhZTwsuK.js";import"./mermaid-AggIEIwl.js";import"./d3-Dbz_rnoS.js";import"./lodash-D08E6HgQ.js";import"./i18n-CMVetavo.js";const kt=()=>{const e=xt.create({baseURL:"https://api.ai-ops.com/api/v1",timeout:1e4,headers:{"Content-Type":"application/json"}});return e.interceptors.request.use(a=>{const i=localStorage.getItem("auth_token");return i&&a.headers&&(a.headers.Authorization=`Bearer ${i}`),a},a=>Promise.reject(a)),e.interceptors.response.use(a=>{var i;return((i=a.data)==null?void 0:i.data)!==void 0,a.data},a=>{var o,re,j,f,I;const i={code:((re=(o=a.response)==null?void 0:o.status)==null?void 0:re.toString())||"UNKNOWN",message:((f=(j=a.response)==null?void 0:j.data)==null?void 0:f.message)||a.message||"请求失败",details:(I=a.response)==null?void 0:I.data,timestamp:new Date().toISOString()};return Promise.reject(i)}),e},u=kt();class vt{async getDataSources(){try{return(await u.get("/entity-scan/data-sources")).data}catch(a){return console.error("Failed to fetch data sources:",a),this.getMockDataSources()}}async createDataSource(a){try{return(await u.post("/entity-scan/data-sources",a)).data}catch(i){throw console.error("Failed to create data source:",i),i}}async updateDataSource(a,i){try{return(await u.put(`/entity-scan/data-sources/${a}`,i)).data}catch(o){throw console.error("Failed to update data source:",o),o}}async deleteDataSource(a){try{await u.delete(`/entity-scan/data-sources/${a}`)}catch(i){throw console.error("Failed to delete data source:",i),i}}async testDataSourceConnection(a){try{return(await u.post(`/entity-scan/data-sources/${a}/test`)).data}catch(i){return console.error("Failed to test data source connection:",i),{success:!1,message:"连接测试失败"}}}async startScanTask(a){try{return(await u.post("/entity-scan/tasks",a)).data}catch(i){throw console.error("Failed to start scan task:",i),i}}async getScanTasks(){try{return(await u.get("/entity-scan/tasks")).data}catch(a){return console.error("Failed to fetch scan tasks:",a),[]}}async getScanTask(a){try{return(await u.get(`/entity-scan/tasks/${a}`)).data}catch(i){throw console.error("Failed to fetch scan task:",i),i}}async pauseScanTask(a){try{await u.post(`/entity-scan/tasks/${a}/pause`)}catch(i){throw console.error("Failed to pause scan task:",i),i}}async resumeScanTask(a){try{await u.post(`/entity-scan/tasks/${a}/resume`)}catch(i){throw console.error("Failed to resume scan task:",i),i}}async stopScanTask(a){try{await u.post(`/entity-scan/tasks/${a}/stop`)}catch(i){throw console.error("Failed to stop scan task:",i),i}}async getScanResults(a){try{return(await u.get(`/entity-scan/tasks/${a}/results`)).data}catch(i){return console.error("Failed to fetch scan results:",i),[]}}async generateEntities(a,i){try{return(await u.post(`/entity-scan/tasks/${a}/generate`,{selectedResults:i})).data}catch(o){throw console.error("Failed to generate entities:",o),o}}getMockDataSources(){return[{id:"mysql-prod",name:"生产环境MySQL",type:"database",description:"生产环境主数据库，包含用户、订单、商品等核心业务数据",config:{host:"prod-mysql.example.com",port:3306,database:"business_db",username:"scan_user"},status:"connected",lastScan:"2024-06-17 14:30:00",entityCount:156},{id:"api-crm",name:"CRM系统API",type:"api",description:"CRM系统REST API，包含客户、联系人、销售机会等数据",config:{baseUrl:"https://crm.example.com/api/v1",apiKey:"***hidden***",endpoints:["/customers","/contacts","/opportunities"]},status:"connected",lastScan:"2024-06-16 09:15:00",entityCount:89},{id:"cloud-oss",name:"阿里云OSS",type:"cloud",description:"对象存储服务，包含文档、图片、视频等文件资源",config:{endpoint:"oss-cn-hangzhou.aliyuncs.com",bucket:"business-files",accessKeyId:"***hidden***"},status:"disconnected",entityCount:0},{id:"prometheus-prod",name:"生产环境Prometheus",type:"monitoring",subType:"prometheus",description:"Prometheus监控系统，包含应用指标、系统指标、业务指标等时序数据",config:{url:"http://prometheus.example.com:9090",basicAuth:{username:"admin",password:"***hidden***"},timeout:3e4,maxSamples:5e4},status:"connected",lastScan:"2024-06-17 16:45:00",entityCount:234},{id:"grafana-prod",name:"生产环境Grafana",type:"monitoring",subType:"grafana",description:"Grafana可视化平台，包含仪表板、数据源、告警规则等配置信息",config:{url:"http://grafana.example.com:3000",apiKey:"***hidden***",orgId:1,includeDashboards:!0,includeDataSources:!0,includeAlerts:!0},status:"connected",lastScan:"2024-06-17 15:20:00",entityCount:67},{id:"influxdb-metrics",name:"InfluxDB时序数据库",type:"metrics",subType:"influxdb",description:"InfluxDB时序数据库，存储应用性能指标和业务监控数据",config:{url:"http://influxdb.example.com:8086",database:"metrics",username:"metrics_user",password:"***hidden***",retention:"30d"},status:"connected",lastScan:"2024-06-17 12:15:00",entityCount:145},{id:"elasticsearch-logs",name:"Elasticsearch日志系统",type:"monitoring",subType:"elasticsearch",description:"Elasticsearch集群，存储应用日志、访问日志、错误日志等结构化数据",config:{hosts:["http://es1.example.com:9200","http://es2.example.com:9200"],username:"elastic",password:"***hidden***",indices:["app-logs-*","access-logs-*","error-logs-*"],version:"8.x"},status:"connected",lastScan:"2024-06-17 11:30:00",entityCount:89},{id:"jaeger-tracing",name:"Jaeger链路追踪",type:"monitoring",subType:"jaeger",description:"Jaeger分布式链路追踪系统，包含服务调用链、性能指标等数据",config:{queryUrl:"http://jaeger.example.com:16686",collectorUrl:"http://jaeger.example.com:14268",services:["user-service","order-service","payment-service"],lookback:"24h"},status:"connected",lastScan:"2024-06-17 10:45:00",entityCount:56},{id:"zabbix-monitor",name:"Zabbix监控系统",type:"monitoring",subType:"zabbix",description:"Zabbix企业级监控系统，包含主机、应用、网络设备等监控数据",config:{url:"http://zabbix.example.com/zabbix",username:"admin",password:"***hidden***",apiVersion:"6.0",hostGroups:["Linux servers","Web servers","Database servers"]},status:"disconnected",entityCount:0},{id:"datadog-apm",name:"Datadog APM",type:"monitoring",subType:"datadog",description:"Datadog应用性能监控，包含应用指标、日志、链路追踪等数据",config:{apiKey:"***hidden***",appKey:"***hidden***",site:"datadoghq.com",services:["web-app","api-gateway","background-jobs"],env:"production"},status:"connected",lastScan:"2024-06-17 09:30:00",entityCount:78}]}}const jt=new vt,{Title:Ie,Text:k,Paragraph:Dt}=nt,{Option:rs}=mt,{TextArea:cs}=ft,wt=d.div`
  padding: 24px;
`,$t=d.div`
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 24px;
`,Ct=d.div`
  flex: 1;
`,Tt=d.div`
  display: flex;
  gap: 8px;
  align-items: center;
`,It=d(ge)`
  margin-bottom: 24px;
  border-radius: 8px;
  background: ${e=>e.$isDark?"linear-gradient(145deg, #1a1a1a, #141414)":"linear-gradient(145deg, #ffffff, #fafafa)"};
  border: 1px solid ${e=>e.$isDark?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.06)"};
  
  .ant-card-body {
    padding: 20px;
  }
`,$=d.div`
  text-align: center;
  padding: 16px;
  border-radius: 8px;
  background: ${e=>e.$isDark?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)"};
  border: 1px solid ${e=>e.$isDark?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.04)"};
  transition: all 0.3s ease;
  
  &:hover {
    background: ${e=>e.$isDark?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.04)"};
    transform: translateY(-2px);
  }
`,C=d.div`
  font-size: 28px;
  font-weight: bold;
  margin-bottom: 8px;
  color: ${e=>e.color||"#1890ff"};
`,T=d.div`
  font-size: 14px;
  color: ${e=>e.$isDark?"rgba(255, 255, 255, 0.65)":"rgba(0, 0, 0, 0.65)"};
  font-weight: 500;
`,ze=d(ge)`
  margin-bottom: 24px;
  border-radius: 8px;
  box-shadow: ${e=>e.$isDark?"0 2px 8px rgba(255, 255, 255, 0.05)":"0 2px 8px rgba(0, 0, 0, 0.06)"};
  
  .ant-card-head {
    border-bottom: 1px solid ${e=>e.$isDark?"#303030":"#f0f0f0"};
  }
`,zt=d(ge)`
  height: 100%;
  transition: all 0.3s ease;
  cursor: pointer;
  border-radius: 8px;
  background: ${e=>e.$isDark?"linear-gradient(145deg, #1a1a1a, #141414)":"linear-gradient(145deg, #ffffff, #fafafa)"};
  border: 1px solid ${e=>e.$isDark?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.06)"};
  box-shadow: ${e=>e.$isDark?"0 2px 8px rgba(0, 0, 0, 0.4), 0 1px 2px rgba(255, 255, 255, 0.05)":"0 2px 8px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.02)"};
  
  &:hover {
    transform: translateY(-3px);
    background: ${e=>e.$isDark?"linear-gradient(145deg, #1f1f1f, #1a1a1a)":"linear-gradient(145deg, #ffffff, #f8f9fa)"};
    border-color: ${e=>e.$isDark?"rgba(255, 255, 255, 0.15)":"rgba(24, 144, 255, 0.3)"};
    box-shadow: ${e=>e.$isDark?"0 6px 20px rgba(0, 0, 0, 0.6), 0 3px 6px rgba(255, 255, 255, 0.08)":"0 6px 20px rgba(24, 144, 255, 0.15), 0 3px 6px rgba(0, 0, 0, 0.08)"};
  }
  
  .ant-card-body {
    padding: 20px;
    background: transparent;
  }
`,Ft=d.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
`,Rt=d.div`
  display: flex;
  align-items: center;
  gap: 12px;
`,At=d.div`
  width: 40px;
  height: 40px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  color: white;
  position: relative;
  background: ${e=>{switch(e.type){case"mysql":return"linear-gradient(135deg, #4479A1, #336791)";case"postgresql":return"linear-gradient(135deg, #336791, #2E5984)";case"mongodb":return"linear-gradient(135deg, #47A248, #3E8E41)";case"redis":return"linear-gradient(135deg, #DC382D, #B92C20)";case"elasticsearch":return"linear-gradient(135deg, #005571, #004A5C)";case"api":return"linear-gradient(135deg, #1890ff, #096dd9)";case"file":return"linear-gradient(135deg, #722ed1, #531dab)";default:return"linear-gradient(135deg, #8c8c8c, #595959)"}}};
  box-shadow: ${e=>e.$isDark?"0 2px 8px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1)":"0 2px 8px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2)"};
  
  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: inherit;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
    pointer-events: none;
  }
`,Mt=d.div`
  display: flex;
  flex-direction: column;
  gap: 8px;
`,Bt=d.div`
  display: flex;
  flex-direction: column;
  gap: 8px;
  
  .scan-btn-row {
    display: flex;
    width: 100%;
  }
  
  .action-btn-row {
    display: flex;
    justify-content: space-between;
    gap: 4px;
    
    .ant-btn {
      flex: 1;
      font-size: 12px;
      height: 26px;
      padding: 0 6px;
      border-radius: 4px;
    }
  }
`,Et=d.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 12px;
  margin: 2px 0;
  border-radius: 4px;
  font-size: 12px;
  background: ${e=>e.$isDark?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)"};
  border: 1px solid ${e=>e.$isDark?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.04)"};
  transition: all 0.2s ease;
  
  &:hover {
    background: ${e=>e.$isDark?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.04)"};
  }
`,Pt=d.span`
  font-weight: 500;
  color: ${e=>e.$isDark?"rgba(255, 255, 255, 0.65)":"rgba(0, 0, 0, 0.65)"};
`,Ut=d.span`
  color: ${e=>e.$isDark?"rgba(255, 255, 255, 0.85)":"rgba(0, 0, 0, 0.85)"};
  font-weight: 500;
`,qt=d(St)`
  font-weight: bold;
  
  ${e=>{switch(e.status){case"success":return"background: #f6ffed; border-color: #b7eb8f; color: #52c41a;";case"error":return"background: #fff2f0; border-color: #ffccc7; color: #ff4d4f;";case"warning":return"background: #fffbe6; border-color: #ffe58f; color: #faad14;";case"processing":return"background: #e6f7ff; border-color: #91d5ff; color: #1890ff;";default:return"background: #fafafa; border-color: #d9d9d9; color: #595959;"}}}
`,os=()=>{const{t:e}=et(),a=tt(),{currentTheme:i}=ht(t=>t.theme),o=i==="dark",[re]=st.useForm(),[j,f]=p.useState([]),[I,Kt]=p.useState([]),[S,Fe]=p.useState([]),[ye,Lt]=p.useState(""),[ue,Vt]=p.useState(!1),[h,Gt]=p.useState(null),[Re,Ae]=p.useState(!1),[Me,ce]=p.useState(!1),[D,Be]=p.useState(""),[se,Ee]=p.useState("all"),[ne,Pe]=p.useState("all"),w=()=>{const t=j.length,n=j.filter(g=>g.status==="connected").length,c=S.length,r=S.filter(g=>g.selected).length,l=I.filter(g=>g.status==="completed").length,m=I.filter(g=>g.status==="running").length;return{totalDataSources:t,connectedDataSources:n,totalEntities:c,selectedEntities:r,completedScans:l,runningScans:m}};p.useEffect(()=>{oe()},[]);const oe=async()=>{try{const t=await jt.getDataSources();f(t)}catch(t){console.error("Failed to load data sources:",t),f([])}},Ue=(t,n)=>{switch(t){case"database":return s.jsx(ae,{});case"api":return s.jsx(ut,{});case"cloud":return s.jsx(yt,{});case"monitoring":switch(n){case"prometheus":return s.jsx(Ce,{style:{color:"#e6522c"}});case"grafana":return s.jsx(gt,{style:{color:"#f46800"}});case"elasticsearch":return s.jsx(dt,{style:{color:"#005571"}});case"jaeger":return s.jsx(de,{style:{color:"#60d0e4"}});case"zabbix":return s.jsx($e,{style:{color:"#d40000"}});case"datadog":return s.jsx(Ce,{style:{color:"#632ca6"}});default:return s.jsx($e,{})}case"metrics":switch(n){case"influxdb":return s.jsx(de,{style:{color:"#22adf6"}});default:return s.jsx(de,{})}default:return s.jsx(ae,{})}},qe=t=>{const n={connected:{color:"success",text:e("systemSettings.entityScan.dataSources.connected")},disconnected:{color:"default",text:e("systemSettings.entityScan.dataSources.disconnected")},error:{color:"error",text:e("systemSettings.entityScan.dataSources.error")},pending:{color:"default",text:e("systemSettings.entityScan.status.pending")},running:{color:"processing",text:e("systemSettings.entityScan.status.running")},completed:{color:"success",text:e("systemSettings.entityScan.status.completed")},failed:{color:"error",text:e("systemSettings.entityScan.status.failed")},paused:{color:"warning",text:e("systemSettings.entityScan.status.paused")}},c=n[t]||n.disconnected;return s.jsx(qt,{status:c.color,children:c.text})},Ke=()=>({database:{name:e("systemSettings.entityScan.dataSources.types.database"),color:"#1890ff"},api:{name:e("systemSettings.entityScan.dataSources.types.api"),color:"#52c41a"},cloud:{name:e("systemSettings.entityScan.dataSources.types.cloud"),color:"#722ed1"},monitoring:{name:e("systemSettings.entityScan.dataSources.types.monitoring"),color:"#fa8c16"},metrics:{name:e("systemSettings.entityScan.dataSources.types.metrics"),color:"#13c2c2"},file:{name:e("systemSettings.entityScan.dataSources.types.file"),color:"#eb2f96"}}),Le=()=>({mysql:"MySQL",postgresql:"PostgreSQL",mongodb:"MongoDB",redis:"Redis",elasticsearch:"Elasticsearch",prometheus:"Prometheus",grafana:"Grafana",jaeger:"Jaeger",zabbix:"Zabbix",datadog:"Datadog",influxdb:"InfluxDB"}),pe=t=>{const n={connected:{text:e("systemSettings.entityScan.dataSources.connected"),color:"success",icon:s.jsx(pt,{})},disconnected:{text:e("systemSettings.entityScan.dataSources.disconnected"),color:"error",icon:s.jsx(Te,{})},connecting:{text:e("systemSettings.entityScan.dataSources.connecting"),color:"processing",icon:s.jsx(le,{spin:!0})},error:{text:e("systemSettings.entityScan.dataSources.error"),color:"error",icon:s.jsx(Te,{})}};return n[t]||n.disconnected},me=()=>j.filter(t=>{const n=!D||t.name.toLowerCase().includes(D.toLowerCase())||t.description.toLowerCase().includes(D.toLowerCase())||t.host.toLowerCase().includes(D.toLowerCase()),c=se==="all"||t.type===se,r=ne==="all"||t.status===ne;return n&&c&&r}),Ve=()=>{const t=me(),n=Ke(),c=Le();return t.map(r=>{const l=pe(r.status),m=n[r.type];return s.jsx(y,{xs:24,sm:12,lg:8,children:s.jsxs(zt,{$isDark:o,children:[s.jsxs(Ft,{children:[s.jsxs(Rt,{children:[s.jsx(At,{type:r.subType||r.type,$isDark:o,children:Ue(r.type,r.subType)}),s.jsxs("div",{children:[s.jsx(Ie,{level:5,style:{margin:0,fontSize:"16px"},children:r.name}),s.jsx(k,{type:"secondary",style:{fontSize:"12px"},children:c[r.subType]||(m==null?void 0:m.name)})]})]}),s.jsx(we,{status:l.color,text:l.text})]}),s.jsx(Mt,{children:Ge(r).map((g,v)=>s.jsxs(Et,{$isDark:o,children:[s.jsxs(Pt,{$isDark:o,children:[g.label,":"]}),s.jsx(Ut,{$isDark:o,children:g.value})]},v))}),s.jsx(it,{style:{margin:"12px 0"}}),s.jsxs(Bt,{children:[s.jsx("div",{className:"scan-btn-row",children:s.jsx(b,{type:"primary",size:"small",icon:s.jsx(ve,{}),onClick:()=>Qe(r),disabled:r.status!=="connected",loading:ue&&ye===r.id,block:!0,children:ue&&ye===r.id?e("systemSettings.entityScan.status.running"):e("systemSettings.entityScan.scanConfig.startScan")})}),s.jsxs("div",{className:"action-btn-row",children:[s.jsx(b,{type:"text",size:"small",icon:s.jsx(rt,{}),onClick:()=>Ne(r),children:e("common.view")}),s.jsx(b,{type:"text",size:"small",icon:s.jsx(ct,{}),onClick:()=>_e(),children:e("common.edit")}),s.jsx(b,{type:"text",size:"small",icon:s.jsx(le,{}),onClick:()=>He(r),loading:r.status==="connecting",children:e("systemSettings.entityScan.dataSources.testConnection")}),s.jsx(b,{type:"text",size:"small",danger:!0,icon:s.jsx(ot,{}),onClick:()=>Je(r),children:e("common.delete")})]})]})]})},r.id)})},Ge=t=>{var c,r,l,m,g,v,z,F,R,A,M,B,E,P,U,q,K,L,V,G,W,O,N,_,H,Q,J,Z,Y,X;const n=[];switch(t.type){case"database":n.push({label:e("systemSettings.entityScan.fields.host"),value:`${(c=t.config)==null?void 0:c.host}:${(r=t.config)==null?void 0:r.port}`},{label:e("systemSettings.entityScan.fields.database"),value:((l=t.config)==null?void 0:l.database)||"-"});break;case"api":n.push({label:e("systemSettings.entityScan.fields.baseUrl"),value:((m=t.config)==null?void 0:m.baseUrl)||"-"},{label:e("systemSettings.entityScan.fields.endpoints"),value:(v=(g=t.config)==null?void 0:g.endpoints)!=null&&v.length?e("systemSettings.entityScan.units.endpoints",{count:t.config.endpoints.length}):"-"});break;case"cloud":n.push({label:e("systemSettings.entityScan.fields.endpoint"),value:((z=t.config)==null?void 0:z.endpoint)||"-"},{label:e("systemSettings.entityScan.fields.bucket"),value:((F=t.config)==null?void 0:F.bucket)||"-"});break;case"monitoring":switch(t.subType){case"prometheus":n.push({label:e("systemSettings.entityScan.fields.url"),value:((R=t.config)==null?void 0:R.url)||"-"},{label:e("systemSettings.entityScan.fields.maxSamples"),value:((M=(A=t.config)==null?void 0:A.maxSamples)==null?void 0:M.toString())||"-"});break;case"grafana":n.push({label:e("systemSettings.entityScan.fields.url"),value:((B=t.config)==null?void 0:B.url)||"-"},{label:e("systemSettings.entityScan.fields.orgId"),value:((P=(E=t.config)==null?void 0:E.orgId)==null?void 0:P.toString())||"-"});break;case"elasticsearch":n.push({label:e("systemSettings.entityScan.fields.hosts"),value:(q=(U=t.config)==null?void 0:U.hosts)!=null&&q.length?e("systemSettings.entityScan.units.nodes",{count:t.config.hosts.length}):"-"},{label:e("systemSettings.entityScan.fields.indices"),value:(L=(K=t.config)==null?void 0:K.indices)!=null&&L.length?e("systemSettings.entityScan.units.indices",{count:t.config.indices.length}):"-"});break;case"jaeger":n.push({label:e("systemSettings.entityScan.fields.queryUrl"),value:((V=t.config)==null?void 0:V.queryUrl)||"-"},{label:e("systemSettings.entityScan.fields.services"),value:(W=(G=t.config)==null?void 0:G.services)!=null&&W.length?e("systemSettings.entityScan.units.services",{count:t.config.services.length}):"-"});break;case"zabbix":n.push({label:e("systemSettings.entityScan.fields.url"),value:((O=t.config)==null?void 0:O.url)||"-"},{label:e("systemSettings.entityScan.fields.apiVersion"),value:((N=t.config)==null?void 0:N.apiVersion)||"-"});break;case"datadog":n.push({label:e("systemSettings.entityScan.fields.site"),value:((_=t.config)==null?void 0:_.site)||"-"},{label:e("systemSettings.entityScan.fields.environment"),value:((H=t.config)==null?void 0:H.env)||"-"});break;default:n.push({label:e("systemSettings.entityScan.fields.url"),value:((Q=t.config)==null?void 0:Q.url)||"-"})}break;case"metrics":switch(t.subType){case"influxdb":n.push({label:e("systemSettings.entityScan.fields.url"),value:((J=t.config)==null?void 0:J.url)||"-"},{label:e("systemSettings.entityScan.fields.database"),value:((Z=t.config)==null?void 0:Z.database)||"-"});break}break;case"file":n.push({label:e("systemSettings.entityScan.fields.path"),value:((Y=t.config)==null?void 0:Y.path)||"-"},{label:e("systemSettings.entityScan.fields.format"),value:((X=t.config)==null?void 0:X.format)||"-"});break;default:n.push({label:e("systemSettings.entityScan.fields.description"),value:t.description||"-"})}return n.push({label:e("systemSettings.entityScan.dataSources.lastScan"),value:t.lastScan||e("systemSettings.entityScan.status.neverScanned")},{label:e("systemSettings.entityScan.dataSources.entityCount"),value:e("systemSettings.entityScan.units.entities",{count:t.entityCount||0})}),n},We=t=>{var r,l,m,g,v,z,F,R,A,M,B,E,P,U,q,K,L,V,G,W,O,N,_,H,Q,J,Z,Y,X,Se,he,xe,be,ke;const n=[{key:"name",label:e("systemSettings.entityScan.fields.name"),value:t.name},{key:"type",label:e("systemSettings.entityScan.fields.type"),value:t.type},{key:"subType",label:e("systemSettings.entityScan.fields.subType"),value:t.subType},{key:"status",label:e("systemSettings.entityScan.fields.status"),value:t.status,isStatus:!0},{key:"description",label:e("systemSettings.entityScan.fields.description"),value:t.description}],c=[];switch(t.type){case"database":c.push({key:"host",label:e("systemSettings.entityScan.fields.host"),value:`${(r=t.config)==null?void 0:r.host}:${(l=t.config)==null?void 0:l.port}`},{key:"database",label:e("systemSettings.entityScan.fields.database"),value:((m=t.config)==null?void 0:m.database)||"-"},{key:"username",label:e("systemSettings.entityScan.fields.username"),value:(g=t.config)==null?void 0:g.username});break;case"api":c.push({key:"baseUrl",label:e("systemSettings.entityScan.fields.baseUrl"),value:(v=t.config)==null?void 0:v.baseUrl},{key:"endpoints",label:e("systemSettings.entityScan.fields.endpoints"),value:(z=t.config)==null?void 0:z.endpoints,isArray:!0},{key:"apiKey",label:e("systemSettings.entityScan.fields.apiKey"),value:(F=t.config)!=null&&F.apiKey?"***hidden***":"-"});break;case"cloud":c.push({key:"endpoint",label:e("systemSettings.entityScan.fields.endpoint"),value:(R=t.config)==null?void 0:R.endpoint},{key:"bucket",label:e("systemSettings.entityScan.fields.bucket"),value:(A=t.config)==null?void 0:A.bucket},{key:"accessKeyId",label:e("systemSettings.entityScan.fields.accessKeyId"),value:(M=t.config)!=null&&M.accessKeyId?"***hidden***":"-"});break;case"monitoring":switch(t.subType){case"prometheus":c.push({key:"url",label:e("systemSettings.entityScan.fields.url"),value:(B=t.config)==null?void 0:B.url},{key:"timeout",label:e("systemSettings.entityScan.fields.timeout"),value:`${((E=t.config)==null?void 0:E.timeout)||0}ms`},{key:"maxSamples",label:e("systemSettings.entityScan.fields.maxSamples"),value:(P=t.config)==null?void 0:P.maxSamples});break;case"grafana":c.push({key:"url",label:e("systemSettings.entityScan.fields.url"),value:(U=t.config)==null?void 0:U.url},{key:"orgId",label:e("systemSettings.entityScan.fields.orgId"),value:(q=t.config)==null?void 0:q.orgId},{key:"includeDashboards",label:e("systemSettings.entityScan.fields.includeDashboards"),value:(K=t.config)!=null&&K.includeDashboards?e("common.yes"):e("common.no")});break;case"elasticsearch":c.push({key:"hosts",label:e("systemSettings.entityScan.fields.hosts"),value:(L=t.config)==null?void 0:L.hosts,isArray:!0},{key:"indices",label:e("systemSettings.entityScan.fields.indices"),value:(V=t.config)==null?void 0:V.indices,isArray:!0},{key:"version",label:e("systemSettings.entityScan.fields.version"),value:(G=t.config)==null?void 0:G.version});break;case"jaeger":c.push({key:"queryUrl",label:e("systemSettings.entityScan.fields.queryUrl"),value:(W=t.config)==null?void 0:W.queryUrl},{key:"services",label:e("systemSettings.entityScan.fields.services"),value:(O=t.config)==null?void 0:O.services,isArray:!0},{key:"lookback",label:e("systemSettings.entityScan.fields.lookback"),value:(N=t.config)==null?void 0:N.lookback});break;case"zabbix":c.push({key:"url",label:e("systemSettings.entityScan.fields.url"),value:(_=t.config)==null?void 0:_.url},{key:"apiVersion",label:e("systemSettings.entityScan.fields.apiVersion"),value:(H=t.config)==null?void 0:H.apiVersion},{key:"hostGroups",label:e("systemSettings.entityScan.fields.hostGroups"),value:(Q=t.config)==null?void 0:Q.hostGroups,isArray:!0});break;case"datadog":c.push({key:"site",label:e("systemSettings.entityScan.fields.site"),value:(J=t.config)==null?void 0:J.site},{key:"services",label:e("systemSettings.entityScan.fields.services"),value:(Z=t.config)==null?void 0:Z.services,isArray:!0},{key:"env",label:e("systemSettings.entityScan.fields.environment"),value:(Y=t.config)==null?void 0:Y.env});break}break;case"metrics":switch(t.subType){case"influxdb":c.push({key:"url",label:e("systemSettings.entityScan.fields.url"),value:(X=t.config)==null?void 0:X.url},{key:"database",label:e("systemSettings.entityScan.fields.database"),value:(Se=t.config)==null?void 0:Se.database},{key:"retention",label:e("systemSettings.entityScan.fields.retention"),value:(he=t.config)==null?void 0:he.retention});break}break;case"file":c.push({key:"path",label:e("systemSettings.entityScan.fields.path"),value:(xe=t.config)==null?void 0:xe.path},{key:"format",label:e("systemSettings.entityScan.fields.format"),value:(be=t.config)==null?void 0:be.format},{key:"encoding",label:e("systemSettings.entityScan.fields.encoding"),value:((ke=t.config)==null?void 0:ke.encoding)||"UTF-8"});break}return[...n,...c]},Oe=t=>{if(t.isStatus){const n=pe(t.value);return s.jsx(we,{status:n.color,text:n.text})}return t.isArray&&Array.isArray(t.value)?t.value.join(", "):t.value||"-"},Ne=t=>{const n=We(t);te.info({title:`${e("systemSettings.entityScan.dataSources.details")} - ${t.name}`,width:600,content:s.jsx("div",{style:{marginTop:16},children:s.jsx(ee,{gutter:[16,8],children:n.map(c=>s.jsxs(Xe.Fragment,{children:[s.jsx(y,{span:8,children:s.jsxs("strong",{children:[c.label,":"]})}),s.jsx(y,{span:16,children:Oe(c)})]},c.key))})})})},_e=t=>{x.info("编辑数据源功能开发中...")},He=async t=>{try{f(r=>r.map(l=>l.id===t.id?{...l,status:"connecting"}:l)),await new Promise(r=>setTimeout(r,2e3));const n=Math.random()>.3,c=n?"connected":"error";f(r=>r.map(l=>l.id===t.id?{...l,status:c,lastConnected:n?new Date().toLocaleString():l.lastConnected}:l)),x[n?"success":"error"](e(n?"systemSettings.entityScan.messages.connectionTestSuccess":"systemSettings.entityScan.messages.connectionTestFailed"))}catch{f(c=>c.map(r=>r.id===t.id?{...r,status:"error"}:r)),x.error(e("systemSettings.entityScan.messages.connectionTestFailed"))}},Qe=t=>{if(t.status!=="connected"){x.warning(e("systemSettings.entityScan.messages.ensureConnectionFirst"));return}a(`/system-settings/entity-scan/${t.id}`)},Je=t=>{te.confirm({title:e("common.confirmDelete"),content:e("systemSettings.entityScan.messages.confirmDeleteDataSource",{name:t.name}),okText:e("common.delete"),okType:"danger",cancelText:e("common.cancel"),onOk:()=>{f(n=>n.filter(c=>c.id!==t.id)),x.success(e("systemSettings.entityScan.messages.dataSourceDeleted"))}})},Ze=async()=>{try{x.loading(e("systemSettings.entityScan.messages.refreshingDataSources"),1),await oe(),x.success(e("systemSettings.entityScan.messages.refreshSuccess"))}catch{x.error(e("systemSettings.entityScan.messages.refreshFailed"))}},Ye=()=>{te.info({title:e("systemSettings.entityScan.dataSources.addDataSource"),width:800,content:s.jsxs("div",{style:{marginTop:16},children:[s.jsx(ie,{message:e("systemSettings.entityScan.messages.dataSourceConfigFeature"),description:e("systemSettings.entityScan.messages.featureInDevelopment"),type:"info",showIcon:!0,style:{marginBottom:16}}),s.jsxs("div",{style:{padding:"20px 0",textAlign:"center",color:"#8c8c8c"},children:[s.jsx(ae,{style:{fontSize:"48px",marginBottom:"16px"}}),s.jsx("div",{children:e("systemSettings.entityScan.messages.configWizardComingSoon")}),s.jsx("div",{style:{fontSize:"12px",marginTop:"8px"},children:e("systemSettings.entityScan.messages.wizardFeatures")})]})]}),okText:"知道了"})},fe=[{title:"选择",dataIndex:"selected",key:"selected",render:(t,n)=>s.jsx(lt,{checked:t,onChange:c=>{Fe(r=>r.map(l=>l.id===n.id?{...l,selected:c}:l))}})},{title:"实体名称",dataIndex:"name",key:"name",render:(t,n)=>s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:"bold"},children:t}),s.jsxs(k,{type:"secondary",style:{fontSize:"12px"},children:["来源: ",n.source]})]})},{title:"实体类型",dataIndex:"type",key:"type"},{title:"置信度",dataIndex:"confidence",key:"confidence",render:t=>s.jsx("div",{children:s.jsx(je,{percent:Math.round(t*100),size:"small",status:t>.9?"success":t>.7?"normal":"exception"})})},{title:"属性数量",dataIndex:"attributes",key:"attributes",render:t=>Object.keys(t).length}];return s.jsxs(wt,{children:[s.jsxs($t,{children:[s.jsxs(Ct,{children:[s.jsxs(Ie,{level:2,style:{margin:0},children:[s.jsx(ve,{})," ",e("systemSettings.entityScan.title","实体扫描")]}),s.jsx(Dt,{style:{margin:"8px 0 0 0",color:o?"rgba(255, 255, 255, 0.65)":"rgba(0, 0, 0, 0.65)"},children:e("systemSettings.entityScan.description","从外部数据源扫描和生成实体定义，支持数据库、API、云服务等多种数据源类型。")})]}),s.jsxs(Tt,{children:[s.jsx(b,{icon:s.jsx(le,{}),onClick:Ze,title:e("systemSettings.entityScan.dataSources.refreshDataSources"),children:e("common.refresh")}),s.jsx(b,{type:"primary",icon:s.jsx(at,{}),onClick:Ye,children:e("systemSettings.entityScan.dataSources.addDataSource")})]})]}),s.jsx(It,{$isDark:o,title:e("systemSettings.entityScan.stats.title"),children:s.jsxs(ee,{gutter:[16,16],children:[s.jsx(y,{xs:12,sm:8,lg:4,children:s.jsxs($,{$isDark:o,children:[s.jsx(C,{color:"#1890ff",children:w().totalDataSources}),s.jsx(T,{$isDark:o,children:e("systemSettings.entityScan.stats.totalDataSources")})]})}),s.jsx(y,{xs:12,sm:8,lg:4,children:s.jsxs($,{$isDark:o,children:[s.jsx(C,{color:"#52c41a",children:w().connectedDataSources}),s.jsx(T,{$isDark:o,children:e("systemSettings.entityScan.stats.connectedSources")})]})}),s.jsx(y,{xs:12,sm:8,lg:4,children:s.jsxs($,{$isDark:o,children:[s.jsx(C,{color:"#722ed1",children:w().totalEntities}),s.jsx(T,{$isDark:o,children:e("systemSettings.entityScan.stats.totalEntities")})]})}),s.jsx(y,{xs:12,sm:8,lg:4,children:s.jsxs($,{$isDark:o,children:[s.jsx(C,{color:"#fa8c16",children:w().selectedEntities}),s.jsx(T,{$isDark:o,children:e("systemSettings.entityScan.stats.selectedEntities")})]})}),s.jsx(y,{xs:12,sm:8,lg:4,children:s.jsxs($,{$isDark:o,children:[s.jsx(C,{color:"#13c2c2",children:w().completedScans}),s.jsx(T,{$isDark:o,children:e("systemSettings.entityScan.stats.completedScans")})]})}),s.jsx(y,{xs:12,sm:8,lg:4,children:s.jsxs($,{$isDark:o,children:[s.jsx(C,{color:"#eb2f96",children:w().runningScans}),s.jsx(T,{$isDark:o,children:e("systemSettings.entityScan.stats.runningScans")})]})})]})}),s.jsx(bt,{searchValue:D,onSearchChange:Be,searchPlaceholder:e("systemSettings.entityScan.dataSources.searchPlaceholder"),filters:[{key:"type",value:se,onChange:Ee,placeholder:e("systemSettings.entityScan.dataSources.filterByType"),width:120,options:[{value:"all",label:e("systemSettings.entityScan.dataSources.allTypes")},{value:"database",label:e("systemSettings.entityScan.dataSources.types.database")},{value:"api",label:e("systemSettings.entityScan.dataSources.types.api")},{value:"cloud",label:e("systemSettings.entityScan.dataSources.types.cloud")},{value:"monitoring",label:e("systemSettings.entityScan.dataSources.types.monitoring")},{value:"metrics",label:e("systemSettings.entityScan.dataSources.types.metrics")},{value:"file",label:e("systemSettings.entityScan.dataSources.types.file")}]},{key:"status",value:ne,onChange:Pe,placeholder:e("systemSettings.entityScan.dataSources.filterByStatus"),width:100,options:[{value:"all",label:e("systemSettings.entityScan.dataSources.allStatuses")},{value:"connected",label:e("systemSettings.entityScan.dataSources.connected")},{value:"disconnected",label:e("systemSettings.entityScan.dataSources.disconnected")},{value:"connecting",label:e("systemSettings.entityScan.dataSources.connecting")},{value:"error",label:e("systemSettings.entityScan.dataSources.error")}]}],onRefresh:()=>oe(),style:{marginBottom:24}}),s.jsx(ee,{gutter:[16,16],style:{marginBottom:24},children:Ve()}),me().length===0&&s.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:o?"rgba(255, 255, 255, 0.45)":"rgba(0, 0, 0, 0.45)",marginBottom:24},children:[s.jsx(ae,{style:{fontSize:"48px",marginBottom:"16px"}}),s.jsx("div",{children:e("systemSettings.entityScan.dataSources.noDataSources")}),s.jsx("div",{style:{fontSize:"12px",marginTop:"8px"},children:e(D||se!=="all"||ne!=="all"?"systemSettings.entityScan.dataSources.noMatchingDataSources":"systemSettings.entityScan.dataSources.configureDataSourcesFirst")})]}),h&&s.jsx(ze,{$isDark:o,title:"扫描进度",children:s.jsxs(ee,{gutter:16,children:[s.jsxs(y,{span:12,children:[s.jsxs("div",{style:{marginBottom:16},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[s.jsx(k,{strong:!0,children:h.name}),qe(h.status)]}),s.jsx(je,{percent:h.progress,status:h.status==="failed"?"exception":"active"})]}),s.jsxs(ee,{gutter:16,children:[s.jsx(y,{span:8,children:s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1890ff"},children:h.scannedCount}),s.jsx(k,{type:"secondary",children:e("systemSettings.entityScan.progress.scanned")})]})}),s.jsx(y,{span:8,children:s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:h.generatedCount}),s.jsx(k,{type:"secondary",children:e("systemSettings.entityScan.progress.generated")})]})}),s.jsx(y,{span:8,children:s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#ff4d4f"},children:h.errorCount}),s.jsx(k,{type:"secondary",children:"错误"})]})})]})]}),s.jsx(y,{span:12,children:s.jsxs("div",{style:{height:"200px",overflow:"auto",background:o?"#1f1f1f":"#fafafa",padding:"12px",borderRadius:"6px"},children:[s.jsx(k,{strong:!0,children:"扫描日志:"}),h.logs.map((t,n)=>s.jsxs("div",{style:{fontSize:"12px",marginTop:"4px"},children:[s.jsxs(k,{type:"secondary",children:["[",new Date().toLocaleTimeString(),"]"]})," ",t]},n))]})})]})}),S.length>0&&s.jsxs(ze,{$isDark:o,title:"扫描结果",children:[s.jsx("div",{style:{marginBottom:16},children:s.jsx(ie,{message:e("systemSettings.entityScan.results.scanCompleted",{total:S.length,selected:S.filter(t=>t.selected).length}),type:"success",showIcon:!0,action:s.jsx(b,{size:"small",type:"primary",onClick:()=>ce(!0),children:"生成实体"})})}),s.jsx(De,{dataSource:S,columns:fe,rowKey:"id",pagination:!1,size:"small"})]}),s.jsx(te,{title:"数据源配置",open:Re,onCancel:()=>Ae(!1),footer:null,width:600,children:s.jsx(ie,{message:"数据源配置功能",description:"在这里可以配置数据源的连接参数、认证信息、扫描规则等。",type:"info",showIcon:!0})}),s.jsxs(te,{title:e("systemSettings.entityScan.results.confirmGenerate"),open:Me,onCancel:()=>ce(!1),onOk:()=>{const t=S.filter(n=>n.selected).length;x.success(e("systemSettings.entityScan.messages.entitiesGenerated",{count:t})),ce(!1)},width:800,children:[s.jsx(ie,{message:e("systemSettings.entityScan.results.willGenerate",{count:S.filter(t=>t.selected).length}),description:e("systemSettings.entityScan.results.generateDescription"),type:"info",showIcon:!0,style:{marginBottom:16}}),s.jsx(De,{dataSource:S.filter(t=>t.selected),columns:fe.filter(t=>t.key!=="selected"),rowKey:"id",pagination:!1,size:"small"})]})]})};export{os as default};

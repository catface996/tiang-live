var G=Object.defineProperty;var J=(s,e,t)=>e in s?G(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var w=(s,e,t)=>J(s,typeof e!="symbol"?e+"":e,t);import{a as x,j as n}from"./react-BkaC_jdz.js";import{s as K}from"./index-Daowydkz.js";import{g as j,a as W,u as Q,s as X,b as Y,c as Z}from"./index-Bna1uyxb.js";import{aC as y,u as z,_ as H,c as ee,az as F,a1 as U,ap as te,S,a3 as _,B as L,aI as ne,T as q,ai as ae,b5 as se,d as $,e as re,a_ as ie,ah as P,y as le}from"./react-dom-ZHUlsYA_.js";const I={1:{gradient:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",primary:"#4facfe",secondary:"#00f2fe",light:"#e6f7ff",name:"L1层级"},2:{gradient:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",primary:"#f093fb",secondary:"#f5576c",light:"#fff0f6",name:"L2层级"},3:{gradient:"linear-gradient(135deg, #45b7d1 0%, #96c93d 100%)",primary:"#45b7d1",secondary:"#96c93d",light:"#f0f9ff",name:"L3层级"},4:{gradient:"linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%)",primary:"#4ecdc4",secondary:"#44a08d",light:"#e6fffb",name:"L4层级"},5:{gradient:"linear-gradient(135deg, #ffd700 0%, #ffb347 100%)",primary:"#ffd700",secondary:"#ffb347",light:"#fffbe6",name:"L5层级"},6:{gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",primary:"#667eea",secondary:"#764ba2",light:"#f0f2ff",name:"L6层级"},7:{gradient:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",primary:"#f093fb",secondary:"#f5576c",light:"#fff0f6",name:"L7层级"},8:{gradient:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",primary:"#43e97b",secondary:"#38f9d7",light:"#f0fff4",name:"L8层级"},9:{gradient:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)",primary:"#fa709a",secondary:"#fee140",light:"#fff5f5",name:"L9层级"},10:{gradient:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)",primary:"#a8edea",secondary:"#fed6e3",light:"#f0ffff",name:"L10层级"}},V=s=>{const t={infrastructure:1,middleware:2,"business-system":3,"business-chain":4,"business-scenario":5}[s]||1;return I[t]},B=s=>I[s]||I[1],je=s=>B(s).gradient,Se=s=>V(s).primary,Le=s=>V(s).light,oe="https://api.ai-ops.com/api/v1";class ce{constructor(e=oe){w(this,"baseURL");this.baseURL=e}async request(e,t={}){const i=localStorage.getItem("auth_token"),c={...t,headers:{"Content-Type":"application/json",...i&&{Authorization:`Bearer ${i}`},...t.headers}};try{const l=await fetch(`${this.baseURL}${e}`,c);if(!l.ok){const a=await l.json().catch(()=>({}));throw{code:l.status.toString(),message:a.message||l.statusText||"请求失败",details:a,timestamp:new Date().toISOString()}}const o=await l.json();return o.data!==void 0?o.data:o}catch(l){throw l instanceof Error&&!l.code?{code:"NETWORK_ERROR",message:l.message||"网络请求失败",details:l,timestamp:new Date().toISOString()}:l}}async get(e,t){const i=t?new URLSearchParams(t).toString():"",c=i?`${e}?${i}`:e;return this.request(c,{method:"GET"})}async post(e,t){return this.request(e,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t){return this.request(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}async patch(e,t){return this.request(e,{method:"PATCH",body:t?JSON.stringify(t):void 0})}async delete(e){return this.request(e,{method:"DELETE"})}}const de=new ce;class pe{constructor(e){w(this,"baseURL");w(this,"client");this.baseURL=e,this.client=de}async get(e,t){return this.client.get(`${this.baseURL}${e}`,t==null?void 0:t.params)}async post(e,t){return this.client.post(`${this.baseURL}${e}`,t)}async put(e,t){return this.client.put(`${this.baseURL}${e}`,t)}async patch(e,t){return this.client.patch(`${this.baseURL}${e}`,t)}async delete(e){return this.client.delete(`${this.baseURL}${e}`)}}const T=async s=>{try{const e=await fetch(s);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){throw console.error(`Failed to fetch data from ${s}:`,e),e}},E={async getPlaneDefinitions(s){const t=`${j()}/api/v1/planes.json`;return await T(t)},async getPlaneTopology(){const e=`${j()}/api/v1/planes/topology.json`;return await T(e)},async getPlaneMetrics(){const e=`${j()}/api/v1/planes/metrics.json`;return await T(e)},async getPlaneById(s){const t=`${j()}/api/v1/planes.json`,c=(await T(t)).data.find(l=>l.id===s);if(!c)throw new Error(`Plane with id ${s} not found`);return{success:!0,data:c}}};class he extends pe{constructor(){super("/planes")}async getPlaneDefinitions(e){return E.getPlaneDefinitions(e)}async getPlaneDefinition(e){return(await E.getPlaneById(e)).data}async createPlaneDefinition(e){{const t={id:`plane-${Date.now()}`,name:e.name||"new-plane",displayName:e.displayName||"New Plane",description:e.description||"New plane description",level:e.level||1,dependencies:e.dependencies||[],entityHealth:{healthy:0,warning:0,error:0,total:0},config:e.config||{icon:"📋",color:"#1890ff",theme:"default",maxInstances:10,autoScaling:!1,monitoring:{enabled:!0,alertThreshold:80},security:{accessControl:!0,encryption:!1},healthThresholds:{warningThreshold:.2,errorThreshold:.1}},status:"ACTIVE",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...e};return Promise.resolve(t)}}async updatePlaneDefinition(e,t){{const c={...await this.getPlaneDefinition(e),...t,updatedAt:new Date().toISOString()};return Promise.resolve(c)}}async deletePlaneDefinition(e){return Promise.resolve()}async getPlaneTopology(){return(await E.getPlaneTopology()).data}async getPlaneMetrics(e,t){return(await E.getPlaneMetrics()).data.planeMetrics||[]}async getAllPlanesMetrics(){return(await E.getPlaneMetrics()).data.planeMetrics||[]}async getPlaneInstances(e,t){const i=[{id:`instance-${e}-1`,name:`${e}-instance-1`,planeDefinitionId:e,metadata:{region:"us-east-1",environment:"production"},properties:{version:"1.0.0",replicas:3},status:"RUNNING",entityHealth:{healthy:10,warning:2,error:0,total:12},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}];return Promise.resolve({data:i,total:i.length,page:(t==null?void 0:t.page)||1,pageSize:(t==null?void 0:t.pageSize)||10})}async createPlaneInstance(e){const t={id:`instance-${Date.now()}`,name:e.name||"new-instance",planeDefinitionId:e.planeDefinitionId||"",metadata:e.metadata||{},properties:e.properties||{},status:"RUNNING",entityHealth:{healthy:0,warning:0,error:0,total:0},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...e};return Promise.resolve(t)}async executePlaneOperation(e,t){return Promise.resolve({operationId:`op-${Date.now()}`,planeId:e,operation:t.type,status:"SUCCESS",message:`Operation ${t.type} completed successfully`,startTime:new Date().toISOString(),endTime:new Date().toISOString(),result:{success:!0}})}}const A=new he,{Title:M,Text:D}=ee,{TextArea:me}=F,{Option:v}=U,ue=$.div`
  max-width: 800px;
  margin: 0 auto;
  padding: 24px;
`,ge=$(H)`
  margin-top: 16px;
  border: 2px solid #e8e8e8;
  width: 100%;
  margin-left: auto;
  margin-right: auto;
  
  .ant-card-head {
    background: ${s=>B(s.$level).gradient};
    border-bottom: none;
    
    .ant-card-head-title {
      color: white;
      font-weight: bold;
    }
  }
`,fe=$(_)`
  margin: 2px;
  border-radius: 12px;
`,ye=({mode:s,initialData:e,existingPlanes:t=[],onSubmit:i,onCancel:c,loading:l=!1})=>{const[o]=y.useForm(),{t:a}=z(["planes","common"]),[p,m]=x.useState(1),[h,u]=x.useState([]);x.useEffect(()=>{e&&(o.setFieldsValue({name:e.name,displayName:e.displayName,description:e.description,level:e.level||1,dependencies:e.dependencies||[]}),m(e.level||1),u(e.dependencies||[]))},[e,o]);const N=r=>{m(r),o.setFieldValue("dependencies",[]),u([])},O=r=>{u(r)},C=()=>t.filter(r=>r.level<p),d=async r=>{var f;try{const b={name:r.name,displayName:r.displayName,description:r.description,level:r.level,dependencies:r.dependencies||[],config:{icon:g(r.level),color:((f=I[r.level])==null?void 0:f.primary)||"#1890ff",theme:r.name,maxInstances:100,autoScaling:!1,monitoring:{enabled:!0,alertThreshold:80},security:{accessControl:!0,encryption:!1},healthThresholds:{warningThreshold:.2,errorThreshold:.1}}};s==="edit"&&(e!=null&&e.id)&&(b.id=e.id),await i(b)}catch(b){console.error("Form submission error:",b)}},g=r=>({1:"🏗️",2:"⚙️",3:"💼",4:"🔗",5:"🎯",6:"🌟",7:"🚀",8:"💎",9:"🎨",10:"👑"})[r]||"📋",R=()=>{s==="edit"&&e?(o.setFieldsValue({name:e.name,displayName:e.displayName,description:e.description,level:e.level||1,dependencies:e.dependencies||[]}),m(e.level||1),u(e.dependencies||[])):(o.resetFields(),m(1),u([]))};return n.jsx(ue,{children:n.jsx(H,{title:n.jsxs(S,{children:[a(s==="create"?"planes:createEdit.createTitle":"planes:createEdit.editTitle"),n.jsx(q,{title:a("planes:createEdit.formLabels.levelHelp"),children:n.jsx(se,{style:{color:"#1890ff"}})})]}),extra:n.jsxs(S,{children:[n.jsx(q,{title:a("planes:createEdit.buttons.reset"),children:n.jsx(L,{onClick:R,icon:n.jsx(ae,{}),children:a("planes:createEdit.buttons.reset")})}),n.jsx(L,{onClick:c,children:a("planes:createEdit.buttons.cancel")})]}),children:n.jsxs(y,{form:o,layout:"vertical",onFinish:d,initialValues:{level:1},children:[n.jsxs("div",{children:[n.jsx(M,{level:4,children:a("planes:form.basicInfo")}),n.jsx(y.Item,{name:"name",label:a("planes:createEdit.formLabels.planeName"),rules:[{required:!0,message:a("planes:createEdit.validation.planeNameRequired")},{pattern:/^[a-z0-9-]+$/,message:"Only lowercase letters, numbers and hyphens are allowed"}],extra:a("planes:createEdit.formLabels.planeNameHelp"),children:n.jsx(F,{placeholder:a("planes:createEdit.formLabels.planeNamePlaceholder")})}),n.jsx(y.Item,{name:"displayName",label:a("planes:createEdit.formLabels.displayName"),rules:[{required:!0,message:a("planes:createEdit.validation.displayNameRequired")}],extra:a("planes:createEdit.formLabels.displayNameHelp"),children:n.jsx(F,{placeholder:a("planes:createEdit.formLabels.displayNamePlaceholder")})}),n.jsx(y.Item,{name:"description",label:a("planes:createEdit.formLabels.description"),rules:[{required:!0,message:a("planes:createEdit.validation.descriptionRequired")}],children:n.jsx(me,{rows:4,placeholder:a("planes:createEdit.formLabels.descriptionPlaceholder")})}),n.jsx(y.Item,{name:"level",label:a("planes:createEdit.formLabels.level"),rules:[{required:!0,message:a("planes:createEdit.validation.levelRequired")}],extra:a("planes:createEdit.formLabels.levelHelp"),children:n.jsxs(U,{onChange:N,children:[n.jsx(v,{value:1,children:a("planes:createEdit.levelOptions.1")}),n.jsx(v,{value:2,children:a("planes:createEdit.levelOptions.2")}),n.jsx(v,{value:3,children:a("planes:createEdit.levelOptions.3")}),n.jsx(v,{value:4,children:a("planes:createEdit.levelOptions.4")}),n.jsx(v,{value:5,children:a("planes:createEdit.levelOptions.5")})]})}),n.jsx(y.Item,{name:"dependencies",label:a("planes:createEdit.formLabels.dependencies"),extra:a("planes:createEdit.formLabels.dependenciesHelp"),children:n.jsx(U,{mode:"multiple",placeholder:a("planes:createEdit.formLabels.dependencies"),onChange:O,disabled:p===1,children:C().map(r=>n.jsxs(v,{value:r.id,children:["L",r.level," - ",r.displayName]},r.id))})}),p===1&&n.jsx(te,{message:a("planes:createEdit.levelOptions.1")+" "+a("planes:createEdit.formLabels.dependenciesHelp"),type:"info",showIcon:!0,style:{marginBottom:16}})]}),n.jsxs("div",{style:{marginTop:32},children:[n.jsx(M,{level:4,children:a("planes:createEdit.preview.title")}),n.jsx(D,{type:"secondary",style:{display:"block",marginBottom:16},children:a("planes:createEdit.preview.subtitle")}),n.jsxs(ge,{$level:p,title:n.jsxs(S,{children:[n.jsx("span",{children:g(p)}),n.jsx("span",{children:o.getFieldValue("displayName")||a("planes:createEdit.formLabels.displayName")}),n.jsxs(_,{color:"white",style:{color:B(p).primary},children:["L",p]})]}),size:"small",children:[n.jsx(D,{type:"secondary",children:o.getFieldValue("description")||a("planes:createEdit.formLabels.descriptionPlaceholder")}),h.length>0&&n.jsxs("div",{style:{marginTop:12},children:[n.jsxs(D,{strong:!0,children:[a("planes:createEdit.preview.dependencies"),": "]}),h.map(r=>{const f=t.find(b=>b.id===r);return f?n.jsxs(fe,{$planeId:r,color:"blue",children:["L",f.level," - ",f.displayName]},r):null})]})]})]}),n.jsx("div",{style:{textAlign:"center",marginTop:24},children:n.jsxs(S,{size:"large",children:[n.jsx(L,{onClick:c,size:"large",children:a("planes:createEdit.buttons.cancel")}),n.jsx(L,{type:"primary",htmlType:"submit",icon:n.jsx(ne,{}),loading:l,size:"large",children:a(s==="create"?"planes:createEdit.createTitle":"planes:createEdit.buttons.save")})]})})]})})})},k=$.div`
  min-height: 100vh;
  background: #f5f5f5;
  padding: 24px 0;
`,be=()=>{const s=re(),{id:e}=ie(),t=W(),{t:i}=z(["planes","common"]),{definitions:c,loading:l}=Q(d=>d.plane),[o,a]=x.useState(null),[p,m]=x.useState(!1),h=!!e,u=h?"edit":"create";x.useEffect(()=>{K(i(h?"planes.createEdit.editTitle":"planes.createEdit.createTitle")),N()},[e,i]);const N=async()=>{try{t(X({type:"definitions",loading:!0}));const d=await A.getPlaneDefinitions();if(t(Y(d.data)),h&&e){const g=d.data.find(R=>R.id===e);g?a(g):(P.error(i("planes.createEdit.planeNotFound")),s("/planes"))}}catch(d){t(Z({type:"definitions",error:d.message||i("planes.createEdit.loadDataFailed")})),P.error(i("planes.createEdit.loadDataFailed"))}},O=async d=>{m(!0);try{h&&e?(await A.updatePlaneDefinition(e,d),P.success(i("planes.createEdit.updateSuccess"))):(await A.createPlaneDefinition(d),P.success(i("planes.createEdit.createSuccess"))),s("/planes")}catch(g){P.error(g.message||i(`planes.createEdit.${h?"updateFailed":"createFailed"}`))}finally{m(!1)}},C=()=>{s("/planes")};return l.definitions?n.jsx(k,{children:n.jsxs("div",{style:{textAlign:"center",paddingTop:"20vh"},children:[n.jsx(le,{size:"large"}),n.jsx("div",{style:{marginTop:16,color:"#666"},children:i("planes.createEdit.loadingData")})]})}):n.jsx(k,{children:n.jsx(ye,{mode:u,initialData:o||void 0,existingPlanes:c,onSubmit:O,onCancel:C,loading:p})})},Te=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{be as P,Se as a,Le as b,Te as c,je as g,A as p};

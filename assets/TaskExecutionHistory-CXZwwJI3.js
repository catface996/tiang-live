import{u as Y,a as q,b as K,j as e,d as S}from"./index-BoaK5Cbd.js";import{r,K as T,N as p,O as Q,P as C,T as V,d as _,C as m,j as f,Q as J,D as U,L as R,k as v,u as w,U as I,V as X,W as G,s as Z,X as ee,Y as te,a as se,m as ae}from"./antd-CAFIM9ev.js";import{s as re}from"./index-Daowydkz.js";import{S as ie}from"./SearchFilterBar-AJ-ixr8L.js";import"./Breadcrumb-Bi6Eb3lZ.js";import"./vendor-DJG_os-6.js";const{Title:N,Text:x}=V,{Option:ye}=ae,{RangePicker:le}=U,ne=S.div`
  padding: 24px;
  background: #f5f5f5;
  min-height: 100vh;
`,oe=S.div`
  background: white;
  border-radius: 8px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
`,ce=S(f)`
  margin-bottom: 8px;
  border-radius: 6px;
  
  &.completed {
    border-left: 4px solid #52c41a;
  }
  
  &.running {
    border-left: 4px solid #1890ff;
  }
  
  &.scheduled {
    border-left: 4px solid #faad14;
  }
  
  &.failed {
    border-left: 4px solid #ff4d4f;
  }
`,d=[{id:"exec_001",taskCollectionId:"1",taskCollectionName:"核心业务系统健康检查",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-26 10:00:00",endTime:"2025-06-26 10:15:30",duration:930,executedTargets:8,totalTargets:8,successRate:100,details:{targets:[{id:"entity_001",name:"用户管理系统",type:"entity",status:"success",actions:[{id:"health_check",name:"健康检查",status:"success",duration:120},{id:"performance_analysis",name:"性能分析",status:"success",duration:180}]}]}},{id:"exec_002",taskCollectionId:"2",taskCollectionName:"数据库性能监控",status:"running",triggerType:"hook",triggerSource:"API调用",startTime:"2025-06-26 14:30:00",endTime:null,duration:null,executedTargets:3,totalTargets:5,successRate:75,details:null},{id:"exec_003",taskCollectionId:"3",taskCollectionName:"安全扫描任务",status:"scheduled",triggerType:"cron",triggerSource:null,startTime:"2025-06-26 23:00:00",endTime:null,duration:null,executedTargets:0,totalTargets:6,successRate:0,details:null},{id:"exec_004",taskCollectionId:"1",taskCollectionName:"核心业务系统健康检查",status:"failed",triggerType:"cron",triggerSource:null,startTime:"2025-06-25 15:00:00",endTime:"2025-06-25 15:08:45",duration:525,executedTargets:5,totalTargets:8,successRate:62.5,details:{targets:[{id:"entity_002",name:"订单管理系统",type:"entity",status:"failed",actions:[{id:"health_check",name:"健康检查",status:"failed",duration:60}]}]}},{id:"exec_005",taskCollectionId:"4",taskCollectionName:"网络安全巡检",status:"completed",triggerType:"hook",triggerSource:"Webhook触发",startTime:"2025-06-24 10:30:00",endTime:"2025-06-24 11:45:20",duration:4520,executedTargets:12,totalTargets:12,successRate:100,details:{targets:[{id:"entity_003",name:"防火墙系统",type:"entity",status:"success",actions:[{id:"security_scan",name:"安全扫描",status:"success",duration:300}]}]}},{id:"exec_006",taskCollectionId:"2",taskCollectionName:"数据库性能监控",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-23 18:00:00",endTime:"2025-06-23 18:25:15",duration:1515,executedTargets:5,totalTargets:5,successRate:100,details:{targets:[{id:"entity_004",name:"MySQL主库",type:"entity",status:"success",actions:[{id:"performance_analysis",name:"性能分析",status:"success",duration:240}]}]}},{id:"exec_007",taskCollectionId:"5",taskCollectionName:"备份验证任务",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-22 02:00:00",endTime:"2025-06-22 02:45:30",duration:2730,executedTargets:3,totalTargets:3,successRate:100,details:{targets:[{id:"sequence_001",name:"数据备份流程",type:"sequence",status:"success",actions:[{id:"backup_verify",name:"备份验证",status:"success",duration:600}]}]}},{id:"exec_008",taskCollectionId:"6",taskCollectionName:"日志分析任务",status:"failed",triggerType:"hook",triggerSource:"监控告警触发",startTime:"2025-06-21 16:20:00",endTime:"2025-06-21 16:35:15",duration:915,executedTargets:2,totalTargets:4,successRate:50,details:{targets:[{id:"entity_005",name:"应用日志系统",type:"entity",status:"failed",actions:[{id:"log_analysis",name:"日志分析",status:"failed",duration:180}]}]}},{id:"exec_009",taskCollectionId:"7",taskCollectionName:"容器健康检查",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-20 09:00:00",endTime:"2025-06-20 09:12:30",duration:750,executedTargets:15,totalTargets:15,successRate:100,details:{targets:[{id:"entity_006",name:"Kubernetes集群",type:"entity",status:"success",actions:[{id:"health_check",name:"健康检查",status:"success",duration:90}]}]}},{id:"exec_010",taskCollectionId:"8",taskCollectionName:"API接口监控",status:"running",triggerType:"hook",triggerSource:"手动触发",startTime:"2025-06-26 15:45:00",endTime:null,duration:null,executedTargets:6,totalTargets:10,successRate:85,details:null},{id:"exec_011",taskCollectionId:"1",taskCollectionName:"核心业务系统健康检查",status:"scheduled",triggerType:"cron",triggerSource:null,startTime:"2025-06-27 09:00:00",endTime:null,duration:null,executedTargets:0,totalTargets:8,successRate:0,details:null},{id:"exec_012",taskCollectionId:"3",taskCollectionName:"安全扫描任务",status:"completed",triggerType:"hook",triggerSource:"API调用",startTime:"2025-06-19 14:15:00",endTime:"2025-06-19 15:30:45",duration:4545,executedTargets:6,totalTargets:6,successRate:100,details:{targets:[{id:"entity_007",name:"Web应用防火墙",type:"entity",status:"success",actions:[{id:"security_scan",name:"安全扫描",status:"success",duration:450}]}]}},{id:"exec_013",taskCollectionId:"4",taskCollectionName:"网络安全巡检",status:"failed",triggerType:"cron",triggerSource:null,startTime:"2025-06-18 08:00:00",endTime:"2025-06-18 08:25:30",duration:1530,executedTargets:8,totalTargets:12,successRate:66.7,details:{targets:[{id:"entity_008",name:"入侵检测系统",type:"entity",status:"failed",actions:[{id:"security_scan",name:"安全扫描",status:"failed",duration:120}]}]}},{id:"exec_014",taskCollectionId:"5",taskCollectionName:"备份验证任务",status:"scheduled",triggerType:"cron",triggerSource:null,startTime:"2025-06-27 02:00:00",endTime:null,duration:null,executedTargets:0,totalTargets:3,successRate:0,details:null},{id:"exec_015",taskCollectionId:"6",taskCollectionName:"日志分析任务",status:"completed",triggerType:"hook",triggerSource:"Webhook触发",startTime:"2025-06-17 11:30:00",endTime:"2025-06-17 12:15:20",duration:2720,executedTargets:4,totalTargets:4,successRate:100,details:{targets:[{id:"sequence_002",name:"日志聚合流程",type:"sequence",status:"success",actions:[{id:"log_analysis",name:"日志分析",status:"success",duration:360}]}]}}],Te=()=>{const{t:de}=Y(),{taskId:n}=q(),j=K(),[i,b]=r.useState([]),[k,$]=r.useState([]),[o,H]=r.useState(""),[u,A]=r.useState("all"),[g,B]=r.useState("all"),[l,E]=r.useState(null),[y,L]=r.useState("desc");r.useEffect(()=>{re("任务执行历史记录");const t=n?d.filter(s=>s.taskCollectionId===n):d;b(t),console.log("加载的执行历史记录总数:",d.length),console.log("过滤后的执行历史记录:",t.length),console.log("当前taskId:",n),console.log("模拟数据前3条:",d.slice(0,3))},[n]),r.useEffect(()=>{console.log("筛选逻辑执行 - executionHistory长度:",i.length),console.log("当前筛选条件:",{searchKeyword:o,statusFilter:u,triggerFilter:g,dateRange:l,sortOrder:y});let t=[...i];o&&(t=t.filter(s=>{var a;return s.taskCollectionName.toLowerCase().includes(o.toLowerCase())||((a=s.triggerSource)==null?void 0:a.toLowerCase().includes(o.toLowerCase()))})),u!=="all"&&(t=t.filter(s=>s.status===u)),g!=="all"&&(t=t.filter(s=>s.triggerType===g)),l&&l[0]&&l[1]&&(t=t.filter(s=>{var c,h;const a=T(s.startTime);return a.isAfter((c=l[0])==null?void 0:c.startOf("day"))&&a.isBefore((h=l[1])==null?void 0:h.endOf("day"))})),t.sort((s,a)=>{const c=T(s.startTime).unix(),h=T(a.startTime).unix();return y==="desc"?h-c:c-h}),console.log("筛选后的记录数量:",t.length),console.log("筛选后的前3条记录:",t.slice(0,3)),$(t)},[i,o,u,g,l,y]);const P=()=>{const t=n?d.filter(s=>s.taskCollectionId===n):d;b(t)},z=t=>{j(`/task-management/task-collections/run/${t.id}`)},D=t=>{switch(t){case"completed":return"success";case"running":return"processing";case"scheduled":return"warning";case"failed":return"error";default:return"default"}},W=t=>{switch(t){case"completed":return e.jsx(se,{style:{color:"#52c41a"}});case"running":return e.jsx(te,{style:{color:"#1890ff"}});case"scheduled":return e.jsx(I,{style:{color:"#faad14"}});case"failed":return e.jsx(ee,{style:{color:"#ff4d4f"}});default:return e.jsx(I,{})}},F=(t,s)=>t==="cron"?{icon:e.jsx(G,{style:{color:"#1890ff"}}),text:"定时任务触发",color:"blue"}:{icon:e.jsx(Z,{style:{color:"#52c41a"}}),text:s||"Hook触发",color:"green"},M=t=>{switch(t){case"completed":return"已完成";case"running":return"执行中";case"scheduled":return"未执行";case"failed":return"失败";default:return"未知"}},O=t=>t<60?`${t}秒`:t<3600?`${Math.floor(t/60)}分${t%60}秒`:`${Math.floor(t/3600)}小时${Math.floor(t%3600/60)}分`;return e.jsxs(ne,{children:[e.jsxs(p,{style:{marginBottom:24},children:[e.jsxs(p.Item,{children:[e.jsx(Q,{}),e.jsx("span",{style:{cursor:"pointer",marginLeft:4},onClick:()=>j("/"),children:"首页"})]}),e.jsxs(p.Item,{children:[e.jsx(C,{}),e.jsx("span",{style:{cursor:"pointer",marginLeft:4},onClick:()=>j("/task-management/task-collections"),children:"任务集合管理"})]}),e.jsxs(p.Item,{children:[e.jsx(C,{}),"执行历史记录"]})]}),e.jsx("div",{style:{marginBottom:24},children:e.jsxs(N,{level:2,style:{margin:0},children:[e.jsx(C,{style:{marginRight:8,color:"#1890ff"}}),"任务执行历史记录"]})}),e.jsxs(_,{gutter:16,style:{marginBottom:24},children:[e.jsx(m,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#1890ff"},children:i.length}),e.jsx("div",{style:{color:"#666"},children:"总执行次数"})]})})}),e.jsx(m,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#52c41a"},children:i.filter(t=>t.status==="completed").length}),e.jsx("div",{style:{color:"#666"},children:"成功执行"})]})})}),e.jsx(m,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#1890ff"},children:i.filter(t=>t.status==="running").length}),e.jsx("div",{style:{color:"#666"},children:"正在执行"})]})})}),e.jsx(m,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#faad14"},children:i.filter(t=>t.status==="scheduled").length}),e.jsx("div",{style:{color:"#666"},children:"计划执行"})]})})})]}),e.jsx(J,{message:e.jsxs("div",{children:[e.jsxs("div",{children:["📊 原始数据: ",d.length," 条"]}),e.jsxs("div",{children:["📋 当前executionHistory: ",i.length," 条"]}),e.jsxs("div",{children:["🔍 筛选后filteredHistory: ",k.length," 条"]}),e.jsxs("div",{children:["🎯 当前taskId: ",n||"无"]}),e.jsxs("div",{children:["🔧 筛选条件: 状态=",u,", 触发=",g,', 搜索="',o,'"']})]}),type:"info",style:{marginBottom:16},showIcon:!0}),e.jsx(ie,{searchValue:o,onSearchChange:H,searchPlaceholder:"搜索任务名称、触发源...",filters:[{key:"status",value:u,onChange:A,options:[{value:"all",label:"全部状态"},{value:"completed",label:"已完成"},{value:"running",label:"执行中"},{value:"scheduled",label:"计划中"},{value:"failed",label:"失败"}],placeholder:"执行状态",width:120},{key:"trigger",value:g,onChange:B,options:[{value:"all",label:"全部方式"},{value:"cron",label:"定时任务"},{value:"hook",label:"Hook触发"}],placeholder:"触发方式",width:120},{key:"sort",value:y,onChange:L,options:[{value:"desc",label:"最新优先"},{value:"asc",label:"最早优先"}],placeholder:"排序方式",width:120}],showRefresh:!0,onRefresh:P,extraActions:e.jsx(le,{value:l,onChange:E,placeholder:["开始日期","结束日期"],style:{width:240}})}),e.jsxs(oe,{children:[e.jsx("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs(N,{level:4,style:{margin:0},children:["执行记录列表 (",k.length,"条)"]})}),e.jsx(R,{dataSource:k,renderItem:t=>{const s=F(t.triggerType,t.triggerSource),a=T(t.startTime).format("YYYY-MM-DD HH:mm:ss"),c=M(t.status);return e.jsx(R.Item,{style:{padding:0,marginBottom:8},children:e.jsx(ce,{className:t.status,size:"small",hoverable:!0,onClick:()=>z(t),style:{width:"100%"},children:e.jsxs(_,{align:"middle",justify:"space-between",children:[e.jsx(m,{flex:"auto",children:e.jsxs(v,{direction:"vertical",size:4,children:[e.jsxs(v,{children:[W(t.status),e.jsx(x,{strong:!0,children:t.taskCollectionName}),e.jsx(w,{color:s.color,icon:s.icon,children:s.text})]}),e.jsxs(v,{size:16,children:[e.jsxs(x,{type:"secondary",children:[e.jsx(I,{})," ",a]}),t.duration&&e.jsxs(x,{type:"secondary",children:[e.jsx(X,{})," ",O(t.duration)]}),e.jsxs(x,{type:"secondary",children:["成功率: ",t.successRate,"%"]}),e.jsxs(x,{type:"secondary",children:["进度: ",t.executedTargets,"/",t.totalTargets]})]})]})}),e.jsx(m,{children:e.jsx(w,{color:D(t.status),children:c})})]})})})},pagination:{pageSize:20,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,s)=>`第 ${s[0]}-${s[1]} 条，共 ${t} 条记录`}})]})]})};export{Te as default};

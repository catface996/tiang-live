import{u as Y,a as q,b as K,j as e,d as S}from"./index-BoaK5Cbd.js";import{r,K as T,N as p,O as Q,P as C,T as V,d as _,C as m,j as f,Q as J,D as U,L as R,k as v,u as w,U as I,V as X,W as G,s as Z,X as ee,Y as te,a as se,m as ae}from"./antd-CAFIM9ev.js";import{s as re}from"./index-Daowydkz.js";import{S as ie}from"./SearchFilterBar-AJ-ixr8L.js";import"./Breadcrumb-Bi6Eb3lZ.js";import"./vendor-DJG_os-6.js";const{Title:N,Text:x}=V,{Option:ye}=ae,{RangePicker:le}=U,ne=S.div`
  padding: 24px;
  background: #f5f5f5;
  min-height: 100vh;
`,oe=S.div`
  background: white;
  border-radius: 8px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
`,ce=S(f)`
  margin-bottom: 8px;
  border-radius: 6px;
  
  &.completed {
    border-left: 4px solid #52c41a;
  }
  
  &.running {
    border-left: 4px solid #1890ff;
  }
  
  &.scheduled {
    border-left: 4px solid #faad14;
  }
  
  &.failed {
    border-left: 4px solid #ff4d4f;
  }
`,d=[{id:"exec_001",taskCollectionId:"1",taskCollectionName:"æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿå¥åº·æ£€æŸ¥",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-26 10:00:00",endTime:"2025-06-26 10:15:30",duration:930,executedTargets:8,totalTargets:8,successRate:100,details:{targets:[{id:"entity_001",name:"ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ",type:"entity",status:"success",actions:[{id:"health_check",name:"å¥åº·æ£€æŸ¥",status:"success",duration:120},{id:"performance_analysis",name:"æ€§èƒ½åˆ†æ",status:"success",duration:180}]}]}},{id:"exec_002",taskCollectionId:"2",taskCollectionName:"æ•°æ®åº“æ€§èƒ½ç›‘æ§",status:"running",triggerType:"hook",triggerSource:"APIè°ƒç”¨",startTime:"2025-06-26 14:30:00",endTime:null,duration:null,executedTargets:3,totalTargets:5,successRate:75,details:null},{id:"exec_003",taskCollectionId:"3",taskCollectionName:"å®‰å…¨æ‰«æä»»åŠ¡",status:"scheduled",triggerType:"cron",triggerSource:null,startTime:"2025-06-26 23:00:00",endTime:null,duration:null,executedTargets:0,totalTargets:6,successRate:0,details:null},{id:"exec_004",taskCollectionId:"1",taskCollectionName:"æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿå¥åº·æ£€æŸ¥",status:"failed",triggerType:"cron",triggerSource:null,startTime:"2025-06-25 15:00:00",endTime:"2025-06-25 15:08:45",duration:525,executedTargets:5,totalTargets:8,successRate:62.5,details:{targets:[{id:"entity_002",name:"è®¢å•ç®¡ç†ç³»ç»Ÿ",type:"entity",status:"failed",actions:[{id:"health_check",name:"å¥åº·æ£€æŸ¥",status:"failed",duration:60}]}]}},{id:"exec_005",taskCollectionId:"4",taskCollectionName:"ç½‘ç»œå®‰å…¨å·¡æ£€",status:"completed",triggerType:"hook",triggerSource:"Webhookè§¦å‘",startTime:"2025-06-24 10:30:00",endTime:"2025-06-24 11:45:20",duration:4520,executedTargets:12,totalTargets:12,successRate:100,details:{targets:[{id:"entity_003",name:"é˜²ç«å¢™ç³»ç»Ÿ",type:"entity",status:"success",actions:[{id:"security_scan",name:"å®‰å…¨æ‰«æ",status:"success",duration:300}]}]}},{id:"exec_006",taskCollectionId:"2",taskCollectionName:"æ•°æ®åº“æ€§èƒ½ç›‘æ§",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-23 18:00:00",endTime:"2025-06-23 18:25:15",duration:1515,executedTargets:5,totalTargets:5,successRate:100,details:{targets:[{id:"entity_004",name:"MySQLä¸»åº“",type:"entity",status:"success",actions:[{id:"performance_analysis",name:"æ€§èƒ½åˆ†æ",status:"success",duration:240}]}]}},{id:"exec_007",taskCollectionId:"5",taskCollectionName:"å¤‡ä»½éªŒè¯ä»»åŠ¡",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-22 02:00:00",endTime:"2025-06-22 02:45:30",duration:2730,executedTargets:3,totalTargets:3,successRate:100,details:{targets:[{id:"sequence_001",name:"æ•°æ®å¤‡ä»½æµç¨‹",type:"sequence",status:"success",actions:[{id:"backup_verify",name:"å¤‡ä»½éªŒè¯",status:"success",duration:600}]}]}},{id:"exec_008",taskCollectionId:"6",taskCollectionName:"æ—¥å¿—åˆ†æä»»åŠ¡",status:"failed",triggerType:"hook",triggerSource:"ç›‘æ§å‘Šè­¦è§¦å‘",startTime:"2025-06-21 16:20:00",endTime:"2025-06-21 16:35:15",duration:915,executedTargets:2,totalTargets:4,successRate:50,details:{targets:[{id:"entity_005",name:"åº”ç”¨æ—¥å¿—ç³»ç»Ÿ",type:"entity",status:"failed",actions:[{id:"log_analysis",name:"æ—¥å¿—åˆ†æ",status:"failed",duration:180}]}]}},{id:"exec_009",taskCollectionId:"7",taskCollectionName:"å®¹å™¨å¥åº·æ£€æŸ¥",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-20 09:00:00",endTime:"2025-06-20 09:12:30",duration:750,executedTargets:15,totalTargets:15,successRate:100,details:{targets:[{id:"entity_006",name:"Kubernetesé›†ç¾¤",type:"entity",status:"success",actions:[{id:"health_check",name:"å¥åº·æ£€æŸ¥",status:"success",duration:90}]}]}},{id:"exec_010",taskCollectionId:"8",taskCollectionName:"APIæ¥å£ç›‘æ§",status:"running",triggerType:"hook",triggerSource:"æ‰‹åŠ¨è§¦å‘",startTime:"2025-06-26 15:45:00",endTime:null,duration:null,executedTargets:6,totalTargets:10,successRate:85,details:null},{id:"exec_011",taskCollectionId:"1",taskCollectionName:"æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿå¥åº·æ£€æŸ¥",status:"scheduled",triggerType:"cron",triggerSource:null,startTime:"2025-06-27 09:00:00",endTime:null,duration:null,executedTargets:0,totalTargets:8,successRate:0,details:null},{id:"exec_012",taskCollectionId:"3",taskCollectionName:"å®‰å…¨æ‰«æä»»åŠ¡",status:"completed",triggerType:"hook",triggerSource:"APIè°ƒç”¨",startTime:"2025-06-19 14:15:00",endTime:"2025-06-19 15:30:45",duration:4545,executedTargets:6,totalTargets:6,successRate:100,details:{targets:[{id:"entity_007",name:"Webåº”ç”¨é˜²ç«å¢™",type:"entity",status:"success",actions:[{id:"security_scan",name:"å®‰å…¨æ‰«æ",status:"success",duration:450}]}]}},{id:"exec_013",taskCollectionId:"4",taskCollectionName:"ç½‘ç»œå®‰å…¨å·¡æ£€",status:"failed",triggerType:"cron",triggerSource:null,startTime:"2025-06-18 08:00:00",endTime:"2025-06-18 08:25:30",duration:1530,executedTargets:8,totalTargets:12,successRate:66.7,details:{targets:[{id:"entity_008",name:"å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ",type:"entity",status:"failed",actions:[{id:"security_scan",name:"å®‰å…¨æ‰«æ",status:"failed",duration:120}]}]}},{id:"exec_014",taskCollectionId:"5",taskCollectionName:"å¤‡ä»½éªŒè¯ä»»åŠ¡",status:"scheduled",triggerType:"cron",triggerSource:null,startTime:"2025-06-27 02:00:00",endTime:null,duration:null,executedTargets:0,totalTargets:3,successRate:0,details:null},{id:"exec_015",taskCollectionId:"6",taskCollectionName:"æ—¥å¿—åˆ†æä»»åŠ¡",status:"completed",triggerType:"hook",triggerSource:"Webhookè§¦å‘",startTime:"2025-06-17 11:30:00",endTime:"2025-06-17 12:15:20",duration:2720,executedTargets:4,totalTargets:4,successRate:100,details:{targets:[{id:"sequence_002",name:"æ—¥å¿—èšåˆæµç¨‹",type:"sequence",status:"success",actions:[{id:"log_analysis",name:"æ—¥å¿—åˆ†æ",status:"success",duration:360}]}]}}],Te=()=>{const{t:de}=Y(),{taskId:n}=q(),j=K(),[i,b]=r.useState([]),[k,$]=r.useState([]),[o,H]=r.useState(""),[u,A]=r.useState("all"),[g,B]=r.useState("all"),[l,E]=r.useState(null),[y,L]=r.useState("desc");r.useEffect(()=>{re("ä»»åŠ¡æ‰§è¡Œå†å²è®°å½•");const t=n?d.filter(s=>s.taskCollectionId===n):d;b(t),console.log("åŠ è½½çš„æ‰§è¡Œå†å²è®°å½•æ€»æ•°:",d.length),console.log("è¿‡æ»¤åçš„æ‰§è¡Œå†å²è®°å½•:",t.length),console.log("å½“å‰taskId:",n),console.log("æ¨¡æ‹Ÿæ•°æ®å‰3æ¡:",d.slice(0,3))},[n]),r.useEffect(()=>{console.log("ç­›é€‰é€»è¾‘æ‰§è¡Œ - executionHistoryé•¿åº¦:",i.length),console.log("å½“å‰ç­›é€‰æ¡ä»¶:",{searchKeyword:o,statusFilter:u,triggerFilter:g,dateRange:l,sortOrder:y});let t=[...i];o&&(t=t.filter(s=>{var a;return s.taskCollectionName.toLowerCase().includes(o.toLowerCase())||((a=s.triggerSource)==null?void 0:a.toLowerCase().includes(o.toLowerCase()))})),u!=="all"&&(t=t.filter(s=>s.status===u)),g!=="all"&&(t=t.filter(s=>s.triggerType===g)),l&&l[0]&&l[1]&&(t=t.filter(s=>{var c,h;const a=T(s.startTime);return a.isAfter((c=l[0])==null?void 0:c.startOf("day"))&&a.isBefore((h=l[1])==null?void 0:h.endOf("day"))})),t.sort((s,a)=>{const c=T(s.startTime).unix(),h=T(a.startTime).unix();return y==="desc"?h-c:c-h}),console.log("ç­›é€‰åçš„è®°å½•æ•°é‡:",t.length),console.log("ç­›é€‰åçš„å‰3æ¡è®°å½•:",t.slice(0,3)),$(t)},[i,o,u,g,l,y]);const P=()=>{const t=n?d.filter(s=>s.taskCollectionId===n):d;b(t)},z=t=>{j(`/task-management/task-collections/run/${t.id}`)},D=t=>{switch(t){case"completed":return"success";case"running":return"processing";case"scheduled":return"warning";case"failed":return"error";default:return"default"}},W=t=>{switch(t){case"completed":return e.jsx(se,{style:{color:"#52c41a"}});case"running":return e.jsx(te,{style:{color:"#1890ff"}});case"scheduled":return e.jsx(I,{style:{color:"#faad14"}});case"failed":return e.jsx(ee,{style:{color:"#ff4d4f"}});default:return e.jsx(I,{})}},F=(t,s)=>t==="cron"?{icon:e.jsx(G,{style:{color:"#1890ff"}}),text:"å®šæ—¶ä»»åŠ¡è§¦å‘",color:"blue"}:{icon:e.jsx(Z,{style:{color:"#52c41a"}}),text:s||"Hookè§¦å‘",color:"green"},M=t=>{switch(t){case"completed":return"å·²å®Œæˆ";case"running":return"æ‰§è¡Œä¸­";case"scheduled":return"æœªæ‰§è¡Œ";case"failed":return"å¤±è´¥";default:return"æœªçŸ¥"}},O=t=>t<60?`${t}ç§’`:t<3600?`${Math.floor(t/60)}åˆ†${t%60}ç§’`:`${Math.floor(t/3600)}å°æ—¶${Math.floor(t%3600/60)}åˆ†`;return e.jsxs(ne,{children:[e.jsxs(p,{style:{marginBottom:24},children:[e.jsxs(p.Item,{children:[e.jsx(Q,{}),e.jsx("span",{style:{cursor:"pointer",marginLeft:4},onClick:()=>j("/"),children:"é¦–é¡µ"})]}),e.jsxs(p.Item,{children:[e.jsx(C,{}),e.jsx("span",{style:{cursor:"pointer",marginLeft:4},onClick:()=>j("/task-management/task-collections"),children:"ä»»åŠ¡é›†åˆç®¡ç†"})]}),e.jsxs(p.Item,{children:[e.jsx(C,{}),"æ‰§è¡Œå†å²è®°å½•"]})]}),e.jsx("div",{style:{marginBottom:24},children:e.jsxs(N,{level:2,style:{margin:0},children:[e.jsx(C,{style:{marginRight:8,color:"#1890ff"}}),"ä»»åŠ¡æ‰§è¡Œå†å²è®°å½•"]})}),e.jsxs(_,{gutter:16,style:{marginBottom:24},children:[e.jsx(m,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#1890ff"},children:i.length}),e.jsx("div",{style:{color:"#666"},children:"æ€»æ‰§è¡Œæ¬¡æ•°"})]})})}),e.jsx(m,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#52c41a"},children:i.filter(t=>t.status==="completed").length}),e.jsx("div",{style:{color:"#666"},children:"æˆåŠŸæ‰§è¡Œ"})]})})}),e.jsx(m,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#1890ff"},children:i.filter(t=>t.status==="running").length}),e.jsx("div",{style:{color:"#666"},children:"æ­£åœ¨æ‰§è¡Œ"})]})})}),e.jsx(m,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#faad14"},children:i.filter(t=>t.status==="scheduled").length}),e.jsx("div",{style:{color:"#666"},children:"è®¡åˆ’æ‰§è¡Œ"})]})})})]}),e.jsx(J,{message:e.jsxs("div",{children:[e.jsxs("div",{children:["ğŸ“Š åŸå§‹æ•°æ®: ",d.length," æ¡"]}),e.jsxs("div",{children:["ğŸ“‹ å½“å‰executionHistory: ",i.length," æ¡"]}),e.jsxs("div",{children:["ğŸ” ç­›é€‰åfilteredHistory: ",k.length," æ¡"]}),e.jsxs("div",{children:["ğŸ¯ å½“å‰taskId: ",n||"æ— "]}),e.jsxs("div",{children:["ğŸ”§ ç­›é€‰æ¡ä»¶: çŠ¶æ€=",u,", è§¦å‘=",g,', æœç´¢="',o,'"']})]}),type:"info",style:{marginBottom:16},showIcon:!0}),e.jsx(ie,{searchValue:o,onSearchChange:H,searchPlaceholder:"æœç´¢ä»»åŠ¡åç§°ã€è§¦å‘æº...",filters:[{key:"status",value:u,onChange:A,options:[{value:"all",label:"å…¨éƒ¨çŠ¶æ€"},{value:"completed",label:"å·²å®Œæˆ"},{value:"running",label:"æ‰§è¡Œä¸­"},{value:"scheduled",label:"è®¡åˆ’ä¸­"},{value:"failed",label:"å¤±è´¥"}],placeholder:"æ‰§è¡ŒçŠ¶æ€",width:120},{key:"trigger",value:g,onChange:B,options:[{value:"all",label:"å…¨éƒ¨æ–¹å¼"},{value:"cron",label:"å®šæ—¶ä»»åŠ¡"},{value:"hook",label:"Hookè§¦å‘"}],placeholder:"è§¦å‘æ–¹å¼",width:120},{key:"sort",value:y,onChange:L,options:[{value:"desc",label:"æœ€æ–°ä¼˜å…ˆ"},{value:"asc",label:"æœ€æ—©ä¼˜å…ˆ"}],placeholder:"æ’åºæ–¹å¼",width:120}],showRefresh:!0,onRefresh:P,extraActions:e.jsx(le,{value:l,onChange:E,placeholder:["å¼€å§‹æ—¥æœŸ","ç»“æŸæ—¥æœŸ"],style:{width:240}})}),e.jsxs(oe,{children:[e.jsx("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs(N,{level:4,style:{margin:0},children:["æ‰§è¡Œè®°å½•åˆ—è¡¨ (",k.length,"æ¡)"]})}),e.jsx(R,{dataSource:k,renderItem:t=>{const s=F(t.triggerType,t.triggerSource),a=T(t.startTime).format("YYYY-MM-DD HH:mm:ss"),c=M(t.status);return e.jsx(R.Item,{style:{padding:0,marginBottom:8},children:e.jsx(ce,{className:t.status,size:"small",hoverable:!0,onClick:()=>z(t),style:{width:"100%"},children:e.jsxs(_,{align:"middle",justify:"space-between",children:[e.jsx(m,{flex:"auto",children:e.jsxs(v,{direction:"vertical",size:4,children:[e.jsxs(v,{children:[W(t.status),e.jsx(x,{strong:!0,children:t.taskCollectionName}),e.jsx(w,{color:s.color,icon:s.icon,children:s.text})]}),e.jsxs(v,{size:16,children:[e.jsxs(x,{type:"secondary",children:[e.jsx(I,{})," ",a]}),t.duration&&e.jsxs(x,{type:"secondary",children:[e.jsx(X,{})," ",O(t.duration)]}),e.jsxs(x,{type:"secondary",children:["æˆåŠŸç‡: ",t.successRate,"%"]}),e.jsxs(x,{type:"secondary",children:["è¿›åº¦: ",t.executedTargets,"/",t.totalTargets]})]})]})}),e.jsx(m,{children:e.jsx(w,{color:D(t.status),children:c})})]})})})},pagination:{pageSize:20,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,s)=>`ç¬¬ ${s[0]}-${s[1]} æ¡ï¼Œå…± ${t} æ¡è®°å½•`}})]})]})};export{Te as default};

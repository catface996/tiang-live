import{j as e,d as V,u as rt,b as dt}from"./index-BoaK5Cbd.js";import{k as F,B as J,x as ut,_ as ve,T as ie,e as Oe,aF as ke,W as ht,q as pt,aE as xt,aD as ft,f as mt,s as gt,ay as yt,a0 as vt,j as ne,u as k,S as O,aL as jt,r as q,$ as _t,Q as bt,bc as wt,bd as Tt,be as zt,bf as St,o as je,z as me,ag as Le,a2 as Ae,b9 as Ct,y as U,d as ce,C as Y,aT as De,p as Ge,ah as kt,m as Qe,ap as Mt,as as Me,bg as It}from"./antd-CAFIM9ev.js";import{s as at}from"./index-Daowydkz.js";import{t as Bt,d as ot,j as We,T as Ie,s as he,k as Be}from"./transform-HhklBjSi.js";import{p as ue,a as Rt,y as Et,d as $t}from"./drag-CBGjPDUz.js";import{E as yn}from"./EntityForm-DBy-qqnE.js";import{default as jn}from"./EntityCreatePage-CV32boWo.js";import{default as bn}from"./EntityEditPage-CDIxgisS.js";import"./vendor-DJG_os-6.js";const{Text:Nt}=ie,Pt=V(ne)`
  margin-bottom: 16px;
  transition: all 0.3s ease;
  border-radius: 8px;
  
  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  
  .ant-card-head {
    border-bottom: 1px solid var(--border-color);
    padding: 12px 16px;
  }
  
  .ant-card-body {
    padding: 16px;
  }
`,Lt=V.div`
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: 6px;
  color: white;
  font-size: 16px;
  margin-right: 8px;
`,xe=({entity:t,onClick:s,onEdit:n,children:l,extraActions:o})=>{const r=y=>({report:{icon:e.jsx(vt,{}),color:"#1890ff"},business_link:{icon:e.jsx(yt,{}),color:"#52c41a"},business_system:{icon:e.jsx(Oe,{}),color:"#faad14"},api:{icon:e.jsx(gt,{}),color:"#722ed1"},database:{icon:e.jsx(mt,{}),color:"#f5222d"},table:{icon:e.jsx(ft,{}),color:"#fa8c16"},middleware:{icon:e.jsx(xt,{}),color:"#13c2c2"},microservice:{icon:e.jsx(pt,{}),color:"#eb2f96"},scheduled_job:{icon:e.jsx(ht,{}),color:"#a0d911"},configuration:{icon:e.jsx(ke,{}),color:"#2f54eb"}})[y]||{icon:e.jsx(Oe,{}),color:"#8c8c8c"},c=y=>({active:"green",running:"green",inactive:"red",warning:"orange",pending:"blue"})[y]||"default",u=r(t.type);return e.jsx(Pt,{size:"small",onClick:()=>s==null?void 0:s(t),style:{cursor:"pointer"},title:e.jsxs(F,{children:[e.jsx(Lt,{style:{backgroundColor:u.color},children:u.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:t.name}),e.jsx(Nt,{type:"secondary",style:{fontSize:"12px"},children:t.category})]})]}),extra:e.jsxs(F,{children:[e.jsx(J,{type:"text",size:"small",icon:e.jsx(ut,{}),onClick:y=>{y.stopPropagation(),n==null||n(t)},style:{color:"#1890ff"}}),o,e.jsx(ve,{status:c(t.status),text:t.status})]}),children:l})},{Text:be,Paragraph:At}=ie,Re=V.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  
  &:last-child {
    margin-bottom: 0;
  }
`,Dt=({entity:t,onClick:s,onEdit:n})=>{var l,o,r,c,u;return e.jsxs(xe,{entity:t,onClick:s,onEdit:n,children:[e.jsx(At,{ellipsis:{rows:2},style:{marginBottom:12},children:t.description}),e.jsxs(F,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(Re,{children:[e.jsx(be,{type:"secondary",children:"更新频率:"}),e.jsx(k,{color:"blue",children:t.updateFrequency})]}),e.jsxs(Re,{children:[e.jsx(be,{type:"secondary",children:"负责人:"}),e.jsx(be,{children:t.owner})]}),e.jsxs(Re,{children:[e.jsx(be,{type:"secondary",children:"数据源:"}),e.jsx(F,{children:(l=t.dataSource)==null?void 0:l.map((y,a)=>e.jsx(k,{size:"small",children:y},a))})]}),e.jsxs("div",{style:{marginTop:12,display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8},children:[e.jsx(O,{title:"查看次数",value:(o=t.metrics)==null?void 0:o.viewCount,valueStyle:{fontSize:"14px"}}),e.jsx(O,{title:"导出次数",value:(r=t.metrics)==null?void 0:r.exportCount,valueStyle:{fontSize:"14px"}}),e.jsx(O,{title:"加载时间",value:(c=t.metrics)==null?void 0:c.avgLoadTime,valueStyle:{fontSize:"14px"}})]})]}),e.jsx("div",{style:{marginTop:12},children:(u=t.tags)==null?void 0:u.map((y,a)=>e.jsx(k,{size:"small",style:{marginBottom:4},children:y},a))})]})},{Text:Ve,Paragraph:Gt}=ie,Qt=V.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  
  &:last-child {
    margin-bottom: 0;
  }
`,Wt=({entity:t,onClick:s,onEdit:n})=>{var l;return e.jsxs(xe,{entity:t,onClick:s,onEdit:n,children:[e.jsx(Gt,{ellipsis:{rows:2},style:{marginBottom:12},children:t.description}),e.jsxs(Qt,{children:[e.jsx(Ve,{type:"secondary",children:"负责人:"}),e.jsx(Ve,{children:t.owner})]}),e.jsx("div",{style:{marginTop:12},children:(l=t.tags)==null?void 0:l.map((o,r)=>e.jsx(k,{size:"small",style:{marginBottom:4},children:o},r))})]})},{Text:we,Paragraph:Yt}=ie,Xe=V.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  
  &:last-child {
    margin-bottom: 0;
  }
`,Ft=({entity:t,onClick:s,onEdit:n})=>{var l,o;return e.jsxs(xe,{entity:t,onClick:s,onEdit:n,extraActions:e.jsx(k,{color:"blue",children:t.version}),children:[e.jsx(Yt,{ellipsis:{rows:2},style:{marginBottom:12},children:t.description}),e.jsxs(F,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(Xe,{children:[e.jsx(we,{type:"secondary",children:"负责人:"}),e.jsx(we,{children:t.owner})]}),e.jsxs(Xe,{children:[e.jsx(we,{type:"secondary",children:"技术栈:"}),e.jsx(F,{children:(l=t.techStack)==null?void 0:l.map((r,c)=>e.jsx(k,{size:"small",children:r},c))})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx(we,{type:"secondary",style:{fontSize:"12px"},children:"健康度"}),e.jsx(jt,{percent:t.healthScore,size:"small",status:t.healthScore>80?"success":t.healthScore>60?"normal":"exception",style:{marginTop:4}})]})]}),e.jsx("div",{style:{marginTop:12},children:(o=t.tags)==null?void 0:o.map((r,c)=>e.jsx(k,{size:"small",style:{marginBottom:4},children:r},c))})]})},{Text:Te,Paragraph:Ot}=ie,qe=V.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  
  &:last-child {
    margin-bottom: 0;
  }
`,Vt=({entity:t,onClick:s,onEdit:n})=>{var o,r,c;const l=u=>({GET:"green",POST:"blue",PUT:"orange",DELETE:"red",PATCH:"purple"})[u]||"default";return e.jsxs(xe,{entity:t,onClick:s,onEdit:n,extraActions:e.jsx(k,{color:l(t.method),children:t.method}),children:[e.jsx(Ot,{ellipsis:{rows:2},style:{marginBottom:12},children:t.description}),e.jsxs(F,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(qe,{children:[e.jsx(Te,{type:"secondary",children:"路径:"}),e.jsx(Te,{code:!0,style:{fontSize:"12px"},children:t.path})]}),e.jsxs(qe,{children:[e.jsx(Te,{type:"secondary",children:"负责人:"}),e.jsx(Te,{children:t.owner})]}),e.jsxs("div",{style:{marginTop:12,display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:8},children:[e.jsx(O,{title:"调用次数",value:(o=t.metrics)==null?void 0:o.callCount,valueStyle:{fontSize:"14px"}}),e.jsx(O,{title:"响应时间",value:(r=t.metrics)==null?void 0:r.avgResponseTime,suffix:"ms",valueStyle:{fontSize:"14px"}})]})]}),e.jsx("div",{style:{marginTop:12},children:(c=t.tags)==null?void 0:c.map((u,y)=>e.jsx(k,{size:"small",style:{marginBottom:4},children:u},y))})]})},{Text:ze,Paragraph:Xt}=ie,Ze=V.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  
  &:last-child {
    margin-bottom: 0;
  }
`,qt=({entity:t,onClick:s,onEdit:n})=>{var l,o,r;return e.jsxs(xe,{entity:t,onClick:s,onEdit:n,extraActions:e.jsx(k,{color:"red",children:t.technology}),children:[e.jsx(Xt,{ellipsis:{rows:2},style:{marginBottom:12},children:t.description}),e.jsxs(F,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(Ze,{children:[e.jsx(ze,{type:"secondary",children:"连接地址:"}),e.jsxs(ze,{code:!0,style:{fontSize:"12px"},children:[t.host,":",t.port]})]}),e.jsxs(Ze,{children:[e.jsx(ze,{type:"secondary",children:"负责人:"}),e.jsx(ze,{children:t.owner})]}),e.jsxs("div",{style:{marginTop:12,display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:8},children:[e.jsx(O,{title:"连接数",value:(l=t.metrics)==null?void 0:l.connectionCount,valueStyle:{fontSize:"14px"}}),e.jsx(O,{title:"存储大小",value:(o=t.metrics)==null?void 0:o.storageSize,suffix:"GB",valueStyle:{fontSize:"14px"}})]})]}),e.jsx("div",{style:{marginTop:12},children:(r=t.tags)==null?void 0:r.map((c,u)=>e.jsx(k,{size:"small",style:{marginBottom:4},children:c},u))})]})},{Text:Se,Paragraph:Zt}=ie,He=V.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  
  &:last-child {
    margin-bottom: 0;
  }
`,Ht=({entity:t,onClick:s,onEdit:n})=>{var l;return e.jsxs(xe,{entity:t,onClick:s,onEdit:n,children:[e.jsx(Zt,{ellipsis:{rows:2},style:{marginBottom:12},children:t.description}),e.jsxs(He,{children:[e.jsx(Se,{type:"secondary",children:"数据库:"}),e.jsx(Se,{children:t.database})]}),e.jsxs(He,{children:[e.jsx(Se,{type:"secondary",children:"负责人:"}),e.jsx(Se,{children:t.owner})]}),e.jsx("div",{style:{marginTop:12},children:(l=t.tags)==null?void 0:l.map((o,r)=>e.jsx(k,{size:"small",style:{marginBottom:4},children:o},r))})]})},{Text:Ke,Paragraph:Kt}=ie,Jt=V.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  
  &:last-child {
    margin-bottom: 0;
  }
`,Ut=({entity:t,onClick:s,onEdit:n})=>{var l;return e.jsxs(xe,{entity:t,onClick:s,onEdit:n,children:[e.jsx(Kt,{ellipsis:{rows:2},style:{marginBottom:12},children:t.description}),e.jsxs(Jt,{children:[e.jsx(Ke,{type:"secondary",children:"负责人:"}),e.jsx(Ke,{children:t.owner})]}),e.jsx("div",{style:{marginTop:12},children:(l=t.tags)==null?void 0:l.map((o,r)=>e.jsx(k,{size:"small",style:{marginBottom:4},children:o},r))})]})},es=({entity:t,onClick:s,onEdit:n})=>(()=>{switch(t.type){case"report":return e.jsx(Dt,{entity:t,onClick:s,onEdit:n});case"business_link":return e.jsx(Wt,{entity:t,onClick:s,onEdit:n});case"business_system":return e.jsx(Ft,{entity:t,onClick:s,onEdit:n});case"api":return e.jsx(Vt,{entity:t,onClick:s,onEdit:n});case"database":return e.jsx(qt,{entity:t,onClick:s,onEdit:n});case"table":return e.jsx(Ht,{entity:t,onClick:s,onEdit:n});case"middleware":case"microservice":case"scheduled_job":case"configuration":default:return e.jsx(Ut,{entity:t,onClick:s,onEdit:n})}})();var ts=1e-12;function Je(t){return((t=Math.exp(t))+1/t)/2}function ss(t){return((t=Math.exp(t))-1/t)/2}function ns(t){return((t=Math.exp(2*t))-1)/(t+1)}const is=function t(s,n,l){function o(r,c){var u=r[0],y=r[1],a=r[2],_=c[0],z=c[1],p=c[2],m=_-u,C=z-y,x=m*m+C*C,h,d;if(x<ts)d=Math.log(p/a)/s,h=function(Q){return[u+Q*m,y+Q*C,a*Math.exp(s*Q*d)]};else{var b=Math.sqrt(x),I=(p*p-a*a+l*x)/(2*a*n*b),w=(p*p-a*a-l*x)/(2*p*n*b),L=Math.log(Math.sqrt(I*I+1)-I),D=Math.log(Math.sqrt(w*w+1)-w);d=(D-L)/s,h=function(Q){var v=Q*d,R=Je(L),A=a/(n*b)*(R*ns(s*v+L)-ss(L));return[u+A*m,y+A*C,a*R/Je(s*v+L)]}}return h.duration=d*1e3*s/Math.SQRT2,h}return o.rho=function(r){var c=Math.max(.001,+r),u=c*c,y=u*u;return t(c,u,y)},o}(Math.SQRT2,2,4);function rs(t,s){var n,l=1;t==null&&(t=0),s==null&&(s=0);function o(){var r,c=n.length,u,y=0,a=0;for(r=0;r<c;++r)u=n[r],y+=u.x,a+=u.y;for(y=(y/c-t)*l,a=(a/c-s)*l,r=0;r<c;++r)u=n[r],u.x-=y,u.y-=a}return o.initialize=function(r){n=r},o.x=function(r){return arguments.length?(t=+r,o):t},o.y=function(r){return arguments.length?(s=+r,o):s},o.strength=function(r){return arguments.length?(l=+r,o):l},o}function as(t){const s=+this._x.call(null,t),n=+this._y.call(null,t);return lt(this.cover(s,n),s,n,t)}function lt(t,s,n,l){if(isNaN(s)||isNaN(n))return t;var o,r=t._root,c={data:l},u=t._x0,y=t._y0,a=t._x1,_=t._y1,z,p,m,C,x,h,d,b;if(!r)return t._root=c,t;for(;r.length;)if((x=s>=(z=(u+a)/2))?u=z:a=z,(h=n>=(p=(y+_)/2))?y=p:_=p,o=r,!(r=r[d=h<<1|x]))return o[d]=c,t;if(m=+t._x.call(null,r.data),C=+t._y.call(null,r.data),s===m&&n===C)return c.next=r,o?o[d]=c:t._root=c,t;do o=o?o[d]=new Array(4):t._root=new Array(4),(x=s>=(z=(u+a)/2))?u=z:a=z,(h=n>=(p=(y+_)/2))?y=p:_=p;while((d=h<<1|x)===(b=(C>=p)<<1|m>=z));return o[b]=r,o[d]=c,t}function os(t){var s,n,l=t.length,o,r,c=new Array(l),u=new Array(l),y=1/0,a=1/0,_=-1/0,z=-1/0;for(n=0;n<l;++n)isNaN(o=+this._x.call(null,s=t[n]))||isNaN(r=+this._y.call(null,s))||(c[n]=o,u[n]=r,o<y&&(y=o),o>_&&(_=o),r<a&&(a=r),r>z&&(z=r));if(y>_||a>z)return this;for(this.cover(y,a).cover(_,z),n=0;n<l;++n)lt(this,c[n],u[n],t[n]);return this}function ls(t,s){if(isNaN(t=+t)||isNaN(s=+s))return this;var n=this._x0,l=this._y0,o=this._x1,r=this._y1;if(isNaN(n))o=(n=Math.floor(t))+1,r=(l=Math.floor(s))+1;else{for(var c=o-n||1,u=this._root,y,a;n>t||t>=o||l>s||s>=r;)switch(a=(s<l)<<1|t<n,y=new Array(4),y[a]=u,u=y,c*=2,a){case 0:o=n+c,r=l+c;break;case 1:n=o-c,r=l+c;break;case 2:o=n+c,l=r-c;break;case 3:n=o-c,l=r-c;break}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=l,this._x1=o,this._y1=r,this}function cs(){var t=[];return this.visit(function(s){if(!s.length)do t.push(s.data);while(s=s.next)}),t}function ds(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function te(t,s,n,l,o){this.node=t,this.x0=s,this.y0=n,this.x1=l,this.y1=o}function us(t,s,n){var l,o=this._x0,r=this._y0,c,u,y,a,_=this._x1,z=this._y1,p=[],m=this._root,C,x;for(m&&p.push(new te(m,o,r,_,z)),n==null?n=1/0:(o=t-n,r=s-n,_=t+n,z=s+n,n*=n);C=p.pop();)if(!(!(m=C.node)||(c=C.x0)>_||(u=C.y0)>z||(y=C.x1)<o||(a=C.y1)<r))if(m.length){var h=(c+y)/2,d=(u+a)/2;p.push(new te(m[3],h,d,y,a),new te(m[2],c,d,h,a),new te(m[1],h,u,y,d),new te(m[0],c,u,h,d)),(x=(s>=d)<<1|t>=h)&&(C=p[p.length-1],p[p.length-1]=p[p.length-1-x],p[p.length-1-x]=C)}else{var b=t-+this._x.call(null,m.data),I=s-+this._y.call(null,m.data),w=b*b+I*I;if(w<n){var L=Math.sqrt(n=w);o=t-L,r=s-L,_=t+L,z=s+L,l=m.data}}return l}function hs(t){if(isNaN(_=+this._x.call(null,t))||isNaN(z=+this._y.call(null,t)))return this;var s,n=this._root,l,o,r,c=this._x0,u=this._y0,y=this._x1,a=this._y1,_,z,p,m,C,x,h,d;if(!n)return this;if(n.length)for(;;){if((C=_>=(p=(c+y)/2))?c=p:y=p,(x=z>=(m=(u+a)/2))?u=m:a=m,s=n,!(n=n[h=x<<1|C]))return this;if(!n.length)break;(s[h+1&3]||s[h+2&3]||s[h+3&3])&&(l=s,d=h)}for(;n.data!==t;)if(o=n,!(n=n.next))return this;return(r=n.next)&&delete n.next,o?(r?o.next=r:delete o.next,this):s?(r?s[h]=r:delete s[h],(n=s[0]||s[1]||s[2]||s[3])&&n===(s[3]||s[2]||s[1]||s[0])&&!n.length&&(l?l[d]=n:this._root=n),this):(this._root=r,this)}function ps(t){for(var s=0,n=t.length;s<n;++s)this.remove(t[s]);return this}function xs(){return this._root}function fs(){var t=0;return this.visit(function(s){if(!s.length)do++t;while(s=s.next)}),t}function ms(t){var s=[],n,l=this._root,o,r,c,u,y;for(l&&s.push(new te(l,this._x0,this._y0,this._x1,this._y1));n=s.pop();)if(!t(l=n.node,r=n.x0,c=n.y0,u=n.x1,y=n.y1)&&l.length){var a=(r+u)/2,_=(c+y)/2;(o=l[3])&&s.push(new te(o,a,_,u,y)),(o=l[2])&&s.push(new te(o,r,_,a,y)),(o=l[1])&&s.push(new te(o,a,c,u,_)),(o=l[0])&&s.push(new te(o,r,c,a,_))}return this}function gs(t){var s=[],n=[],l;for(this._root&&s.push(new te(this._root,this._x0,this._y0,this._x1,this._y1));l=s.pop();){var o=l.node;if(o.length){var r,c=l.x0,u=l.y0,y=l.x1,a=l.y1,_=(c+y)/2,z=(u+a)/2;(r=o[0])&&s.push(new te(r,c,u,_,z)),(r=o[1])&&s.push(new te(r,_,u,y,z)),(r=o[2])&&s.push(new te(r,c,z,_,a)),(r=o[3])&&s.push(new te(r,_,z,y,a))}n.push(l)}for(;l=n.pop();)t(l.node,l.x0,l.y0,l.x1,l.y1);return this}function ys(t){return t[0]}function vs(t){return arguments.length?(this._x=t,this):this._x}function js(t){return t[1]}function _s(t){return arguments.length?(this._y=t,this):this._y}function Ye(t,s,n){var l=new Fe(s??ys,n??js,NaN,NaN,NaN,NaN);return t==null?l:l.addAll(t)}function Fe(t,s,n,l,o,r){this._x=t,this._y=s,this._x0=n,this._y0=l,this._x1=o,this._y1=r,this._root=void 0}function Ue(t){for(var s={data:t.data},n=s;t=t.next;)n=n.next={data:t.data};return s}var se=Ye.prototype=Fe.prototype;se.copy=function(){var t=new Fe(this._x,this._y,this._x0,this._y0,this._x1,this._y1),s=this._root,n,l;if(!s)return t;if(!s.length)return t._root=Ue(s),t;for(n=[{source:s,target:t._root=new Array(4)}];s=n.pop();)for(var o=0;o<4;++o)(l=s.source[o])&&(l.length?n.push({source:l,target:s.target[o]=new Array(4)}):s.target[o]=Ue(l));return t};se.add=as;se.addAll=os;se.cover=ls;se.data=cs;se.extent=ds;se.find=us;se.remove=hs;se.removeAll=ps;se.root=xs;se.size=fs;se.visit=ms;se.visitAfter=gs;se.x=vs;se.y=_s;function pe(t){return function(){return t}}function de(t){return(t()-.5)*1e-6}function bs(t){return t.x+t.vx}function ws(t){return t.y+t.vy}function Ts(t){var s,n,l,o=1,r=1;typeof t!="function"&&(t=pe(t==null?1:+t));function c(){for(var a,_=s.length,z,p,m,C,x,h,d=0;d<r;++d)for(z=Ye(s,bs,ws).visitAfter(u),a=0;a<_;++a)p=s[a],x=n[p.index],h=x*x,m=p.x+p.vx,C=p.y+p.vy,z.visit(b);function b(I,w,L,D,Q){var v=I.data,R=I.r,A=x+R;if(v){if(v.index>p.index){var Z=m-v.x-v.vx,W=C-v.y-v.vy,M=Z*Z+W*W;M<A*A&&(Z===0&&(Z=de(l),M+=Z*Z),W===0&&(W=de(l),M+=W*W),M=(A-(M=Math.sqrt(M)))/M*o,p.vx+=(Z*=M)*(A=(R*=R)/(h+R)),p.vy+=(W*=M)*A,v.vx-=Z*(A=1-A),v.vy-=W*A)}return}return w>m+A||D<m-A||L>C+A||Q<C-A}}function u(a){if(a.data)return a.r=n[a.data.index];for(var _=a.r=0;_<4;++_)a[_]&&a[_].r>a.r&&(a.r=a[_].r)}function y(){if(s){var a,_=s.length,z;for(n=new Array(_),a=0;a<_;++a)z=s[a],n[z.index]=+t(z,a,s)}}return c.initialize=function(a,_){s=a,l=_,y()},c.iterations=function(a){return arguments.length?(r=+a,c):r},c.strength=function(a){return arguments.length?(o=+a,c):o},c.radius=function(a){return arguments.length?(t=typeof a=="function"?a:pe(+a),y(),c):t},c}function zs(t){return t.index}function et(t,s){var n=t.get(s);if(!n)throw new Error("node not found: "+s);return n}function Ss(t){var s=zs,n=z,l,o=pe(30),r,c,u,y,a,_=1;t==null&&(t=[]);function z(h){return 1/Math.min(u[h.source.index],u[h.target.index])}function p(h){for(var d=0,b=t.length;d<_;++d)for(var I=0,w,L,D,Q,v,R,A;I<b;++I)w=t[I],L=w.source,D=w.target,Q=D.x+D.vx-L.x-L.vx||de(a),v=D.y+D.vy-L.y-L.vy||de(a),R=Math.sqrt(Q*Q+v*v),R=(R-r[I])/R*h*l[I],Q*=R,v*=R,D.vx-=Q*(A=y[I]),D.vy-=v*A,L.vx+=Q*(A=1-A),L.vy+=v*A}function m(){if(c){var h,d=c.length,b=t.length,I=new Map(c.map((L,D)=>[s(L,D,c),L])),w;for(h=0,u=new Array(d);h<b;++h)w=t[h],w.index=h,typeof w.source!="object"&&(w.source=et(I,w.source)),typeof w.target!="object"&&(w.target=et(I,w.target)),u[w.source.index]=(u[w.source.index]||0)+1,u[w.target.index]=(u[w.target.index]||0)+1;for(h=0,y=new Array(b);h<b;++h)w=t[h],y[h]=u[w.source.index]/(u[w.source.index]+u[w.target.index]);l=new Array(b),C(),r=new Array(b),x()}}function C(){if(c)for(var h=0,d=t.length;h<d;++h)l[h]=+n(t[h],h,t)}function x(){if(c)for(var h=0,d=t.length;h<d;++h)r[h]=+o(t[h],h,t)}return p.initialize=function(h,d){c=h,a=d,m()},p.links=function(h){return arguments.length?(t=h,m(),p):t},p.id=function(h){return arguments.length?(s=h,p):s},p.iterations=function(h){return arguments.length?(_=+h,p):_},p.strength=function(h){return arguments.length?(n=typeof h=="function"?h:pe(+h),C(),p):n},p.distance=function(h){return arguments.length?(o=typeof h=="function"?h:pe(+h),x(),p):o},p}const Cs=1664525,ks=1013904223,tt=4294967296;function Ms(){let t=1;return()=>(t=(Cs*t+ks)%tt)/tt}function Is(t){return t.x}function Bs(t){return t.y}var Rs=10,Es=Math.PI*(3-Math.sqrt(5));function $s(t){var s,n=1,l=.001,o=1-Math.pow(l,1/300),r=0,c=.6,u=new Map,y=Bt(z),a=ot("tick","end"),_=Ms();t==null&&(t=[]);function z(){p(),a.call("tick",s),n<l&&(y.stop(),a.call("end",s))}function p(x){var h,d=t.length,b;x===void 0&&(x=1);for(var I=0;I<x;++I)for(n+=(r-n)*o,u.forEach(function(w){w(n)}),h=0;h<d;++h)b=t[h],b.fx==null?b.x+=b.vx*=c:(b.x=b.fx,b.vx=0),b.fy==null?b.y+=b.vy*=c:(b.y=b.fy,b.vy=0);return s}function m(){for(var x=0,h=t.length,d;x<h;++x){if(d=t[x],d.index=x,d.fx!=null&&(d.x=d.fx),d.fy!=null&&(d.y=d.fy),isNaN(d.x)||isNaN(d.y)){var b=Rs*Math.sqrt(.5+x),I=x*Es;d.x=b*Math.cos(I),d.y=b*Math.sin(I)}(isNaN(d.vx)||isNaN(d.vy))&&(d.vx=d.vy=0)}}function C(x){return x.initialize&&x.initialize(t,_),x}return m(),s={tick:p,restart:function(){return y.restart(z),s},stop:function(){return y.stop(),s},nodes:function(x){return arguments.length?(t=x,m(),u.forEach(C),s):t},alpha:function(x){return arguments.length?(n=+x,s):n},alphaMin:function(x){return arguments.length?(l=+x,s):l},alphaDecay:function(x){return arguments.length?(o=+x,s):+o},alphaTarget:function(x){return arguments.length?(r=+x,s):r},velocityDecay:function(x){return arguments.length?(c=1-x,s):1-c},randomSource:function(x){return arguments.length?(_=x,u.forEach(C),s):_},force:function(x,h){return arguments.length>1?(h==null?u.delete(x):u.set(x,C(h)),s):u.get(x)},find:function(x,h,d){var b=0,I=t.length,w,L,D,Q,v;for(d==null?d=1/0:d*=d,b=0;b<I;++b)Q=t[b],w=x-Q.x,L=h-Q.y,D=w*w+L*L,D<d&&(v=Q,d=D);return v},on:function(x,h){return arguments.length>1?(a.on(x,h),s):a.on(x)}}}function Ns(){var t,s,n,l,o=pe(-30),r,c=1,u=1/0,y=.81;function a(m){var C,x=t.length,h=Ye(t,Is,Bs).visitAfter(z);for(l=m,C=0;C<x;++C)s=t[C],h.visit(p)}function _(){if(t){var m,C=t.length,x;for(r=new Array(C),m=0;m<C;++m)x=t[m],r[x.index]=+o(x,m,t)}}function z(m){var C=0,x,h,d=0,b,I,w;if(m.length){for(b=I=w=0;w<4;++w)(x=m[w])&&(h=Math.abs(x.value))&&(C+=x.value,d+=h,b+=h*x.x,I+=h*x.y);m.x=b/d,m.y=I/d}else{x=m,x.x=x.data.x,x.y=x.data.y;do C+=r[x.data.index];while(x=x.next)}m.value=C}function p(m,C,x,h){if(!m.value)return!0;var d=m.x-s.x,b=m.y-s.y,I=h-C,w=d*d+b*b;if(I*I/y<w)return w<u&&(d===0&&(d=de(n),w+=d*d),b===0&&(b=de(n),w+=b*b),w<c&&(w=Math.sqrt(c*w)),s.vx+=d*m.value*l/w,s.vy+=b*m.value*l/w),!0;if(m.length||w>=u)return;(m.data!==s||m.next)&&(d===0&&(d=de(n),w+=d*d),b===0&&(b=de(n),w+=b*b),w<c&&(w=Math.sqrt(c*w)));do m.data!==s&&(I=r[m.data.index]*l/w,s.vx+=d*I,s.vy+=b*I);while(m=m.next)}return a.initialize=function(m,C){t=m,n=C,_()},a.strength=function(m){return arguments.length?(o=typeof m=="function"?m:pe(+m),_(),a):o},a.distanceMin=function(m){return arguments.length?(c=m*m,a):Math.sqrt(c)},a.distanceMax=function(m){return arguments.length?(u=m*m,a):Math.sqrt(u)},a.theta=function(m){return arguments.length?(y=m*m,a):Math.sqrt(y)},a}const Ce=t=>()=>t;function Ps(t,{sourceEvent:s,target:n,transform:l,dispatch:o}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:s,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:l,enumerable:!0,configurable:!0},_:{value:o}})}function Ee(t){t.stopImmediatePropagation()}function ye(t){t.preventDefault(),t.stopImmediatePropagation()}function Ls(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function As(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function st(){return this.__zoom||We}function Ds(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Gs(){return navigator.maxTouchPoints||"ontouchstart"in this}function Qs(t,s,n){var l=t.invertX(s[0][0])-n[0][0],o=t.invertX(s[1][0])-n[1][0],r=t.invertY(s[0][1])-n[0][1],c=t.invertY(s[1][1])-n[1][1];return t.translate(o>l?(l+o)/2:Math.min(0,l)||Math.max(0,o),c>r?(r+c)/2:Math.min(0,r)||Math.max(0,c))}function Ws(){var t=Ls,s=As,n=Qs,l=Ds,o=Gs,r=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,y=is,a=ot("start","zoom","end"),_,z,p,m=500,C=150,x=0,h=10;function d(i){i.property("__zoom",st).on("wheel.zoom",v,{passive:!1}).on("mousedown.zoom",R).on("dblclick.zoom",A).filter(o).on("touchstart.zoom",Z).on("touchmove.zoom",W).on("touchend.zoom touchcancel.zoom",M).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}d.transform=function(i,j,f,S){var B=i.selection?i.selection():i;B.property("__zoom",st),i!==B?L(i,j,f,S):B.interrupt().each(function(){D(this,arguments).event(S).start().zoom(null,typeof j=="function"?j.apply(this,arguments):j).end()})},d.scaleBy=function(i,j,f,S){d.scaleTo(i,function(){var B=this.__zoom.k,$=typeof j=="function"?j.apply(this,arguments):j;return B*$},f,S)},d.scaleTo=function(i,j,f,S){d.transform(i,function(){var B=s.apply(this,arguments),$=this.__zoom,N=f==null?w(B):typeof f=="function"?f.apply(this,arguments):f,G=$.invert(N),X=typeof j=="function"?j.apply(this,arguments):j;return n(I(b($,X),N,G),B,c)},f,S)},d.translateBy=function(i,j,f,S){d.transform(i,function(){return n(this.__zoom.translate(typeof j=="function"?j.apply(this,arguments):j,typeof f=="function"?f.apply(this,arguments):f),s.apply(this,arguments),c)},null,S)},d.translateTo=function(i,j,f,S,B){d.transform(i,function(){var $=s.apply(this,arguments),N=this.__zoom,G=S==null?w($):typeof S=="function"?S.apply(this,arguments):S;return n(We.translate(G[0],G[1]).scale(N.k).translate(typeof j=="function"?-j.apply(this,arguments):-j,typeof f=="function"?-f.apply(this,arguments):-f),$,c)},S,B)};function b(i,j){return j=Math.max(r[0],Math.min(r[1],j)),j===i.k?i:new Ie(j,i.x,i.y)}function I(i,j,f){var S=j[0]-f[0]*i.k,B=j[1]-f[1]*i.k;return S===i.x&&B===i.y?i:new Ie(i.k,S,B)}function w(i){return[(+i[0][0]+ +i[1][0])/2,(+i[0][1]+ +i[1][1])/2]}function L(i,j,f,S){i.on("start.zoom",function(){D(this,arguments).event(S).start()}).on("interrupt.zoom end.zoom",function(){D(this,arguments).event(S).end()}).tween("zoom",function(){var B=this,$=arguments,N=D(B,$).event(S),G=s.apply(B,$),X=f==null?w(G):typeof f=="function"?f.apply(B,$):f,g=Math.max(G[1][0]-G[0][0],G[1][1]-G[0][1]),T=B.__zoom,P=typeof j=="function"?j.apply(B,$):j,E=y(T.invert(X).concat(g/T.k),P.invert(X).concat(g/P.k));return function(H){if(H===1)H=P;else{var K=E(H),re=g/K[2];H=new Ie(re,X[0]-K[0]*re,X[1]-K[1]*re)}N.zoom(null,H)}})}function D(i,j,f){return!f&&i.__zooming||new Q(i,j)}function Q(i,j){this.that=i,this.args=j,this.active=0,this.sourceEvent=null,this.extent=s.apply(i,j),this.taps=0}Q.prototype={event:function(i){return i&&(this.sourceEvent=i),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(i,j){return this.mouse&&i!=="mouse"&&(this.mouse[1]=j.invert(this.mouse[0])),this.touch0&&i!=="touch"&&(this.touch0[1]=j.invert(this.touch0[0])),this.touch1&&i!=="touch"&&(this.touch1[1]=j.invert(this.touch1[0])),this.that.__zoom=j,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(i){var j=he(this.that).datum();a.call(i,this.that,new Ps(i,{sourceEvent:this.sourceEvent,target:d,transform:this.that.__zoom,dispatch:a}),j)}};function v(i,...j){if(!t.apply(this,arguments))return;var f=D(this,j).event(i),S=this.__zoom,B=Math.max(r[0],Math.min(r[1],S.k*Math.pow(2,l.apply(this,arguments)))),$=ue(i);if(f.wheel)(f.mouse[0][0]!==$[0]||f.mouse[0][1]!==$[1])&&(f.mouse[1]=S.invert(f.mouse[0]=$)),clearTimeout(f.wheel);else{if(S.k===B)return;f.mouse=[$,S.invert($)],Be(this),f.start()}ye(i),f.wheel=setTimeout(N,C),f.zoom("mouse",n(I(b(S,B),f.mouse[0],f.mouse[1]),f.extent,c));function N(){f.wheel=null,f.end()}}function R(i,...j){if(p||!t.apply(this,arguments))return;var f=i.currentTarget,S=D(this,j,!0).event(i),B=he(i.view).on("mousemove.zoom",X,!0).on("mouseup.zoom",g,!0),$=ue(i,f),N=i.clientX,G=i.clientY;Rt(i.view),Ee(i),S.mouse=[$,this.__zoom.invert($)],Be(this),S.start();function X(T){if(ye(T),!S.moved){var P=T.clientX-N,E=T.clientY-G;S.moved=P*P+E*E>x}S.event(T).zoom("mouse",n(I(S.that.__zoom,S.mouse[0]=ue(T,f),S.mouse[1]),S.extent,c))}function g(T){B.on("mousemove.zoom mouseup.zoom",null),Et(T.view,S.moved),ye(T),S.event(T).end()}}function A(i,...j){if(t.apply(this,arguments)){var f=this.__zoom,S=ue(i.changedTouches?i.changedTouches[0]:i,this),B=f.invert(S),$=f.k*(i.shiftKey?.5:2),N=n(I(b(f,$),S,B),s.apply(this,j),c);ye(i),u>0?he(this).transition().duration(u).call(L,N,S,i):he(this).call(d.transform,N,S,i)}}function Z(i,...j){if(t.apply(this,arguments)){var f=i.touches,S=f.length,B=D(this,j,i.changedTouches.length===S).event(i),$,N,G,X;for(Ee(i),N=0;N<S;++N)G=f[N],X=ue(G,this),X=[X,this.__zoom.invert(X),G.identifier],B.touch0?!B.touch1&&B.touch0[2]!==X[2]&&(B.touch1=X,B.taps=0):(B.touch0=X,$=!0,B.taps=1+!!_);_&&(_=clearTimeout(_)),$&&(B.taps<2&&(z=X[0],_=setTimeout(function(){_=null},m)),Be(this),B.start())}}function W(i,...j){if(this.__zooming){var f=D(this,j).event(i),S=i.changedTouches,B=S.length,$,N,G,X;for(ye(i),$=0;$<B;++$)N=S[$],G=ue(N,this),f.touch0&&f.touch0[2]===N.identifier?f.touch0[0]=G:f.touch1&&f.touch1[2]===N.identifier&&(f.touch1[0]=G);if(N=f.that.__zoom,f.touch1){var g=f.touch0[0],T=f.touch0[1],P=f.touch1[0],E=f.touch1[1],H=(H=P[0]-g[0])*H+(H=P[1]-g[1])*H,K=(K=E[0]-T[0])*K+(K=E[1]-T[1])*K;N=b(N,Math.sqrt(H/K)),G=[(g[0]+P[0])/2,(g[1]+P[1])/2],X=[(T[0]+E[0])/2,(T[1]+E[1])/2]}else if(f.touch0)G=f.touch0[0],X=f.touch0[1];else return;f.zoom("touch",n(I(N,G,X),f.extent,c))}}function M(i,...j){if(this.__zooming){var f=D(this,j).event(i),S=i.changedTouches,B=S.length,$,N;for(Ee(i),p&&clearTimeout(p),p=setTimeout(function(){p=null},m),$=0;$<B;++$)N=S[$],f.touch0&&f.touch0[2]===N.identifier?delete f.touch0:f.touch1&&f.touch1[2]===N.identifier&&delete f.touch1;if(f.touch1&&!f.touch0&&(f.touch0=f.touch1,delete f.touch1),f.touch0)f.touch0[1]=this.__zoom.invert(f.touch0[0]);else if(f.end(),f.taps===2&&(N=ue(N,this),Math.hypot(z[0]-N[0],z[1]-N[1])<h)){var G=he(this).on("dblclick.zoom");G&&G.apply(this,arguments)}}}return d.wheelDelta=function(i){return arguments.length?(l=typeof i=="function"?i:Ce(+i),d):l},d.filter=function(i){return arguments.length?(t=typeof i=="function"?i:Ce(!!i),d):t},d.touchable=function(i){return arguments.length?(o=typeof i=="function"?i:Ce(!!i),d):o},d.extent=function(i){return arguments.length?(s=typeof i=="function"?i:Ce([[+i[0][0],+i[0][1]],[+i[1][0],+i[1][1]]]),d):s},d.scaleExtent=function(i){return arguments.length?(r[0]=+i[0],r[1]=+i[1],d):[r[0],r[1]]},d.translateExtent=function(i){return arguments.length?(c[0][0]=+i[0][0],c[1][0]=+i[1][0],c[0][1]=+i[0][1],c[1][1]=+i[1][1],d):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},d.constrain=function(i){return arguments.length?(n=i,d):n},d.duration=function(i){return arguments.length?(u=+i,d):u},d.interpolate=function(i){return arguments.length?(y=i,d):y},d.on=function(){var i=a.on.apply(a,arguments);return i===a?d:i},d.clickDistance=function(i){return arguments.length?(x=(i=+i)*i,d):Math.sqrt(x)},d.tapDistance=function(i){return arguments.length?(h=+i,d):h},d}const Ys=[{id:"business_scenario_plane",name:"业务场景平面",level:1,color:"#e6f7ff",borderColor:"#1890ff",description:"核心业务场景和用户旅程"},{id:"business_link_plane",name:"业务链路平面",level:2,color:"#f6ffed",borderColor:"#52c41a",description:"业务场景的具体执行链路"},{id:"application_plane",name:"应用平面",level:3,color:"#fff7e6",borderColor:"#faad14",description:"业务系统和应用服务层"},{id:"middleware_plane",name:"中间件平面",level:4,color:"#f9f0ff",borderColor:"#722ed1",description:"中间件和基础服务层"},{id:"infrastructure_plane",name:"基础设施平面",level:5,color:"#fff2f0",borderColor:"#f5222d",description:"基础设施和资源层"}],Fs=[{id:"business_scenario_1",name:"电商下单场景",type:"business_scenario",level:1,plane:"business_scenario_plane",description:"用户在电商平台完成商品购买的完整流程",status:"active"},{id:"business_scenario_2",name:"支付结算场景",type:"business_scenario",level:1,plane:"business_scenario_plane",description:"处理用户支付和商户结算的完整业务场景",status:"active"},{id:"business_link_1",name:"用户下单链路",type:"business_link",level:2,plane:"business_link_plane",description:"从商品选择到订单确认的业务链路",status:"active"},{id:"business_link_2",name:"支付处理链路",type:"business_link",level:2,plane:"business_link_plane",description:"支付验证、扣款、确认的业务链路",status:"active"},{id:"business_link_3",name:"风控审核链路",type:"business_link",level:2,plane:"business_link_plane",description:"交易风险识别和安全审核链路",status:"active"},{id:"business_link_4",name:"资金结算链路",type:"business_link",level:2,plane:"business_link_plane",description:"商户资金结算和清分业务链路",status:"active"},{id:"system_1",name:"用户中心系统",type:"business_system",level:3,plane:"application_plane",description:"管理用户信息、认证、权限的核心系统",status:"running",version:"v2.1.0",instances:6},{id:"system_2",name:"商品管理系统",type:"business_system",level:3,plane:"application_plane",description:"商品信息、价格、促销管理系统",status:"running",version:"v1.8.2",instances:4},{id:"system_3",name:"订单管理系统",type:"business_system",level:3,plane:"application_plane",description:"订单生命周期管理的核心系统",status:"running",version:"v3.0.1",instances:8},{id:"system_4",name:"支付网关系统",type:"business_system",level:3,plane:"application_plane",description:"统一支付接入和路由系统",status:"running",version:"v1.9.3",instances:10},{id:"system_5",name:"钱包系统",type:"business_system",level:3,plane:"application_plane",description:"用户钱包余额和虚拟账户管理系统",status:"running",version:"v2.3.1",instances:8},{id:"system_6",name:"风控系统",type:"business_system",level:3,plane:"application_plane",description:"交易风险识别和反欺诈系统",status:"running",version:"v1.7.2",instances:6},{id:"system_7",name:"清结算系统",type:"business_system",level:3,plane:"application_plane",description:"资金清分和商户结算系统",status:"running",version:"v2.0.5",instances:4},{id:"system_8",name:"账务系统",type:"business_system",level:3,plane:"application_plane",description:"资金流水和账务记录系统",status:"running",version:"v1.5.8",instances:6},{id:"middleware_1",name:"API网关",type:"middleware",level:4,plane:"middleware_plane",description:"统一API接入、路由、限流、认证网关",status:"running",technology:"Kong",instances:6},{id:"middleware_2",name:"消息队列",type:"middleware",level:4,plane:"middleware_plane",description:"异步消息处理和事件驱动架构支撑",status:"running",technology:"RocketMQ",instances:9},{id:"middleware_3",name:"规则引擎",type:"middleware",level:4,plane:"middleware_plane",description:"风控规则和业务规则执行引擎",status:"running",technology:"Drools",instances:4},{id:"infrastructure_1",name:"Kubernetes集群",type:"infrastructure",level:5,plane:"infrastructure_plane",description:"容器编排和微服务运行平台",status:"running",nodes:24,region:"华东-1"},{id:"db_cluster_payment",name:"支付数据库集群",type:"infrastructure",level:5,plane:"infrastructure_plane",description:"支付交易专用高可用MySQL集群",status:"running",technology:"MySQL 8.0",nodes:10,config:"2主8从",region:"华东-1",databases:["payment_core","wallet_account","transaction_log"]},{id:"db_cluster_risk",name:"风控数据库集群",type:"infrastructure",level:5,plane:"infrastructure_plane",description:"风控数据和规则存储MySQL集群",status:"running",technology:"MySQL 8.0",nodes:6,config:"1主5从",region:"华东-1",databases:["risk_control","fraud_detection","rule_engine"]},{id:"db_cluster_settlement",name:"清结算数据库集群",type:"infrastructure",level:5,plane:"infrastructure_plane",description:"资金清算和结算数据MySQL集群",status:"running",technology:"MySQL 8.0",nodes:8,config:"2主6从",region:"华东-1",databases:["settlement_core","accounting_ledger","merchant_account"]}],Os=[{source:"business_scenario_1",target:"business_link_1",type:"contains",strength:1},{source:"business_scenario_2",target:"business_link_2",type:"contains",strength:1},{source:"business_scenario_2",target:"business_link_3",type:"contains",strength:1},{source:"business_scenario_2",target:"business_link_4",type:"contains",strength:1},{source:"business_link_1",target:"system_1",type:"depends_on",strength:.9},{source:"business_link_1",target:"system_2",type:"depends_on",strength:.8},{source:"business_link_1",target:"system_3",type:"depends_on",strength:1},{source:"business_link_2",target:"system_4",type:"depends_on",strength:1},{source:"business_link_2",target:"system_5",type:"depends_on",strength:.9},{source:"business_link_3",target:"system_6",type:"depends_on",strength:1},{source:"business_link_4",target:"system_7",type:"depends_on",strength:1},{source:"business_link_4",target:"system_8",type:"depends_on",strength:.9},{source:"system_4",target:"middleware_1",type:"uses",strength:1},{source:"system_5",target:"middleware_1",type:"uses",strength:.9},{source:"system_6",target:"middleware_3",type:"uses",strength:1},{source:"system_7",target:"middleware_2",type:"uses",strength:.9},{source:"system_8",target:"middleware_2",type:"uses",strength:.8},{source:"middleware_1",target:"infrastructure_1",type:"runs_on",strength:1},{source:"middleware_2",target:"infrastructure_1",type:"runs_on",strength:1},{source:"middleware_3",target:"infrastructure_1",type:"runs_on",strength:1},{source:"system_4",target:"db_cluster_payment",type:"stores_in",strength:1},{source:"system_5",target:"db_cluster_payment",type:"stores_in",strength:1},{source:"system_6",target:"db_cluster_risk",type:"stores_in",strength:1},{source:"system_7",target:"db_cluster_settlement",type:"stores_in",strength:1},{source:"system_8",target:"db_cluster_settlement",type:"stores_in",strength:1}],Vs={title:"电商平台业务关系图谱",description:"从业务场景到基础设施的完整技术架构关系图",levels:[{level:1,name:"业务场景层",description:"核心业务场景和用户旅程",color:"#1890ff"},{level:2,name:"业务链路层",description:"业务场景的具体执行链路",color:"#52c41a"},{level:3,name:"业务系统层",description:"支撑业务链路的应用系统",color:"#faad14"},{level:4,name:"中间件层",description:"系统间通信和基础服务中间件",color:"#722ed1"},{level:5,name:"基础设施层",description:"底层计算、存储、网络基础设施",color:"#f5222d"}],relationTypes:[{type:"contains",description:"包含关系",color:"#1890ff",strokeWidth:3},{type:"depends_on",description:"依赖关系",color:"#52c41a",strokeWidth:2},{type:"uses",description:"使用关系",color:"#faad14",strokeWidth:2},{type:"runs_on",description:"运行关系",color:"#722ed1",strokeWidth:2},{type:"stores_in",description:"存储关系",color:"#f5222d",strokeWidth:1}]},Xs={planes:Ys,nodes:Fs,links:Os,metadata:Vs},qs=V.div`
  width: 100%;
  height: 800px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  position: relative;
  background-color: var(--background-color);
  overflow: hidden;
`,Zs=V.div`
  position: absolute;
  top: 16px;
  right: 16px;
  z-index: 10;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  padding: 8px;
  box-shadow: var(--card-shadow);
`,Hs=V.div`
  position: absolute;
  top: 16px;
  left: 16px;
  z-index: 10;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  padding: 12px;
  box-shadow: var(--card-shadow);
  max-width: 300px;
`,Ks=V.div`
  position: absolute;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  padding: 12px;
  box-shadow: var(--card-shadow);
  pointer-events: none;
  z-index: 20;
  max-width: 250px;
  font-size: 12px;
  line-height: 1.4;
`,ct=()=>{var Q;const{t}=rt(["relationships","common"]),s=q.useRef(null),n=q.useRef(null),[l,o]=q.useState(!0),[r,c]=q.useState(null),[u,y]=q.useState(null),[a,_]=q.useState(null),[z,p]=q.useState(null),m=(v,R)=>({1:"#1890ff",2:"#52c41a",3:"#faad14",4:"#722ed1",5:"#f5222d"})[R]||"#8c8c8c",C=v=>({contains:"#1890ff",depends_on:"#52c41a",uses:"#faad14",runs_on:"#722ed1",stores_in:"#f5222d",logs_to:"#8c8c8c"})[v]||"#d9d9d9",x=v=>({1:20,2:16,3:14,4:12,5:10})[v]||12,h=(v,R,A,Z)=>{if(R.filter(f=>f.plane===v.id).length===0)return null;const M=Z/5;return{x:50,y:(v.level-1)*M+50,width:A-100,height:M-20,rx:12,ry:12}},d=()=>{if(!s.current||!n.current||!u)return;const v=n.current,R=he(s.current),A=v.clientWidth,Z=v.clientHeight;R.selectAll("*").remove(),R.attr("width",A).attr("height",Z);const W=Ws().scaleExtent([.1,3]).on("zoom",g=>{M.attr("transform",g.transform)});R.call(W);const M=R.append("g");M.append("g").attr("class","planes").selectAll("g").data(u.planes).enter().append("g").attr("class","plane").each(function(g){const T=h(g,u.nodes,A,Z);if(!T)return;const P=he(this);P.append("rect").attr("x",T.x).attr("y",T.y).attr("width",T.width).attr("height",T.height).attr("rx",T.rx).attr("ry",T.ry).attr("fill",g.color).attr("stroke",g.borderColor).attr("stroke-width",2).attr("stroke-dasharray","5,5").attr("opacity",.3),P.append("text").attr("x",T.x+20).attr("y",T.y+25).attr("font-size","16px").attr("font-weight","bold").attr("fill",g.borderColor).text(g.name),P.append("text").attr("x",T.x+20).attr("y",T.y+45).attr("font-size","12px").attr("fill","var(--text-secondary)").text(g.description)});const j=$s(u.nodes).force("link",Ss(u.links).id(g=>g.id).distance(g=>{const T=g.source.level,P=g.target.level;return Math.abs(T-P)===1?80:120}).strength(g=>g.strength)).force("charge",Ns().strength(-200)).force("center",rs(A/2,Z/2)).force("collision",Ts().radius(g=>x(g.level)+8)).force("plane",()=>{u.nodes.forEach(g=>{const T=u.planes.find(_e=>_e.id===g.plane);if(!T)return;const P=h(T,u.nodes,A,Z);if(!P)return;const E=30,H=P.x+E,K=P.x+P.width-E,re=P.y+E+50,ge=P.y+P.height-E;g.x<H&&(g.x=H),g.x>K&&(g.x=K),g.y<re&&(g.y=re),g.y>ge&&(g.y=ge)})}),f=M.append("defs");u.metadata.relationTypes.forEach(g=>{f.append("marker").attr("id",`arrow-${g.type}`).attr("viewBox","0 -5 10 10").attr("refX",15).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill",g.color)});const S=M.append("g").attr("class","links").selectAll("line").data(u.links).enter().append("line").attr("stroke",g=>C(g.type)).attr("stroke-width",g=>{const T=u.metadata.relationTypes.find(P=>P.type===g.type);return(T==null?void 0:T.strokeWidth)||1}).attr("stroke-opacity",.8).attr("marker-end",g=>`url(#arrow-${g.type})`),B=M.append("g").attr("class","nodes").selectAll("g").data(u.nodes).enter().append("g").attr("class","node").call($t().on("start",(g,T)=>{g.active||j.alphaTarget(.3).restart(),T.fx=T.x,T.fy=T.y}).on("drag",(g,T)=>{T.fx=g.x,T.fy=g.y}).on("end",(g,T)=>{g.active||j.alphaTarget(0);const P=u.planes.find(E=>E.id===T.plane);if(P){const E=h(P,u.nodes,A,Z);if(E){const K=E.x+30,re=E.x+E.width-30,ge=E.y+30+50,_e=E.y+E.height-30;T.fx<K&&(T.fx=K),T.fx>re&&(T.fx=re),T.fy<ge&&(T.fy=ge),T.fy>_e&&(T.fy=_e)}}}));B.append("circle").attr("r",g=>x(g.level)).attr("fill",g=>m(g.type,g.level)).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer"),B.append("text").text(g=>g.name).attr("x",0).attr("y",g=>x(g.level)+15).attr("text-anchor","middle").attr("font-size","10px").attr("fill","var(--text-color)").style("pointer-events","none"),B.on("mouseover",(g,T)=>{const P=new Set;P.add(T.id),u.links.forEach(E=>{const H=typeof E.source=="string"?E.source:E.source.id,K=typeof E.target=="string"?E.target:E.target.id;H===T.id&&P.add(K),K===T.id&&P.add(H)}),B.style("opacity",E=>P.has(E.id)?1:.3),S.style("opacity",E=>{const H=typeof E.source=="string"?E.source:E.source.id,K=typeof E.target=="string"?E.target:E.target.id;return H===T.id||K===T.id?1:.1}),p({x:g.pageX+10,y:g.pageY-10,content:T})}).on("mouseout",()=>{B.style("opacity",1),S.style("opacity",.8),p(null)}).on("click",(g,T)=>{_(T)}),j.on("tick",()=>{S.attr("x1",g=>g.source.x).attr("y1",g=>g.source.y).attr("x2",g=>g.target.x).attr("y2",g=>g.target.y),B.attr("transform",g=>`translate(${g.x},${g.y})`)});const $=()=>{R.transition().call(W.scaleBy,1.5)},N=()=>{R.transition().call(W.scaleBy,1/1.5)},G=()=>{R.transition().call(W.transform,We)},X=()=>{u.nodes.forEach(g=>{g.fx=null,g.fy=null}),j.alpha(1).restart()};s.current.zoomIn=$,s.current.zoomOut=N,s.current.resetZoom=G,s.current.resetNodePositions=X};q.useEffect(()=>{try{o(!0),y(Xs),c(null)}catch{c("Failed to load relationship data")}finally{o(!1)}},[]),q.useEffect(()=>{if(u&&!l){const v=setTimeout(()=>{d()},100);return()=>clearTimeout(v)}},[u,l]),q.useEffect(()=>{const v=()=>{u&&!l&&d()};return window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[u,l]);const b=()=>{var v,R;(R=(v=s.current)==null?void 0:v.zoomIn)==null||R.call(v)},I=()=>{var v,R;(R=(v=s.current)==null?void 0:v.zoomOut)==null||R.call(v)},w=()=>{var v,R;(R=(v=s.current)==null?void 0:v.resetZoom)==null||R.call(v)},L=()=>{var v,R;(R=(v=s.current)==null?void 0:v.resetNodePositions)==null||R.call(v)},D=()=>{d()};return l?e.jsx(ne,{children:e.jsxs("div",{style:{textAlign:"center",padding:"100px 0"},children:[e.jsx(_t,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:"Loading relationship graph..."})]})}):r?e.jsx(ne,{children:e.jsx(bt,{message:"Error",description:r,type:"error",showIcon:!0})}):e.jsxs(ne,{title:t("relationships:businessRelationshipGraph"),style:{marginBottom:24},children:[e.jsxs(qs,{ref:n,children:[e.jsx("svg",{ref:s}),e.jsx(Zs,{children:e.jsxs(F,{direction:"vertical",size:"small",children:[e.jsx(J,{size:"small",icon:e.jsx(wt,{}),onClick:b,title:t("relationships:zoomIn")}),e.jsx(J,{size:"small",icon:e.jsx(Tt,{}),onClick:I,title:t("relationships:zoomOut")}),e.jsx(J,{size:"small",icon:e.jsx(zt,{}),onClick:w,title:t("relationships:resetView")}),e.jsx(J,{size:"small",icon:e.jsx(St,{}),onClick:L,title:t("relationships:resetNodePositions")}),e.jsx(J,{size:"small",icon:e.jsx(je,{}),onClick:D,title:t("relationships:refreshGraph")})]})}),e.jsxs(Hs,{children:[e.jsx("div",{style:{marginBottom:12,fontWeight:"bold",fontSize:"14px"},children:t("relationships:legend")}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{marginBottom:4,fontSize:"12px",fontWeight:"bold"},children:[t("relationships:planes"),":"]}),u==null?void 0:u.planes.map(v=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:2},children:[e.jsx("div",{style:{width:16,height:12,backgroundColor:v.color,border:`1px solid ${v.borderColor}`,borderRadius:2,marginRight:6}}),e.jsx("span",{style:{fontSize:"11px"},children:v.name})]},v.id))]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{marginBottom:4,fontSize:"12px",fontWeight:"bold"},children:[t("relationships:nodeTypes"),":"]}),u==null?void 0:u.metadata.levels.map(v=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:2},children:[e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",backgroundColor:v.color,marginRight:6}}),e.jsx("span",{style:{fontSize:"11px"},children:v.name})]},v.level))]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:4,fontSize:"12px",fontWeight:"bold"},children:[t("relationships:relationTypes"),":"]}),u==null?void 0:u.metadata.relationTypes.map(v=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:2},children:[e.jsx("div",{style:{width:16,height:2,backgroundColor:v.color,marginRight:6}}),e.jsx("span",{style:{fontSize:"11px"},children:v.description})]},v.type))]})]}),z&&e.jsxs(Ks,{style:{left:z.x,top:z.y},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:z.content.name}),e.jsxs("div",{style:{marginBottom:2},children:[t("relationships:type"),": ",z.content.type]}),e.jsxs("div",{style:{marginBottom:2},children:[t("relationships:level"),": ",z.content.level]}),e.jsxs("div",{style:{marginBottom:2},children:[t("relationships:plane"),": ",z.content.plane]}),e.jsxs("div",{style:{marginBottom:2},children:[t("relationships:status"),":",e.jsx(k,{color:z.content.status==="active"||z.content.status==="running"?"green":"red",size:"small",style:{marginLeft:4},children:z.content.status})]}),e.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:z.content.description})]})]}),a&&e.jsx(ne,{title:`${t("relationships:nodeDetails")}: ${a.name}`,size:"small",style:{marginTop:16},extra:e.jsx(J,{size:"small",onClick:()=>_(null),children:t("common:close")}),children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16},children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[t("relationships:basicInfo"),":"]}),e.jsxs("div",{children:["ID: ",a.id]}),e.jsxs("div",{children:[t("relationships:type"),": ",a.type]}),e.jsxs("div",{children:[t("relationships:level"),": ",a.level]}),e.jsxs("div",{children:[t("relationships:plane"),": ",a.plane]}),e.jsxs("div",{children:[t("relationships:status"),": ",e.jsx(k,{color:a.status==="active"||a.status==="running"?"green":"red",children:a.status})]})]}),e.jsxs("div",{children:[e.jsxs("strong",{children:[t("common:description"),":"]}),e.jsx("div",{children:a.description})]}),a.instances&&e.jsxs("div",{children:[e.jsx("strong",{children:"实例信息:"}),e.jsxs("div",{children:["实例数: ",a.instances]}),a.version&&e.jsxs("div",{children:["版本: ",a.version]}),a.technology&&e.jsxs("div",{children:["技术栈: ",a.technology]})]}),a.nodes&&e.jsxs("div",{children:[e.jsxs("strong",{children:[t("relationships:clusterInfo"),":"]}),e.jsxs("div",{children:[t("relationships:nodeCount"),": ",a.nodes]}),a.config&&e.jsxs("div",{children:[t("relationships:config"),": ",a.config]}),a.technology&&e.jsxs("div",{children:[t("relationships:technology"),": ",a.technology]}),a.region&&e.jsxs("div",{children:[t("relationships:region"),": ",a.region]})]}),a.databases&&e.jsxs("div",{children:[e.jsxs("strong",{children:[t("relationships:databases"),":"]}),e.jsx("div",{style:{marginTop:4},children:a.databases.map((v,R)=>e.jsx(k,{color:"blue",style:{marginBottom:4},children:v},R))})]}),a.metrics&&e.jsxs("div",{children:[e.jsx("strong",{children:"业务指标:"}),e.jsxs("div",{children:["日均量: ",(Q=a.metrics.dailyVolume)==null?void 0:Q.toLocaleString()]}),e.jsxs("div",{children:["成功率: ",a.metrics.successRate,"%"]})]})]})})]})},Js=[{id:"report_001",name:"日销售报表",type:"report",category:"业务报表",status:"active",description:"每日销售数据统计报表，包含订单量、销售额、转化率等关键指标",owner:"数据分析团队",updateFrequency:"每日",lastUpdated:"2024-12-17 08:00:00",dataSource:["order_center","payment_core"],metrics:{viewCount:1250,exportCount:89,avgLoadTime:"2.3s"},tags:["销售","日报","核心指标"]},{id:"report_002",name:"用户行为分析报表",type:"report",category:"用户报表",status:"active",description:"用户访问路径、停留时间、转化漏斗分析报表",owner:"产品运营团队",updateFrequency:"实时",lastUpdated:"2024-12-17 14:30:00",dataSource:["user_behavior","page_analytics"],metrics:{viewCount:890,exportCount:45,avgLoadTime:"1.8s"},tags:["用户行为","实时","转化分析"]},{id:"business_link_001",name:"用户注册链路",type:"business_link",category:"用户管理",status:"running",description:"用户从注册到激活的完整业务流程",owner:"用户中心团队",avgResponseTime:"850ms",successRate:98.5,dailyVolume:2500,dependencies:["user_service","sms_service","email_service"],sla:{responseTime:"< 1s",availability:"99.9%",errorRate:"< 0.1%"},tags:["用户注册","核心链路","高频"]},{id:"business_link_002",name:"订单支付链路",type:"business_link",category:"交易管理",status:"running",description:"从下单到支付完成的核心交易链路",owner:"交易团队",avgResponseTime:"1.2s",successRate:99.2,dailyVolume:15e3,dependencies:["order_service","payment_gateway","risk_control"],sla:{responseTime:"< 2s",availability:"99.95%",errorRate:"< 0.05%"},tags:["订单支付","核心链路","高可用"]},{id:"system_001",name:"用户中心系统",type:"business_system",category:"核心系统",status:"running",description:"统一用户管理、认证、权限控制系统",owner:"基础架构团队",version:"v2.1.0",instances:6,technology:"Spring Boot + MySQL",resources:{cpu:"24 cores",memory:"48GB",storage:"500GB"},metrics:{qps:5e3,responseTime:"120ms",errorRate:"0.02%"},tags:["用户管理","核心系统","微服务"]},{id:"system_002",name:"订单管理系统",type:"business_system",category:"核心系统",status:"running",description:"订单全生命周期管理系统",owner:"订单团队",version:"v3.0.1",instances:8,technology:"Spring Cloud + MySQL",resources:{cpu:"32 cores",memory:"64GB",storage:"1TB"},metrics:{qps:8e3,responseTime:"200ms",errorRate:"0.01%"},tags:["订单管理","核心系统","高并发"]},{id:"api_001",name:"用户登录接口",type:"api",category:"用户接口",status:"active",description:"用户登录认证接口，支持多种登录方式",owner:"用户中心团队",method:"POST",path:"/api/v1/user/login",version:"v1.2",responseTime:"95ms",qps:1200,successRate:99.8,rateLimit:"1000/min",authentication:"JWT Token",tags:["用户登录","高频接口","认证"]},{id:"api_002",name:"订单创建接口",type:"api",category:"交易接口",status:"active",description:"创建新订单的核心接口",owner:"订单团队",method:"POST",path:"/api/v1/order/create",version:"v2.0",responseTime:"180ms",qps:800,successRate:99.5,rateLimit:"500/min",authentication:"Bearer Token",tags:["订单创建","核心接口","交易"]},{id:"database_001",name:"用户数据库集群",type:"database",category:"MySQL集群",status:"running",description:"用户相关数据存储的MySQL主从集群",owner:"DBA团队",technology:"MySQL 8.0",config:"1主4从",nodes:5,storage:"2TB",connections:500,qps:15e3,region:"华东-1",backup:"每日全量+实时增量",tags:["用户数据","MySQL","主从集群"]},{id:"database_002",name:"订单数据库集群",type:"database",category:"MySQL集群",status:"running",description:"订单交易数据存储的MySQL分库分表集群",owner:"DBA团队",technology:"MySQL 8.0",config:"2主6从",nodes:8,storage:"5TB",connections:800,qps:25e3,region:"华东-1",backup:"每日全量+实时增量",tags:["订单数据","MySQL","分库分表"]},{id:"table_001",name:"用户基础信息表",type:"table",category:"用户表",status:"active",description:"存储用户基础信息的核心表",owner:"用户中心团队",database:"user_center",tableName:"user_basic_info",rowCount:5e6,dataSize:"2.5GB",indexCount:8,partitions:12,lastAnalyzed:"2024-12-17 02:00:00",growthRate:"1000/day",tags:["用户信息","核心表","大表"]},{id:"table_002",name:"订单主表",type:"table",category:"订单表",status:"active",description:"存储订单主要信息的核心表",owner:"订单团队",database:"order_center",tableName:"order_main",rowCount:2e7,dataSize:"15GB",indexCount:12,partitions:24,lastAnalyzed:"2024-12-17 01:30:00",growthRate:"5000/day",tags:["订单信息","核心表","分区表"]},{id:"middleware_001",name:"Redis缓存集群",type:"middleware",category:"缓存中间件",status:"running",description:"分布式缓存集群，提供高性能数据访问",owner:"基础架构团队",technology:"Redis 7.0",config:"3主6从",nodes:9,memory:"256GB",hitRate:95.8,qps:5e4,region:"华东-1",tags:["缓存","Redis","高性能"]},{id:"middleware_002",name:"消息队列集群",type:"middleware",category:"消息中间件",status:"running",description:"异步消息处理和事件驱动架构支撑",owner:"基础架构团队",technology:"RocketMQ",config:"3节点集群",nodes:3,topics:45,dailyMessages:1e7,storage:"1TB",region:"华东-1",tags:["消息队列","RocketMQ","异步处理"]},{id:"service_001",name:"用户认证服务",type:"microservice",category:"基础服务",status:"running",description:"提供统一用户认证和授权服务",owner:"用户中心团队",version:"v1.8.0",instances:4,language:"Java",framework:"Spring Boot",port:8080,healthCheck:"/health",metrics:{qps:2e3,responseTime:"80ms",errorRate:"0.01%"},tags:["认证服务","微服务","基础组件"]},{id:"job_001",name:"订单状态同步任务",type:"scheduled_job",category:"数据同步",status:"running",description:"定时同步订单状态到数据仓库",owner:"数据团队",schedule:"0 */5 * * * *",lastRun:"2024-12-17 14:25:00",nextRun:"2024-12-17 14:30:00",avgDuration:"45s",successRate:99.5,processedRecords:15e3,tags:["定时任务","数据同步","订单"]},{id:"config_001",name:"支付配置中心",type:"configuration",category:"业务配置",status:"active",description:"支付相关的配置参数管理",owner:"支付团队",configCount:156,environment:"production",lastModified:"2024-12-17 10:15:00",version:"v2.3.1",encrypted:!0,tags:["支付配置","配置中心","生产环境"]}],Us={entities:Js},{Title:$e,Paragraph:Ne}=ie,{Search:en}=kt,{Option:ee}=Qe,tn=V.div`
  padding: 24px;
`,sn=V.div`
  margin-bottom: 24px;
`,nt=V.div`
  min-height: 500px;
`,oe=V(ne)`
  .ant-card-body {
    padding: 16px;
  }
`,nn=V.div`
  margin-bottom: 24px;
  padding: 16px;
  background: var(--card-bg);
  border-radius: 8px;
  border: 1px solid var(--border-color);
`,rn=V.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
  gap: 16px;
`,xn=()=>{const{t}=rt(["entities","common"]),s=dt(),[n,l]=q.useState("entities"),[o,r]=q.useState("all"),[c,u]=q.useState(""),[y,a]=q.useState("all"),[_,z]=q.useState("all"),[p,m]=q.useState(null),[C,x]=q.useState(!1),[h,d]=q.useState([]);q.useEffect(()=>{at(t("entities:title")),d(Us.entities)},[t]);const b=()=>{s("/entities/create")},I=M=>{s(`/entities/edit/${M.id}`)},w=M=>{l(M)},L=M=>{m(M),x(!0)},D=()=>({total:h.length,active:h.filter(i=>i.status==="active"||i.status==="running").length,inactive:h.filter(i=>i.status==="inactive").length,warning:h.filter(i=>i.status==="warning").length}),Q=()=>{const M={};return h.forEach(i=>{M[i.type]=(M[i.type]||0)+1}),M},v=()=>{let M=h;return o!=="all"&&(M=M.filter(i=>i.type===o)),c&&(M=M.filter(i=>{var j;return i.name.toLowerCase().includes(c.toLowerCase())||i.description.toLowerCase().includes(c.toLowerCase())||((j=i.tags)==null?void 0:j.some(f=>f.toLowerCase().includes(c.toLowerCase())))})),y!=="all"&&(M=M.filter(i=>i.type===y)),_!=="all"&&(M=M.filter(i=>i.status===_)),M},R=()=>{const M=D(),i=v();return e.jsxs(nt,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx($e,{level:3,style:{margin:0},children:t("entities:title")}),e.jsx(Ne,{style:{marginTop:8,marginBottom:0},children:t("entities:subtitle")})]}),e.jsxs(F,{children:[e.jsx(J,{icon:e.jsx(De,{}),children:t("common:export")}),e.jsx(J,{icon:e.jsx(je,{}),children:t("common:refresh")}),e.jsx(J,{type:"primary",icon:e.jsx(Ge,{}),onClick:b,children:t("entities:createEntity")})]})]}),e.jsxs(ce,{gutter:16,style:{marginBottom:24},children:[e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(oe,{children:e.jsx(O,{title:t("entities:stats.totalEntities"),value:M.total,suffix:t("common:unit.count"),valueStyle:{color:"#1890ff"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(oe,{children:e.jsx(O,{title:t("entities:stats.activeEntities"),value:M.active,suffix:t("common:unit.count"),valueStyle:{color:"#52c41a"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(oe,{children:e.jsx(O,{title:t("entities:stats.warningEntities"),value:M.warning,suffix:t("common:unit.count"),valueStyle:{color:"#faad14"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(oe,{children:e.jsx(O,{title:t("entities:stats.errorEntities"),value:M.inactive,suffix:t("common:unit.count"),valueStyle:{color:"#f5222d"}})})})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(F,{wrap:!0,children:[e.jsxs(k.CheckableTag,{checked:o==="all",onChange:()=>r("all"),children:["全部 (",M.total,")"]}),e.jsxs(k.CheckableTag,{checked:o==="report",onChange:()=>r("report"),children:["📊 ",t("entities:types.report")," (",W.report||0,")"]}),e.jsxs(k.CheckableTag,{checked:o==="business_link",onChange:()=>r("business_link"),children:["🔗 ",t("entities:types.businessLink")," (",W.business_link||0,")"]}),e.jsxs(k.CheckableTag,{checked:o==="business_system",onChange:()=>r("business_system"),children:["🏢 ",t("entities:types.businessSystem")," (",W.business_system||0,")"]}),e.jsxs(k.CheckableTag,{checked:o==="api",onChange:()=>r("api"),children:["🔌 ",t("entities:types.api")," (",W.api||0,")"]}),e.jsxs(k.CheckableTag,{checked:o==="database",onChange:()=>r("database"),children:["💾 ",t("entities:types.database")," (",W.database||0,")"]}),e.jsxs(k.CheckableTag,{checked:o==="table",onChange:()=>r("table"),children:["📋 ",t("entities:types.table")," (",W.table||0,")"]}),e.jsxs(k.CheckableTag,{checked:o==="middleware",onChange:()=>r("middleware"),children:["☁️ ",t("entities:types.middleware")," (",W.middleware||0,")"]}),e.jsxs(k.CheckableTag,{checked:o==="microservice",onChange:()=>r("microservice"),children:["🔧 ",t("entities:types.microservice")," (",W.microservice||0,")"]}),e.jsxs(k.CheckableTag,{checked:o==="scheduled_job",onChange:()=>r("scheduled_job"),children:["⏰ ",t("entities:types.scheduledJob")," (",W.scheduled_job||0,")"]}),e.jsxs(k.CheckableTag,{checked:o==="configuration",onChange:()=>r("configuration"),children:["⚙️ 配置 (",W.configuration||0,")"]})]})}),e.jsx(nn,{children:e.jsxs(ce,{gutter:16,align:"middle",children:[e.jsx(Y,{flex:"auto",children:e.jsx(en,{placeholder:t("entities:searchPlaceholder"),value:c,onChange:j=>u(j.target.value),style:{width:"100%"},allowClear:!0})}),e.jsx(Y,{children:e.jsxs(Qe,{value:y,onChange:a,style:{width:120},placeholder:t("entities:typeFilter"),children:[e.jsx(ee,{value:"all",children:t("entities:allTypes")}),e.jsx(ee,{value:"report",children:t("entities:types.report")}),e.jsx(ee,{value:"business_link",children:t("entities:types.businessLink")}),e.jsx(ee,{value:"business_system",children:t("entities:types.businessSystem")}),e.jsx(ee,{value:"api",children:t("entities:types.api")}),e.jsx(ee,{value:"database",children:t("entities:types.database")}),e.jsx(ee,{value:"table",children:t("entities:types.table")}),e.jsx(ee,{value:"middleware",children:t("entities:types.middleware")}),e.jsx(ee,{value:"microservice",children:t("entities:types.microservice")}),e.jsx(ee,{value:"scheduled_job",children:t("entities:types.scheduledJob")}),e.jsx(ee,{value:"configuration",children:t("entities:types.configuration")})]})}),e.jsx(Y,{children:e.jsxs(Qe,{value:_,onChange:z,style:{width:100},placeholder:"状态",children:[e.jsx(ee,{value:"all",children:"所有状态"}),e.jsx(ee,{value:"active",children:"活跃"}),e.jsx(ee,{value:"running",children:"运行中"}),e.jsx(ee,{value:"inactive",children:"停用"}),e.jsx(ee,{value:"warning",children:"告警"})]})})]})}),i.length>0?e.jsx(rn,{children:i.map(j=>e.jsx(es,{entity:j,onClick:L,onEdit:I},j.id))}):e.jsx(Mt,{description:t("entities:noEntitiesFound"),style:{margin:"60px 0"}})]})},A=()=>{var M;return p?e.jsxs(Ct,{title:`${t("entities:entityDetail")}: ${p.name}`,placement:"right",width:600,onClose:()=>x(!1),open:C,children:[e.jsxs(U,{column:1,bordered:!0,size:"small",children:[e.jsx(U.Item,{label:t("entities:entityId"),children:p.id}),e.jsx(U.Item,{label:t("entities:entityName"),children:p.name}),e.jsx(U.Item,{label:t("entities:entityType"),children:e.jsx(k,{color:"blue",children:p.type})}),e.jsx(U.Item,{label:t("entities:category"),children:p.category}),e.jsx(U.Item,{label:"状态",children:e.jsx(ve,{status:p.status==="active"||p.status==="running"?"success":"error",text:p.status})}),e.jsx(U.Item,{label:"描述",children:p.description}),e.jsx(U.Item,{label:"负责人",children:p.owner}),p.version&&e.jsx(U.Item,{label:"版本",children:p.version}),p.technology&&e.jsx(U.Item,{label:"技术栈",children:p.technology}),p.instances&&e.jsx(U.Item,{label:"实例数",children:p.instances}),p.method&&e.jsx(U.Item,{label:"请求方法",children:e.jsx(k,{color:p.method==="GET"?"green":"blue",children:p.method})}),p.path&&e.jsx(U.Item,{label:t("entities:apiPath"),children:e.jsx("code",{children:p.path})}),p.database&&e.jsx(U.Item,{label:t("entities:belongsToDatabase"),children:p.database}),p.tableName&&e.jsx(U.Item,{label:t("entities:tableName"),children:e.jsx("code",{children:p.tableName})}),e.jsx(U.Item,{label:"标签",children:e.jsx(F,{children:(M=p.tags)==null?void 0:M.map((i,j)=>e.jsx(k,{children:i},j))})})]}),p.metrics&&e.jsx(ne,{title:"性能指标",size:"small",style:{marginTop:16},children:e.jsx(ce,{gutter:16,children:Object.entries(p.metrics).map(([i,j])=>e.jsx(Y,{span:8,children:e.jsx(O,{title:i,value:j,valueStyle:{fontSize:"14px"}})},i))})}),p.sla&&e.jsx(ne,{title:"SLA指标",size:"small",style:{marginTop:16},children:e.jsx(U,{column:1,size:"small",children:Object.entries(p.sla).map(([i,j])=>e.jsx(U.Item,{label:i,children:j},i))})})]}):null},Z=()=>e.jsxs(nt,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx($e,{level:3,style:{margin:0},children:t("entities:relationshipGraph")}),e.jsx(Ne,{style:{marginTop:8,marginBottom:0},children:t("entities:relationshipGraphDesc")})]}),e.jsxs(F,{children:[e.jsx(J,{icon:e.jsx(De,{}),children:t("entities:exportGraph")}),e.jsx(J,{icon:e.jsx(ke,{}),children:t("entities:graphSettings")}),e.jsx(J,{icon:e.jsx(je,{}),children:t("entities:refreshGraph")})]})]}),e.jsxs(ce,{gutter:16,style:{marginBottom:24},children:[e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(oe,{children:e.jsx(O,{title:t("entities:stats.totalRelations"),value:25,suffix:t("common:unitRelation"),valueStyle:{color:"#1890ff"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(oe,{children:e.jsx(O,{title:t("entities:stats.relationTypes"),value:5,suffix:t("common:unitType"),valueStyle:{color:"#52c41a"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(oe,{children:e.jsx(O,{title:t("entities:stats.graphNodes"),value:21,suffix:t("common:unit.count"),valueStyle:{color:"#faad14"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(oe,{children:e.jsx(O,{title:t("entities:stats.connectedSystems"),value:5,suffix:t("common:unit.count"),valueStyle:{color:"#722ed1"}})})})]}),e.jsx(ct,{})]}),W=Q();return e.jsxs(tn,{children:[e.jsx(sn,{children:e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:e.jsxs("div",{children:[e.jsxs($e,{level:2,style:{margin:0},children:[t("entities:title"),e.jsx(ve,{count:"NEW",style:{backgroundColor:"#52c41a",marginLeft:12,fontSize:12}})]}),e.jsx(Ne,{style:{marginTop:8,marginBottom:0,fontSize:16},children:t("entities:description")})]})})}),e.jsx(ne,{children:e.jsxs(me,{activeKey:n,onChange:w,size:"large",tabBarStyle:{marginBottom:24},children:[e.jsx(me.TabPane,{tab:e.jsxs(F,{children:[e.jsx(Le,{}),t("entities:title"),e.jsx(ve,{count:D().total,showZero:!0})]}),children:R()},"entities"),e.jsx(me.TabPane,{tab:e.jsxs(F,{children:[e.jsx(Ae,{}),t("entities:relationshipGraph")]}),children:Z()},"relationships")]})}),A()]})},{Title:Pe,Paragraph:ae}=ie,an=V.div`
  padding: 24px;
`,on=V.div`
  margin-bottom: 24px;
`,it=V.div`
  min-height: 500px;
`,le=V(ne)`
  .ant-card-body {
    padding: 16px;
  }
`,fe=V(ne)`
  height: 100%;
  transition: all 0.3s ease;
  
  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
`,fn=()=>{const[t,s]=q.useState("entities");q.useEffect(()=>{at("实体关系")},[]);const n=r=>{s(r)},l=()=>e.jsxs(it,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx(Pe,{level:3,style:{margin:0},children:"实体管理"}),e.jsx(ae,{style:{marginTop:8,marginBottom:0},children:"管理系统中的各种实体对象，包括实体类型定义、实体实例创建和属性配置。"})]}),e.jsxs(F,{children:[e.jsx(J,{icon:e.jsx(Me,{}),children:"搜索"}),e.jsx(J,{icon:e.jsx(It,{}),children:"筛选"}),e.jsx(J,{icon:e.jsx(je,{}),children:"刷新"}),e.jsx(J,{type:"primary",icon:e.jsx(Ge,{}),children:"创建实体"})]})]}),e.jsxs(ce,{gutter:16,style:{marginBottom:24},children:[e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(le,{children:e.jsx(O,{title:"实体类型",value:0,suffix:"个",valueStyle:{color:"#1890ff"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(le,{children:e.jsx(O,{title:"实体实例",value:0,suffix:"个",valueStyle:{color:"#52c41a"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(le,{children:e.jsx(O,{title:"活跃实体",value:0,suffix:"个",valueStyle:{color:"#faad14"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(le,{children:e.jsx(O,{title:"异常实体",value:0,suffix:"个",valueStyle:{color:"#f5222d"}})})})]}),e.jsxs(ce,{gutter:16,children:[e.jsx(Y,{xs:24,md:12,lg:8,children:e.jsxs(fe,{title:e.jsxs(F,{children:[e.jsx(Le,{style:{color:"#1890ff"}}),"实体类型管理"]}),children:[e.jsx(ae,{children:"定义和管理不同类型的实体，包括属性定义、约束规则和生命周期配置。"}),e.jsxs("div",{children:[e.jsx(k,{color:"blue",children:"类型定义"}),e.jsx(k,{color:"blue",children:"属性配置"}),e.jsx(k,{color:"blue",children:"约束规则"})]})]})}),e.jsx(Y,{xs:24,md:12,lg:8,children:e.jsxs(fe,{title:e.jsxs(F,{children:[e.jsx(Ge,{style:{color:"#52c41a"}}),"实体实例管理"]}),children:[e.jsx(ae,{children:"创建、编辑和管理具体的实体实例，支持批量操作和状态管理。"}),e.jsxs("div",{children:[e.jsx(k,{color:"green",children:"实例创建"}),e.jsx(k,{color:"green",children:"批量操作"}),e.jsx(k,{color:"green",children:"状态管理"})]})]})}),e.jsx(Y,{xs:24,md:12,lg:8,children:e.jsxs(fe,{title:e.jsxs(F,{children:[e.jsx(Me,{style:{color:"#faad14"}}),"搜索与过滤"]}),children:[e.jsx(ae,{children:"强大的搜索和过滤功能，支持多维度查询和高级筛选条件。"}),e.jsxs("div",{children:[e.jsx(k,{color:"orange",children:"全文搜索"}),e.jsx(k,{color:"orange",children:"高级筛选"}),e.jsx(k,{color:"orange",children:"快速定位"})]})]})})]})]}),o=()=>e.jsxs(it,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx(Pe,{level:3,style:{margin:0},children:"关系图谱"}),e.jsx(ae,{style:{marginTop:8,marginBottom:0},children:"基于D3.js的交互式关系图谱，展示从业务场景到基础设施的完整技术架构关系。"})]}),e.jsxs(F,{children:[e.jsx(J,{icon:e.jsx(De,{}),children:"导出图谱"}),e.jsx(J,{icon:e.jsx(ke,{}),children:"图谱设置"}),e.jsx(J,{icon:e.jsx(je,{}),children:"刷新图谱"})]})]}),e.jsxs(ce,{gutter:16,style:{marginBottom:24},children:[e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(le,{children:e.jsx(O,{title:"关系总数",value:25,suffix:"条",valueStyle:{color:"#1890ff"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(le,{children:e.jsx(O,{title:"关系类型",value:5,suffix:"种",valueStyle:{color:"#52c41a"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(le,{children:e.jsx(O,{title:"图谱节点",value:21,suffix:"个",valueStyle:{color:"#faad14"}})})}),e.jsx(Y,{xs:24,sm:12,md:6,children:e.jsx(le,{children:e.jsx(O,{title:"支付系统",value:5,suffix:"个",valueStyle:{color:"#722ed1"}})})})]}),e.jsx(ct,{}),e.jsxs(ce,{gutter:16,style:{marginTop:24},children:[e.jsx(Y,{xs:24,md:12,lg:8,children:e.jsxs(fe,{title:e.jsxs(F,{children:[e.jsx(Ae,{style:{color:"#1890ff"}}),"多层级架构"]}),children:[e.jsx(ae,{children:"展示从业务场景、业务链路、业务系统、中间件到基础设施的5层架构关系。"}),e.jsxs("div",{children:[e.jsx(k,{color:"blue",children:"业务场景"}),e.jsx(k,{color:"green",children:"业务链路"}),e.jsx(k,{color:"orange",children:"业务系统"}),e.jsx(k,{color:"purple",children:"中间件"}),e.jsx(k,{color:"red",children:"基础设施"})]})]})}),e.jsx(Y,{xs:24,md:12,lg:8,children:e.jsxs(fe,{title:e.jsxs(F,{children:[e.jsx(Me,{style:{color:"#52c41a"}}),"交互式探索"]}),children:[e.jsx(ae,{children:"展示完整的支付结算生态系统，包含支付网关、钱包、风控、清结算等核心系统。"}),e.jsxs("div",{children:[e.jsx(k,{color:"blue",children:"支付网关"}),e.jsx(k,{color:"green",children:"钱包系统"}),e.jsx(k,{color:"orange",children:"风控系统"}),e.jsx(k,{color:"purple",children:"清结算"}),e.jsx(k,{color:"red",children:"账务系统"})]})]})}),e.jsx(Y,{xs:24,md:12,lg:8,children:e.jsxs(fe,{title:e.jsxs(F,{children:[e.jsx(ke,{style:{color:"#faad14"}}),"关系类型"]}),children:[e.jsx(ae,{children:"支持包含、依赖、使用、运行、存储、日志等6种关系类型的可视化展示。"}),e.jsxs("div",{children:[e.jsx(k,{color:"orange",children:"包含关系"}),e.jsx(k,{color:"orange",children:"依赖关系"}),e.jsx(k,{color:"orange",children:"使用关系"}),e.jsx(k,{color:"orange",children:"运行关系"})]})]})})]})]});return e.jsxs(an,{children:[e.jsx(on,{children:e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:e.jsxs("div",{children:[e.jsxs(Pe,{level:2,style:{margin:0},children:["实体关系",e.jsx(ve,{count:"开发中",style:{backgroundColor:"#faad14",marginLeft:12,fontSize:12}})]}),e.jsx(ae,{style:{marginTop:8,marginBottom:0,fontSize:16},children:"统一管理系统中的实体对象和它们之间的关系，提供完整的实体生命周期管理和关系可视化分析。"})]})})}),e.jsx(ne,{children:e.jsxs(me,{activeKey:t,onChange:n,size:"large",tabBarStyle:{marginBottom:24},children:[e.jsx(me.TabPane,{tab:e.jsxs(F,{children:[e.jsx(Le,{}),"实体管理"]}),children:l()},"entities"),e.jsx(me.TabPane,{tab:e.jsxs(F,{children:[e.jsx(Ae,{}),"关系图谱"]}),children:o()},"relationships")]})})]})};export{jn as EntityCreatePage,bn as EntityEditPage,yn as EntityForm,xn as EntityManagement,fn as EntityRelationship,xn as default};

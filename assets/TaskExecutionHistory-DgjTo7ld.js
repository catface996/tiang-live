import{u as q,a as K,b as Q,j as e,d as S}from"./index-i3_CIisb.js";import{r as o,K as p,N as T,O as V,P as E,T as J,d as I,C as y,j as f,Q as U,D as X,L as _,k as H,u as R,U as v,V as G,W as Z,s as ee,X as te,Y as se,a as ae,m as ie}from"./antd-C0IAgzs2.js";import{s as re}from"./index-Daowydkz.js";import{S as oe}from"./SearchFilterBar-BpyDeV8A.js";import"./Breadcrumb-C8oXpFp6.js";import"./vendor-DJG_os-6.js";const{Title:w,Text:h}=J,{Option:fe}=ie,{RangePicker:ne}=X,le=S.div`
  padding: 24px;
  background: #f5f5f5;
  min-height: 100vh;
`,ce=S.div`
  background: white;
  border-radius: 8px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
`,de=S(f)`
  margin-bottom: 8px;
  border-radius: 6px;
  
  &.completed {
    border-left: 4px solid #52c41a;
  }
  
  &.running {
    border-left: 4px solid #1890ff;
  }
  
  &.scheduled {
    border-left: 4px solid #faad14;
  }
  
  &.failed {
    border-left: 4px solid #ff4d4f;
  }
`,g=[{id:"exec_001",taskCollectionId:"1",taskCollectionName:"核心业务系统健康检查",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-26 10:00:00",endTime:"2025-06-26 10:15:30",duration:930,executedTargets:8,totalTargets:8,successRate:100,details:{targets:[{id:"entity_001",name:"用户管理系统",type:"entity",status:"success",actions:[{id:"health_check",name:"健康检查",status:"success",duration:120},{id:"performance_analysis",name:"性能分析",status:"success",duration:180}]}]}},{id:"exec_002",taskCollectionId:"2",taskCollectionName:"数据库性能监控",status:"running",triggerType:"hook",triggerSource:"API调用",startTime:"2025-06-26 14:30:00",endTime:null,duration:null,executedTargets:3,totalTargets:5,successRate:75,details:null},{id:"exec_003",taskCollectionId:"3",taskCollectionName:"安全扫描任务",status:"scheduled",triggerType:"cron",triggerSource:null,startTime:"2025-06-26 23:00:00",endTime:null,duration:null,executedTargets:0,totalTargets:6,successRate:0,details:null},{id:"exec_004",taskCollectionId:"1",taskCollectionName:"核心业务系统健康检查",status:"failed",triggerType:"cron",triggerSource:null,startTime:"2025-06-25 15:00:00",endTime:"2025-06-25 15:08:45",duration:525,executedTargets:5,totalTargets:8,successRate:62.5,details:{targets:[{id:"entity_002",name:"订单管理系统",type:"entity",status:"failed",actions:[{id:"health_check",name:"健康检查",status:"failed",duration:60}]}]}},{id:"exec_005",taskCollectionId:"4",taskCollectionName:"网络安全巡检",status:"completed",triggerType:"hook",triggerSource:"Webhook触发",startTime:"2025-06-24 10:30:00",endTime:"2025-06-24 11:45:20",duration:4520,executedTargets:12,totalTargets:12,successRate:100,details:{targets:[{id:"entity_003",name:"防火墙系统",type:"entity",status:"success",actions:[{id:"security_scan",name:"安全扫描",status:"success",duration:300}]}]}},{id:"exec_006",taskCollectionId:"2",taskCollectionName:"数据库性能监控",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-23 18:00:00",endTime:"2025-06-23 18:25:15",duration:1515,executedTargets:5,totalTargets:5,successRate:100,details:{targets:[{id:"entity_004",name:"MySQL主库",type:"entity",status:"success",actions:[{id:"performance_analysis",name:"性能分析",status:"success",duration:240}]}]}},{id:"exec_007",taskCollectionId:"5",taskCollectionName:"备份验证任务",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-22 02:00:00",endTime:"2025-06-22 02:45:30",duration:2730,executedTargets:3,totalTargets:3,successRate:100,details:{targets:[{id:"sequence_001",name:"数据备份流程",type:"sequence",status:"success",actions:[{id:"backup_verify",name:"备份验证",status:"success",duration:600}]}]}},{id:"exec_008",taskCollectionId:"6",taskCollectionName:"日志分析任务",status:"failed",triggerType:"hook",triggerSource:"监控告警触发",startTime:"2025-06-21 16:20:00",endTime:"2025-06-21 16:35:15",duration:915,executedTargets:2,totalTargets:4,successRate:50,details:{targets:[{id:"entity_005",name:"应用日志系统",type:"entity",status:"failed",actions:[{id:"log_analysis",name:"日志分析",status:"failed",duration:180}]}]}},{id:"exec_009",taskCollectionId:"7",taskCollectionName:"容器健康检查",status:"completed",triggerType:"cron",triggerSource:null,startTime:"2025-06-20 09:00:00",endTime:"2025-06-20 09:12:30",duration:750,executedTargets:15,totalTargets:15,successRate:100,details:{targets:[{id:"entity_006",name:"Kubernetes集群",type:"entity",status:"success",actions:[{id:"health_check",name:"健康检查",status:"success",duration:90}]}]}},{id:"exec_010",taskCollectionId:"8",taskCollectionName:"API接口监控",status:"running",triggerType:"hook",triggerSource:"手动触发",startTime:"2025-06-26 15:45:00",endTime:null,duration:null,executedTargets:6,totalTargets:10,successRate:85,details:null},{id:"exec_011",taskCollectionId:"1",taskCollectionName:"核心业务系统健康检查",status:"scheduled",triggerType:"cron",triggerSource:null,startTime:"2025-06-27 09:00:00",endTime:null,duration:null,executedTargets:0,totalTargets:8,successRate:0,details:null},{id:"exec_012",taskCollectionId:"3",taskCollectionName:"安全扫描任务",status:"completed",triggerType:"hook",triggerSource:"API调用",startTime:"2025-06-19 14:15:00",endTime:"2025-06-19 15:30:45",duration:4545,executedTargets:6,totalTargets:6,successRate:100,details:{targets:[{id:"entity_007",name:"Web应用防火墙",type:"entity",status:"success",actions:[{id:"security_scan",name:"安全扫描",status:"success",duration:450}]}]}},{id:"exec_013",taskCollectionId:"4",taskCollectionName:"网络安全巡检",status:"failed",triggerType:"cron",triggerSource:null,startTime:"2025-06-18 08:00:00",endTime:"2025-06-18 08:25:30",duration:1530,executedTargets:8,totalTargets:12,successRate:66.7,details:{targets:[{id:"entity_008",name:"入侵检测系统",type:"entity",status:"failed",actions:[{id:"security_scan",name:"安全扫描",status:"failed",duration:120}]}]}},{id:"exec_014",taskCollectionId:"5",taskCollectionName:"备份验证任务",status:"scheduled",triggerType:"cron",triggerSource:null,startTime:"2025-06-27 02:00:00",endTime:null,duration:null,executedTargets:0,totalTargets:3,successRate:0,details:null},{id:"exec_015",taskCollectionId:"6",taskCollectionName:"日志分析任务",status:"completed",triggerType:"hook",triggerSource:"Webhook触发",startTime:"2025-06-17 11:30:00",endTime:"2025-06-17 12:15:20",duration:2720,executedTargets:4,totalTargets:4,successRate:100,details:{targets:[{id:"sequence_002",name:"日志聚合流程",type:"sequence",status:"success",actions:[{id:"log_analysis",name:"日志分析",status:"success",duration:360}]}]}}],ke=()=>{const{t:s}=q(["taskExecutionHistory","common"]),{taskId:c}=K(),j=Q(),[n,b]=o.useState([]),[C,N]=o.useState([]),[d,D]=o.useState(""),[x,A]=o.useState("all"),[m,B]=o.useState("all"),[l,z]=o.useState(null),[k,L]=o.useState("desc");o.useEffect(()=>{re(s("taskExecutionHistory:title"));const t=c?g.filter(a=>a.taskCollectionId===c):g;b(t),console.log("加载的执行历史记录总数:",g.length),console.log("过滤后的执行历史记录:",t.length),console.log("当前taskId:",c),console.log("模拟数据前3条:",g.slice(0,3))},[c,s]),o.useEffect(()=>{console.log("筛选逻辑执行 - executionHistory长度:",n.length),console.log("当前筛选条件:",{searchKeyword:d,statusFilter:x,triggerFilter:m,dateRange:l,sortOrder:k});let t=[...n];d&&(t=t.filter(a=>{var i;return a.taskCollectionName.toLowerCase().includes(d.toLowerCase())||((i=a.triggerSource)==null?void 0:i.toLowerCase().includes(d.toLowerCase()))})),x!=="all"&&(t=t.filter(a=>a.status===x)),m!=="all"&&(t=t.filter(a=>a.triggerType===m)),l&&l[0]&&l[1]&&(t=t.filter(a=>{var r,u;const i=p(a.startTime);return i.isAfter((r=l[0])==null?void 0:r.startOf("day"))&&i.isBefore((u=l[1])==null?void 0:u.endOf("day"))})),t.sort((a,i)=>{const r=p(a.startTime).unix(),u=p(i.startTime).unix();return k==="desc"?u-r:r-u}),console.log("筛选后的记录数量:",t.length),console.log("筛选后的前3条记录:",t.slice(0,3)),N(t)},[n,d,x,m,l,k]);const P=()=>{const t=c?g.filter(a=>a.taskCollectionId===c):g;b(t)},$=t=>{j(`/task-management/task-collections/run/${t.id}`)},W=t=>{switch(t){case"completed":return"success";case"running":return"processing";case"scheduled":return"warning";case"failed":return"error";default:return"default"}},O=t=>{switch(t){case"completed":return e.jsx(ae,{style:{color:"#52c41a"}});case"running":return e.jsx(se,{style:{color:"#1890ff"}});case"scheduled":return e.jsx(v,{style:{color:"#faad14"}});case"failed":return e.jsx(te,{style:{color:"#ff4d4f"}});default:return e.jsx(v,{})}},F=(t,a)=>t==="cron"?{icon:e.jsx(Z,{style:{color:"#1890ff"}}),text:s("taskExecutionHistory:triggerType.cron"),color:"blue"}:{icon:e.jsx(ee,{style:{color:"#52c41a"}}),text:a||s("taskExecutionHistory:triggerType.hook"),color:"green"},M=t=>s(`taskExecutionHistory:status.${t}`),Y=t=>{if(t<60)return s("taskExecutionHistory:time.formatDuration.seconds",{count:t});if(t<3600){const r=Math.floor(t/60),u=t%60;return s("taskExecutionHistory:time.formatDuration.minutes",{minutes:r,seconds:u})}const a=Math.floor(t/3600),i=Math.floor(t%3600/60);return s("taskExecutionHistory:time.formatDuration.hours",{hours:a,minutes:i})};return e.jsxs(le,{children:[e.jsxs(T,{style:{marginBottom:24},children:[e.jsxs(T.Item,{children:[e.jsx(V,{}),e.jsx("span",{style:{cursor:"pointer",marginLeft:4},onClick:()=>j("/"),children:s("taskExecutionHistory:breadcrumb.home")})]}),e.jsxs(T.Item,{children:[e.jsx(E,{}),e.jsx("span",{style:{cursor:"pointer",marginLeft:4},onClick:()=>j("/task-management/task-collections"),children:s("taskExecutionHistory:breadcrumb.taskCollections")})]}),e.jsxs(T.Item,{children:[e.jsx(E,{}),s("taskExecutionHistory:breadcrumb.executionHistory")]})]}),e.jsx("div",{style:{marginBottom:24},children:e.jsxs(w,{level:2,style:{margin:0},children:[e.jsx(E,{style:{marginRight:8,color:"#1890ff"}}),s("taskExecutionHistory:title")]})}),e.jsxs(I,{gutter:16,style:{marginBottom:24},children:[e.jsx(y,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#1890ff"},children:n.length}),e.jsx("div",{style:{color:"#666"},children:s("taskExecutionHistory:stats.totalExecutions")})]})})}),e.jsx(y,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#52c41a"},children:n.filter(t=>t.status==="completed").length}),e.jsx("div",{style:{color:"#666"},children:s("taskExecutionHistory:stats.successfulExecutions")})]})})}),e.jsx(y,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#1890ff"},children:n.filter(t=>t.status==="running").length}),e.jsx("div",{style:{color:"#666"},children:s("taskExecutionHistory:stats.runningExecutions")})]})})}),e.jsx(y,{xs:24,sm:6,children:e.jsx(f,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#faad14"},children:n.filter(t=>t.status==="scheduled").length}),e.jsx("div",{style:{color:"#666"},children:s("taskExecutionHistory:stats.scheduledExecutions")})]})})})]}),e.jsx(U,{message:e.jsxs("div",{children:[e.jsxs("div",{children:["📊 原始数据: ",g.length," 条"]}),e.jsxs("div",{children:["📋 当前executionHistory: ",n.length," 条"]}),e.jsxs("div",{children:["🔍 筛选后filteredHistory: ",C.length," 条"]}),e.jsxs("div",{children:["🎯 当前taskId: ",c||"无"]}),e.jsxs("div",{children:["🔧 筛选条件: 状态=",x,", 触发=",m,', 搜索="',d,'"']})]}),type:"info",style:{marginBottom:16},showIcon:!0}),e.jsx(oe,{searchValue:d,onSearchChange:D,searchPlaceholder:s("taskExecutionHistory:search.placeholder"),filters:[{key:"status",value:x,onChange:A,options:[{value:"all",label:s("taskExecutionHistory:status.all")},{value:"completed",label:s("taskExecutionHistory:status.completed")},{value:"running",label:s("taskExecutionHistory:status.running")},{value:"scheduled",label:s("taskExecutionHistory:status.scheduled")},{value:"failed",label:s("taskExecutionHistory:status.failed")}],placeholder:s("taskExecutionHistory:filter.status"),width:120},{key:"trigger",value:m,onChange:B,options:[{value:"all",label:s("taskExecutionHistory:triggerType.all")},{value:"cron",label:s("taskExecutionHistory:triggerType.cron")},{value:"hook",label:s("taskExecutionHistory:triggerType.hook")}],placeholder:s("taskExecutionHistory:filter.triggerType"),width:120},{key:"sort",value:k,onChange:L,options:[{value:"desc",label:s("taskExecutionHistory:sort.newest")},{value:"asc",label:s("taskExecutionHistory:sort.oldest")}],placeholder:s("taskExecutionHistory:filter.sort"),width:120}],showRefresh:!0,onRefresh:P,extraActions:e.jsx(ne,{value:l,onChange:z,placeholder:[s("taskExecutionHistory:filter.startDate"),s("taskExecutionHistory:filter.endDate")],style:{width:240}})}),e.jsxs(ce,{children:[e.jsx("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs(w,{level:4,style:{margin:0},children:[s("taskExecutionHistory:list.title")," (",C.length,s("taskExecutionHistory:list.count"),")"]})}),e.jsx(_,{dataSource:C,renderItem:t=>{const a=F(t.triggerType,t.triggerSource),i=p(t.startTime).format("YYYY-MM-DD HH:mm:ss"),r=M(t.status);return e.jsx(_.Item,{style:{padding:0,marginBottom:8},children:e.jsx(de,{className:t.status,size:"small",hoverable:!0,onClick:()=>$(t),style:{width:"100%"},children:e.jsxs(I,{align:"middle",justify:"space-between",children:[e.jsx(y,{flex:"auto",children:e.jsxs(H,{direction:"vertical",size:4,children:[e.jsxs(H,{children:[O(t.status),e.jsx(h,{strong:!0,children:t.taskCollectionName}),e.jsx(R,{color:a.color,icon:a.icon,children:a.text})]}),e.jsxs(H,{size:16,children:[e.jsxs(h,{type:"secondary",children:[e.jsx(v,{})," ",i]}),t.duration&&e.jsxs(h,{type:"secondary",children:[e.jsx(G,{})," ",Y(t.duration)]}),e.jsxs(h,{type:"secondary",children:[s("taskExecutionHistory:card.successRate"),": ",t.successRate,"%"]}),e.jsxs(h,{type:"secondary",children:[s("taskExecutionHistory:card.progress"),": ",t.executedTargets,"/",t.totalTargets]})]})]})}),e.jsx(y,{children:e.jsx(R,{color:W(t.status),children:r})})]})})})},pagination:{pageSize:20,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,a)=>s("taskExecutionHistory:pagination.showTotal",{start:a[0],end:a[1],total:t}),pageSizeOptions:["10","20","50","100"]}})]})]})};export{ke as default};

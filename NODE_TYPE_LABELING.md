# 节点类型标注优化

## 🎯 优化目标
将诊断报告中的节点类型标注从简单的"sequence"、"entity"改为更有意义的层级标注，如"业务场景"、"业务链路"等。

## 📊 节点类型映射

### 层级结构对照表
| 层级 | 分类 | 标注名称 | 节点数量 | 示例节点 |
|------|------|----------|----------|----------|
| L5 | business_scenario | **业务场景** | 2个 | 用户购买流程、订单履约场景 |
| L4 | business_chain | **业务链路** | 3个 | 用户注册链路、支付处理链路、库存管理链路 |
| L3 | business_system | **业务系统** | 4个 | 用户管理系统、订单管理系统、支付系统、库存系统 |
| L2 | middleware | **中间件** | 4个 | API网关、Redis缓存、消息队列、配置中心 |
| L1 | infrastructure | **基础设施** | 5个 | Kubernetes集群、MySQL数据库、负载均衡器等 |

### 详细节点列表

#### L5 业务场景层 (2个节点)
- **scenario_001**: 用户购买流程 → `业务场景`
- **scenario_002**: 订单履约场景 → `业务场景`

#### L4 业务链路层 (3个节点)
- **chain_001**: 用户注册链路 → `业务链路`
- **chain_002**: 支付处理链路 → `业务链路`
- **chain_003**: 库存管理链路 → `业务链路`

#### L3 业务系统层 (4个节点)
- **system_001**: 用户管理系统 → `业务系统`
- **system_002**: 订单管理系统 → `业务系统`
- **system_003**: 支付系统 → `业务系统`
- **system_004**: 库存系统 → `业务系统`

#### L2 中间件层 (4个节点)
- **middleware_001**: API网关 → `中间件`
- **middleware_002**: Redis缓存 → `中间件`
- **middleware_003**: 消息队列 → `中间件`
- **middleware_004**: 配置中心 → `中间件`

#### L1 基础设施层 (5个节点)
- **infra_001**: Kubernetes集群 → `基础设施`
- **infra_002**: MySQL数据库 → `基础设施`
- **infra_003**: 负载均衡器 → `基础设施`
- **infra_004**: 存储系统 → `基础设施`
- **infra_005**: 网络设备 → `基础设施`

## 🔧 技术实现

### 1. 数据结构更新

#### 原始结构
```json
{
  "nodeId": "scenario_001",
  "nodeName": "用户购买流程",
  "nodeType": "sequence",  // 简单类型
  "status": "running"
}
```

#### 优化后结构
```json
{
  "nodeId": "scenario_001",
  "nodeName": "用户购买流程",
  "nodeType": "业务场景",  // 层级标注
  "layer": "L5",          // 层级信息
  "category": "business_scenario", // 分类信息
  "status": "running"
}
```

### 2. 类型定义更新

#### 原始类型定义
```typescript
export interface EnhancedDiagnosticReport {
  nodeType: 'entity' | 'sequence'; // 固定枚举
}
```

#### 优化后类型定义
```typescript
export interface EnhancedDiagnosticReport {
  nodeType: string; // 灵活的字符串类型
  layer?: string;   // 层级信息
  category?: string; // 分类信息
}
```

### 3. 映射逻辑
```python
# 根据category确定显示的类型标注
mapping = {
    'business_scenario': '业务场景',
    'business_chain': '业务链路', 
    'business_system': '业务系统',
    'middleware': '中间件',
    'infrastructure': '基础设施'
}
```

## 🎨 用户界面效果

### 标注显示效果
- **用户购买流程** → 显示为 `业务场景`
- **用户注册链路** → 显示为 `业务链路`
- **用户管理系统** → 显示为 `业务系统`
- **API网关** → 显示为 `中间件`
- **Kubernetes集群** → 显示为 `基础设施`

### 层级可视化
每个节点的标注都清晰地表明了它在系统架构中的位置和作用：
- **L5 业务场景**：最高层的业务流程
- **L4 业务链路**：具体的业务处理链路
- **L3 业务系统**：核心业务系统
- **L2 中间件**：技术支撑组件
- **L1 基础设施**：底层基础设施

## 📈 优化价值

### 1. 更好的可读性
- ✅ 一眼就能看出节点的层级和作用
- ✅ 避免了技术术语的困惑
- ✅ 符合业务人员的理解习惯

### 2. 更清晰的架构层次
- ✅ 明确展示了系统的分层架构
- ✅ 便于理解节点间的依赖关系
- ✅ 有助于问题定位和影响分析

### 3. 更好的运维体验
- ✅ 运维人员能快速识别问题层级
- ✅ 便于制定针对性的处理策略
- ✅ 提升故障排查效率

## ✅ 验证结果

### 数据完整性
- ✅ **18个节点**全部更新完成
- ✅ **5个层级**标注准确
- ✅ **类型定义**兼容性良好

### 功能验证
- ✅ TypeScript编译通过
- ✅ 节点类型显示正确
- ✅ 层级信息完整

### 统计结果
```
业务场景: 2个节点
业务链路: 3个节点  
业务系统: 4个节点
中间件: 4个节点
基础设施: 5个节点
总计: 18个节点
```

现在诊断报告中的节点类型标注更加直观和有意义，用户可以清楚地看到每个节点在系统架构中的层级和作用！🎉

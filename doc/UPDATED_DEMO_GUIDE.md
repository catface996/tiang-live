# 任务集合运行详情功能更新演示指南

## 🎯 更新内容

### 1. 面包屑导航
- ✅ 移除了返回按钮
- ✅ 新增面包屑导航组件
- ✅ 支持点击导航到上级页面
- ✅ 显示完整的页面层级关系

### 2. 分层拓扑图
- ✅ 参考实体关系图实现
- ✅ 按面板分层展示节点
- ✅ 三层架构：应用层、服务层、数据层
- ✅ 面板背景和标题展示
- ✅ 节点约束在对应面板内

### 3. 诊断报告清单
- ✅ 在运行信息和拓扑图之间新增
- ✅ 折叠面板展示每个节点的诊断报告
- ✅ 详细的检查结果和建议措施
- ✅ 统计信息汇总展示

## 🚀 功能演示步骤

### 1. 启动项目
```bash
cd /Users/catface/Documents/code/entropy/tiang-ops
npm run dev
```

### 2. 访问任务集合管理页面
打开浏览器访问: `http://localhost:5173/task-management/task-collections`

### 3. 查看任务集合运行详情
在任务集合卡片上点击 📊 图标（查看运行详情按钮）

## 📋 新功能详细说明

### 面包屑导航
```
首页 > 任务集合 > 核心服务监控任务 - 运行详情
```
- 点击"首页"跳转到仪表盘
- 点击"任务集合"返回任务集合列表
- 当前页面显示为最后一级

### 分层拓扑图
#### 应用层 (蓝色面板)
- 用户登录流程 ✅ 已完成
- 订单创建流程 ⚠️ 已完成(有警告)
- 支付流程 ⚪ 等待中

#### 服务层 (绿色面板)
- 用户服务 ✅ 已完成
- 订单服务 ❌ 失败
- 支付服务 🔵 运行中

#### 数据层 (橙色面板)
- 数据库连接池 ⚪ 等待中
- 缓存集群 ⚪ 等待中

### 诊断报告清单
#### 用户服务报告
- **总检查**: 2项
- **通过**: 2项
- **检查详情**:
  - ✅ 健康检查: 服务运行正常，响应时间 < 100ms
  - ✅ 性能分析: CPU使用率: 45%, 内存使用率: 60%
- **建议措施**:
  - 继续保持当前配置
  - 建议定期清理日志文件

#### 订单服务报告
- **总检查**: 2项
- **失败**: 1项，**警告**: 1项
- **检查详情**:
  - ❌ 健康检查: 服务响应超时，连接失败
  - ⚠️ 故障分析: 检测到内存泄漏风险
- **建议措施**:
  - 立即重启服务实例
  - 检查网络连接配置
  - 增加内存监控告警
  - 优化内存使用策略

#### 用户登录流程报告
- **总检查**: 1项
- **通过**: 1项
- **检查详情**:
  - ✅ 健康检查: 登录流程正常，平均响应时间 2.3s
- **建议措施**:
  - 流程运行正常，无需调整

#### 订单创建流程报告
- **总检查**: 2项
- **通过**: 1项，**警告**: 1项
- **检查详情**:
  - ⚠️ 健康检查: 流程执行成功，但响应时间较慢
  - ✅ 性能分析: 平均处理时间: 3.2s，成功率: 98%
- **建议措施**:
  - 优化数据库查询性能
  - 考虑增加缓存机制
  - 监控第三方API响应时间

## 🎨 视觉改进

### 拓扑图增强
- **分层背景**: 不同颜色的面板背景
- **面板标题**: 清晰的层级标识
- **节点约束**: 节点被约束在对应面板内
- **双重图例**: 状态图例 + 面板图例

### 诊断报告优化
- **折叠面板**: 节省空间，便于浏览
- **状态徽章**: 直观的状态指示
- **统计汇总**: 快速了解检查结果
- **建议措施**: 实用的运维建议

### 导航体验
- **面包屑**: 清晰的页面层级
- **可点击**: 支持快速导航
- **图标标识**: 增强视觉识别

## 🔧 技术实现亮点

### 1. 分层布局算法
```typescript
const calculatePanelBounds = (panel: Panel, nodes: TaskNode[], width: number, height: number) => {
  const panelHeight = (height - padding * 4) / 3; // 三个面板平分高度
  const y = padding + (panel.level - 1) * (panelHeight + padding);
  return { x: padding, y: y, width: width - padding * 2, height: panelHeight };
};
```

### 2. 面板约束力
```typescript
.force("panel", () => {
  nodes.forEach(node => {
    const panel = runDetail.panels.find(p => p.id === node.panel);
    const bounds = calculatePanelBounds(panel, nodes, width, height);
    // 将节点约束在面板范围内
    if (node.x! < minX) node.x = minX;
    if (node.x! > maxX) node.x = maxX;
    // ...
  });
})
```

### 3. 诊断报告数据结构
```typescript
interface DiagnosticReport {
  nodeId: string;
  nodeName: string;
  nodeType: 'entity' | 'sequence';
  status: NodeStatus;
  summary: {
    totalChecks: number;
    passedChecks: number;
    warningChecks: number;
    failedChecks: number;
  };
  checks: CheckResult[];
  recommendations?: string[];
}
```

## 📊 数据展示层次

### 第一层：统计概览
- 总节点数、已完成、失败节点、成功率

### 第二层：运行信息
- 开始时间、结束时间、运行时长、创建者、状态、进度

### 第三层：诊断报告
- 每个节点的详细检查结果和建议措施

### 第四层：拓扑关系
- 分层展示节点关系和依赖

### 第五层：节点详情
- 点击节点查看完整的执行信息

## 🎯 用户体验提升

1. **导航便利性**: 面包屑导航提供清晰的页面层级
2. **信息层次性**: 从概览到详情的渐进式信息展示
3. **视觉清晰性**: 分层面板和颜色编码提高可读性
4. **操作直观性**: 点击、拖拽等交互操作自然流畅
5. **诊断实用性**: 详细的检查结果和实用建议

## 🔍 测试要点

### 面包屑测试
- [ ] 点击"首页"跳转到仪表盘
- [ ] 点击"任务集合"返回列表页
- [ ] 当前页面正确显示

### 拓扑图测试
- [ ] 三个面板正确显示
- [ ] 节点按面板分层
- [ ] 节点可以拖拽但约束在面板内
- [ ] 依赖关系箭头正确显示

### 诊断报告测试
- [ ] 折叠面板正常工作
- [ ] 统计信息正确显示
- [ ] 检查详情完整展示
- [ ] 建议措施有实用价值

这个更新版本完全满足了你的三个要求，提供了更好的用户体验和更清晰的信息展示。
